<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constructor.Constructor &mdash; Python Lumercial Costructor Script 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Python Lumercial Costructor Script
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python Lumercial Costructor Script</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">Constructor.Constructor</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Constructor.Constructor</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri Feb 10 08:31:42 2023</span>

<span class="sd">@author: Martin.Mihaylov</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>



<div class="viewcode-block" id="loadingBar">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.loadingBar">[docs]</a>
<span class="k">def</span> <span class="nf">loadingBar</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span>
                     <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">percent</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span>
                     <span class="n">size</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">percent</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span></div>



<span class="c1"># Array with arange including the last element</span>
<div class="viewcode-block" id="arange">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.arange">[docs]</a>
<span class="k">def</span> <span class="nf">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">and</span> <span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span></div>



<div class="viewcode-block" id="Constructor">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor">[docs]</a>
<span class="k">class</span> <span class="nc">Constructor</span><span class="p">:</span>

    <span class="c1"># Init Programm</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">MaterialLib</span><span class="p">,</span> <span class="n">Mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Path to the umerical python file</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="o">=</span> <span class="n">MaterialLib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s1">&#39;lumapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">Mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Solver Used&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;FDTD&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EME</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Solver Used&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;EME&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Non Valid Solver was choosen. Please pass on one of the two supported solvers [&#39;FDTD&#39; or &#39;EME&#39;]&quot;</span><span class="p">)</span>

    <span class="c1"># Close Programm</span>
<div class="viewcode-block" id="Constructor.Close">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Close">[docs]</a>
    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical API is closed&#39;</span><span class="p">)</span></div>



    <span class="c1"># Remove the object and solver region</span>
<div class="viewcode-block" id="Constructor.removeObject">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.removeObject">[docs]</a>
    <span class="k">def</span> <span class="nf">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Switch from simulation to layout mode.</span>
<span class="sd">        Remove all objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span></div>

        
    
<div class="viewcode-block" id="Constructor.Help">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Help">[docs]</a>
    <span class="k">def</span> <span class="nf">Help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Subject</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">Subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Help can be called with Help(str(subject)). Subject can be choosen from &#39;Objects&#39;, &#39;Solvers&#39;, &#39;Start Simulation&#39;, &#39;Results&#39;, &#39;Loading Bar&#39; and &#39;Log File&#39; !! &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_help</span> <span class="o">=</span> <span class="n">HelpSubject</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Objects&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Objects</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Solvers&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Solvers</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Start Simulation&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_StartSimulation</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Results&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Results</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Loading Bar&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LoadingBar</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Remove Object&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_RemoveObject</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Log File&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LogFile</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Help can be called with Help(str(subject)). Subject can be choosen from &#39;Objects&#39;, &#39;Solvers&#39;, &#39;Start Simulation&#39;, &#39;Results&#39;, &#39;Loading Bar&#39; and &#39;Log File&#39; !! &quot;</span><span class="p">)</span></div>



                  



    <span class="c1"># Choose Solver! Only FDTD and EME supported</span>
<div class="viewcode-block" id="Constructor.FDTD">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.FDTD">[docs]</a>
    <span class="k">def</span> <span class="nf">FDTD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">importmaterialdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical FDTD API is started&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Constructor.EME">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.EME">[docs]</a>
    <span class="k">def</span> <span class="nf">EME</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span><span class="o">.</span><span class="n">MODE</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">importmaterialdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical EME API is started&#39;</span><span class="p">)</span></div>




    <span class="c1">#   Solvers Function</span>
<div class="viewcode-block" id="Constructor.Solver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDTD_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EME_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDE_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;varFDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">varFDTD_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid Solver Type! Possible Options are FDE - For Waveguides, EME - for MMI , directional Couplers, varFDTD - for MMI Structures and FDTD - for MMI.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.StartSimFunction">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.StartSimFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">StartSimFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartFDTDSimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;FDTD Simulation&quot;</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartEMESimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;EME Simulation&quot;</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartFDESimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;FDE Simulation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid simulation type. Possibpe options for Type are: &#39;FDTD&#39;, &#39;EME&#39;, &#39;FDE&#39; !&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.ExtrtactData">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ExtrtactData">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtrtactData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1_Trapez&quot;</span><span class="p">:</span>
                <span class="n">S_Param3</span><span class="p">,</span> <span class="n">Power3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param3</span><span class="p">,</span> <span class="n">Power3</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2_Trapez&quot;</span><span class="p">:</span>
                <span class="n">S_Param4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param4</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
                <span class="n">S_Param4</span><span class="p">,</span> <span class="n">Power4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param4</span><span class="p">,</span> <span class="n">Power4</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;ArcWaveguide&quot;</span><span class="p">:</span>
                <span class="n">S_Param2</span><span class="p">,</span> <span class="n">Power2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param2</span><span class="p">,</span> <span class="n">Power2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;BendWaveguide&quot;</span><span class="p">:</span>
                <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Structure was given. Possible structures are &#39;MMI2x1&#39;, &#39;MMI2x2&#39;, &#39;DirectionalCoupler&#39;, &#39;ArcWaveguide&#39; and &#39;BendWaveguide&#39; !&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractEMEResults</span><span class="p">(</span><span class="s1">&#39;monitor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="n">TEModes</span><span class="p">,</span> <span class="n">TEData</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">TMData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDEResultsExtendet</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Effective Index&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">TEModes</span><span class="p">,</span> <span class="n">TEData</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">TMData</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid solver Type was given. To extract data from the simulation please give a correct simulation Type! Possible Types are: &#39;FDTD&#39;, &#39;EME&#39; and &#39;FDE&#39;.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.OverlapFDEModes">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.OverlapFDEModes">[docs]</a>
    <span class="k">def</span> <span class="nf">OverlapFDEModes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Waveguide</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FDE_Solver</span><span class="p">(</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StartFDESimulation</span><span class="p">()</span>
        <span class="n">TEModes</span><span class="p">,</span> <span class="n">TMModes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDEModes</span><span class="p">(</span><span class="n">EffIndexValue</span><span class="o">=</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Effective Index&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CoppyDcard</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">TEModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">TMModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TE Mode </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">TEModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and TM Mode </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">TMModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> have been copyed to the Lumerical Dcard.&quot;</span><span class="p">)</span></div>


    <span class="c1"># =============================================================================</span>
    <span class="c1"># Selection of possible Functions</span>
    <span class="c1"># =============================================================================</span>



<div class="viewcode-block" id="Constructor.FDTD_Solver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.FDTD_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">FDTD_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span> <span class="ow">or</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1_Trapez&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x1FDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span> <span class="ow">or</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2_Trapez&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x2FDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;DirectionalCoupler&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDCFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Directional Coupler&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;BendWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;BendWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBendWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bend Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;ArcWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;ArcWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setArcWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arc Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;StraightWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;StraightWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setStraightWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Straight Waveguide&quot;</span>
        <span class="c1"># elif Structure == &quot;CascadetMMI&quot;:</span>
        <span class="c1">#     self.Struct = &quot;CascadetMMI&quot;</span>
        <span class="c1">#     self.setCascadetMMIFDTDSolver(Parameters, SpaceX, SpaceY)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Strucute for FDTD Solver is selected. Possible Strucures are MMI2x1 or MMI2x2&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Constructor.EME_Solver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.EME_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">EME_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span> <span class="ow">or</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1_Trapez&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x1EMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span> <span class="ow">or</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2_Trapez&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x2EMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDCEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Directional Coupler&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;WDM&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWDMEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Angled Wavelength Division Multiplexer&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;StraightWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setStraightWaveguideEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Straight Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;InverseTaper&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setInverseTaperEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Inverse Tapers&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid Structure for EME Solver is selected. Possible Strucutres are MMI2x1, MMI2x2 and DirectionalCoupler&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.FDE_Solver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.FDE_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">FDE_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;Waveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWaveguideFDESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Waveguide&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Structure for FDE Solver is selected. Possible Structure is Waveguide.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.varFDTD_Solver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.varFDTD_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">varFDTD_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI1x2VarFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x2VarFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Strucute for varFDTD Solver is selected. Possible Strucures are MMI2x1 or MMI2x2&quot;</span><span class="p">)</span></div>

            
            
<div class="viewcode-block" id="Constructor.ReturnLogInfo">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ReturnLogInfo">[docs]</a>
    <span class="k">def</span> <span class="nf">ReturnLogInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span></div>

    
    
<div class="viewcode-block" id="Constructor.Script">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Script">[docs]</a>
    <span class="k">def</span> <span class="nf">Script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">myscript</span> <span class="o">=</span>  <span class="s1">&#39;delta_w = 2*thickness*tan((angle_side)*pi/180); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_l = &quot; + num2str(width_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_r = &quot; + num2str(width_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;width_top_l = width_l - (1-hfrac_ref)*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;width_top_r = width_r - (1-hfrac_ref)*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_top_l = &quot; + num2str(width_top_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_top_r = &quot; + num2str(width_top_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;width_bot_l = width_l + hfrac_ref*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;width_bot_r = width_r + hfrac_ref*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_bot_l = &quot; + num2str(width_bot_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;?&quot;width_bot_r = &quot; + num2str(width_bot_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;if ((hfrac_ref&gt;1) or (hfrac_ref&lt;0)){?&quot;Error: hfrac_ref must be between 0 and 1.&quot;;break;} </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;if ((width_top_l&lt;0) or (width_top_r&lt;0) or (width_bot_l&lt;0) or (width_bot_r&lt;0)){?&quot;Error: width and angle values are not correct.&quot;;break;} </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;zmin = -thickness/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;zmax = thickness/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;xmin = -len/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;xmax = len/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymin_bot_l = -width_bot_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymax_bot_l = width_bot_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymin_bot_r = -width_bot_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymax_bot_r = width_bot_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymin_top_l = -width_top_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymax_top_l = width_top_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymin_top_r = -width_top_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;ymax_top_r = width_top_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;vtx=    [xmin,ymin_bot_l,zmin; xmax,ymin_bot_r,zmin; xmax,ymax_bot_r,zmin; xmin,ymax_bot_l,zmin; xmin,ymin_top_l,zmax; xmax,ymin_top_r,zmax; xmax,ymax_top_r,zmax; xmin,ymax_top_l,zmax];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a = cell(6); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;for(i = 1:6){ a</span><span class="si">{i}</span><span class="s1"> = cell(1);}   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{1}{1}</span><span class="s1"> = [1,4,3,2];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{2}{1}</span><span class="s1"> = [1,2,6,5];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{3}{1}</span><span class="s1"> = [2,3,7,6];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{4}{1}</span><span class="s1"> = [3,4,8,7];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{5}{1}</span><span class="s1"> = [1,5,8,4];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;a</span><span class="si">{6}{1}</span><span class="s1"> = [5,6,7,8];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;addplanarsolid(vtx,a);   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;if (material==&quot;&lt;Object defined dielectric&gt;&quot;){setnamed(&quot;solid&quot;, &quot;index&quot;,index);}   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span>  <span class="s1">&#39;else{setnamed(&quot;solid&quot;, &quot;material&quot;,material);}   </span><span class="se">\n</span><span class="s1">&#39;</span>
        
        <span class="k">return</span> <span class="n">myscript</span></div>




<span class="c1"># =============================================================================</span>
<span class="c1"># Structures</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="Constructor.Waveguide">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Waveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">Waveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">        Parameters[&#39;WG Length&#39;]: int/float</span>
<span class="sd">            Length of the Waveguide.</span>
<span class="sd">        Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">            Height of the Waveguide</span>
<span class="sd">        Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">            Width of the Waveguide</span>
<span class="sd">        Parameters[&#39;angle&#39;] : int</span>
<span class="sd">            Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">            For anfle = 90 we get a perfect rect!</span>
<span class="sd">        Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">            Slab height.</span>
<span class="sd">        Parameters[&#39;Material&#39;] : list</span>
<span class="sd">            List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">            Check the names in Lumerical Materials viewer.</span>
<span class="sd">                   </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>


        <span class="c1"># Material defginition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
            

        <span class="n">maxWGL</span> <span class="o">=</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">minWGL</span> <span class="o">=</span> <span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15e-6</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="mf">15e-6</span>
        <span class="c1"># Procentage deviation of the height between slab and waveguide</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">min_WGH</span> <span class="o">=</span> <span class="n">max_slabH</span>
        <span class="n">max_WGH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">min_BoxH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4e-6</span>
        

        <span class="c1"># Triangle EQ for waveguide Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_WGH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_WGH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Waveguide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Mesh_Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;based on a structure&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;override x mesh&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="mf">0.01e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="mf">0.005e-6</span><span class="p">)</span>

            <span class="c1"># Add SiO2 Slubstrate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Silicon&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_BoxH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
            

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Slab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Waveguide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Mesh_Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;based on a structure&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&#39;dx&#39;, 0.01e-6)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="mf">0.01e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="mf">0.005e-6</span><span class="p">)</span>

            <span class="c1"># Add SiO2 Box</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Silicon&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_BoxH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># Create Cladding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>

            




<div class="viewcode-block" id="Constructor.StraightWaveguide">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.StraightWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">StraightWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int float</span>
<span class="sd">                Substrate Height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Height of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of the Waveguide</span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                If Taper == False, only Waveguiedes will be constructed.</span>
<span class="sd">                If Taper == True, only an single Taper will be constructed</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Taper Length</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Taper backside width, the frontside width is the waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height.</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">                Bending angle of the Waveguide. Set it to 0 to simulate the straight waveguide. </span>
<span class="sd">                If Waveguide Angle is different then 0, then the straight waveguide will be tilted </span>
<span class="sd">                at the choosen degrees. </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;WG Length&quot;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">]</span>
        <span class="n">Side_Angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



            
            
        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">Side_Angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
    
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
    
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
    
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="c1"># Triangle EQ for waveguide Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
    
    
    
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Staight_WG&quot;</span><span class="p">]</span>
    
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">+</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Side_Angle</span><span class="p">)</span>
                
            
                <span class="c1"># # create_cover</span>
                <span class="c1"># self.lum.addrect()</span>
                <span class="c1"># self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
                <span class="c1"># self.lum.set(&quot;material&quot;, MaterialClad)</span>
                <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
                <span class="c1"># self.lum.set(&quot;y span&quot;, Device_Width)</span>
                <span class="c1"># self.lum.set(&quot;z min&quot;, min_slabH)</span>
                <span class="c1"># self.lum.set(&quot;z max&quot;, min_slabH*2)</span>
                <span class="c1"># self.lum.set(&quot;x&quot;, WG_Length / 2)</span>
                <span class="c1"># self.lum.set(&quot;x span&quot;, WG_Length)</span>
                <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, True)</span>
                <span class="c1"># self.lum.set(&quot;mesh order&quot;, 4)</span>
                <span class="c1"># self.lum.set(&quot;alpha&quot;, 0.7)</span>
    
    
    
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
    
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
    
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
    
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="c1"># Triangle EQ for waveguide Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
    
    
    
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Staight_WG&quot;</span><span class="p">]</span>
    
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Side_Angle</span><span class="p">)</span>
                
                
                
                
                <span class="c1"># # create_cover</span>
                <span class="c1"># self.lum.addrect()</span>
                <span class="c1"># self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
                <span class="c1"># self.lum.set(&quot;material&quot;, MaterialClad)</span>
                <span class="c1"># self.lum.set(&quot;y&quot;, WG_Length / 4)</span>
                <span class="c1"># self.lum.set(&quot;y span&quot;, Device_Width)</span>
                <span class="c1"># self.lum.set(&quot;z min&quot;, min_slabH)</span>
                <span class="c1"># self.lum.set(&quot;z max&quot;, min_slabH*2)</span>
                <span class="c1"># self.lum.set(&quot;x&quot;, WG_Length / 2)</span>
                <span class="c1"># self.lum.set(&quot;x span&quot;, WG_Length + WG_Width)</span>
                <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, True)</span>
                <span class="c1"># self.lum.set(&quot;mesh order&quot;, 4)</span>
                <span class="c1"># self.lum.set(&quot;alpha&quot;, 0.7)</span>
                
                
        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
            
            

            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
        
            <span class="c1"># Taper Widths on Bott Cal</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span>
            
            <span class="c1"># PWD Taper Hights</span>
            <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
            <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span>
            
            <span class="c1"># PWB Taper Length</span>
            <span class="n">TaperXmax</span> <span class="o">=</span>  <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">TaperXmin</span> <span class="o">=</span>  <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="c1"># Create PWB Taper</span>
            <span class="n">ymin_bot_l</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ymax_bot_l</span> <span class="o">=</span>    <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="n">ymin_bot_r</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ymax_bot_r</span> <span class="o">=</span>    <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="n">ymin_top_l</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ymax_top_l</span> <span class="o">=</span>    <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="n">ymin_top_r</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">ymax_top_r</span> <span class="o">=</span>    <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>

            

            <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                            <span class="p">])</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
            
        

            <span class="c1"># Send Values to Lumerical and create solid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Taper&quot;</span><span class="p">)</span></div>


            
            





<div class="viewcode-block" id="Constructor.BendWaveguide">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.BendWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">BendWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate Height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide Height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                Bending angle of the Waveguide. Set it to 0 to simulate the straight waveguide. </span>
<span class="sd">                If Waveguide Angle is different then 0, then the straight waveguide will be tilted </span>
<span class="sd">                at the choosen degrees. </span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;x span&quot;] : int/float</span>
<span class="sd">                Length of the S Curve. Span of the object.</span>
<span class="sd">            Parameters[&quot;y span&quot;] : int/float</span>
<span class="sd">                Height of the curve. Difference between the input and output of the S-curve.</span>
<span class="sd">            Parameters[&quot;poles&quot;] : boolen</span>
<span class="sd">                If Parameters[&quot;poles&quot;] = True an Bezier Curbe will be made.</span>
<span class="sd">                if Parameters[&quot;poles&quot;] = False an Cosinus Curve = y_span*(cos((pi/(2*x_span))*t)^2) will be made. Where</span>
<span class="sd">                t is in the range of 0 - y_span</span>
<span class="sd">                </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error Massage.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">polesList</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;poles&quot;</span><span class="p">]</span>
        
        
        
        <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">])</span><span class="o">-</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">],</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">y_span</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">x_span</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="c1"># Triangle EQ for waveguide Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        
        
        <span class="c1"># if polesList == None:  </span>
        <span class="c1">#     pole = np.array([[0, 0], [x_span / 2, 0], [x_span / 2, y_span], [x_span, y_span]])</span>
        <span class="c1">#     self.lum.set(&quot;poles&quot;, pole)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, MaterialWG)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     pole = np.array(polesList)</span>
        <span class="c1">#     self.lum.set(&quot;poles&quot;, pole)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, MaterialWG)</span>
            
        <span class="c1"># create_cover</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.ArcWaveguide">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ArcWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">ArcWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                Bending angle of the Waveguide. Set it to 0 to simulate the straight waveguide. </span>
<span class="sd">                If Waveguide Angle is different then 0, then the straight waveguide will be tilted </span>
<span class="sd">                at the choosen degrees. </span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="sd">                Radius of the Circle in um</span>
<span class="sd">            Parameters[&#39;Arc deg&#39;] : int</span>
<span class="sd">                Can be 90 or 180 for 1/4 of a cirle or 1/2 of a circle.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;S_Band Radius&quot;</span><span class="p">]</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Arc deg&#39;</span><span class="p">]</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>




        <span class="k">if</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="c1"># Device_Width = 2 * radius + WaveLength * 2 + WG_Width * 2  # MMI_Width</span>

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="c1"># max_subW = Device_Width / 2</span>
            <span class="c1"># min_subW = -Device_Width / 2</span>
            <span class="c1"># min_subL = 0</span>
            <span class="c1"># max_subL = radius</span>

            <span class="c1"># Device specifications</span>
            <span class="c1"># Device_Width = 2 * radius + WaveLength * 2 + WG_Width * 2  # MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="c1"># max_subW = Device_Width / 2</span>
            <span class="c1"># min_subW = -Device_Width / 2</span>
            <span class="c1"># min_subL = 0</span>
            <span class="c1"># max_subL = radius</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c1"># Triangle EQ for waveguide Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bend_Waveguide&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            
            <span class="c1"># # create_cover</span>
            <span class="c1"># self.lum.addrect()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, MaterialClad)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, radius * m)</span>
            <span class="c1"># self.lum.set(&quot;y span&quot;, m * radius * 2 + WG_Width)</span>
            <span class="c1"># self.lum.set(&quot;z min&quot;, max_slabH)</span>
            <span class="c1"># self.lum.set(&quot;z max&quot;, max_slabH*2)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, m * radius)</span>
            <span class="c1"># self.lum.set(&quot;x span&quot;, (m * radius * 2 + WG_Width))</span>
            <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, True)</span>
            <span class="c1"># self.lum.set(&quot;mesh order&quot;, 4)</span>
            <span class="c1"># self.lum.set(&quot;alpha&quot;, 0.7)</span>




        <span class="k">elif</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="c1"># Device_Width = 2 * radius + WaveLength * 2 + WG_Width * 2  # MMI_Width</span>

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c1"># Triangle EQ for waveguide Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arc_Waveguide1&#39;</span><span class="p">,</span> <span class="s1">&#39;Arc_Waveguie2&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span>
                 <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span>
                 <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
            
            
            <span class="c1"># # create_cover</span>
            <span class="c1"># self.lum.addrect()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, MaterialClad)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, radius * m)</span>
            <span class="c1"># self.lum.set(&quot;y span&quot;, m * radius * 2 + WG_Width)</span>
            <span class="c1"># self.lum.set(&quot;z min&quot;, max_slabH)</span>
            <span class="c1"># self.lum.set(&quot;z max&quot;, max_slabH*2)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;x span&quot;, (m * radius * 2 + WG_Width)*2)</span>
            <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, True)</span>
            <span class="c1"># self.lum.set(&quot;mesh order&quot;, 4)</span>
            <span class="c1"># self.lum.set(&quot;alpha&quot;, 0.7)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect Arc Value. The arc can only be an integer and can only be arc = 90 or arc = 180!&quot;</span><span class="p">)</span></div>

            




<div class="viewcode-block" id="Constructor.MMI2x2">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.MMI2x2">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                 Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of the MMI.</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI.</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Waveguide length.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                 Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                 Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                    Taper can be set to be True ot False.</span>
<span class="sd">                    if Taper == False - No Taper used</span>
<span class="sd">                    if Taper == True - Taper placed</span>
<span class="sd">                Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1">#Too Fara and Too close </span>
            <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> 

            
            
            <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">offset_WG2</span> <span class="o">&lt;</span><span class="mf">0.5e-6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
                


            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                <span class="c1"># Names of the WGs</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>




        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Delate the Structure to start new</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># creating the MMI</span>
            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

            <span class="c1"># New x Length of the Tapers</span>
            <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
            <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>
            <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># Taper Widths on Bott Cal</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span>
                            <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

            <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
            <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c1"># offset_Set_R = posOffset/2+TaperWidth/2</span>

            <span class="c1"># if OffsetInpit &lt;= OffMin or OffsetInpit &gt;= OffMax or posOffset &lt;= OffMin or posOffset &gt;= OffMax:</span>
            <span class="k">if</span> <span class="n">BotCornerDistance</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>



            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="c1"># xPos = [max_MMIL, max_MMIL, min_MMIL, min_MMIL]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                    <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                    <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                    <span class="p">])</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

                    <span class="c1"># Send Values to Lumerical and create solid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.MMI2x2_Trapez">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.MMI2x2_Trapez">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x2_Trapez</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                 Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of the MMI.</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI.</span>
<span class="sd">                Parameters[&#39;Middle MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI in the Middle Part due to inperfection by manufacturing</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Waveguide length.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                 Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                 Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                    Taper can be set to be True ot False.</span>
<span class="sd">                    if Taper == False - No Taper used</span>
<span class="sd">                    if Taper == True - Taper placed</span>
<span class="sd">                Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length2</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Middle MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        
        
        <span class="c1">#Create the MMI L2 Tapers for the Trapezoid</span>
        <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Trapez&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Trapez&quot;</span><span class="p">]</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>



        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1">#Too Fara and Too close </span>
            <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> 

            
            
            <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="n">offset_WG2</span> <span class="o">&lt;</span><span class="mf">0.5e-6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
                


            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                <span class="c1"># Names of the WGs</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>




        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Delate the Structure to start new</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># creating the MMI</span>
            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            
            
            <span class="c1">#Create the MMI L2 Tapers for the Trapezoid</span>
            <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Trapez&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Trapez&quot;</span><span class="p">]</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># New x Length of the Tapers</span>
            <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
            <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>
            <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_input_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_input_WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># Taper Widths on Bott Cal</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span>
                            <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

            <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
            <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c1"># offset_Set_R = posOffset/2+TaperWidth/2</span>

            <span class="c1"># if OffsetInpit &lt;= OffMin or OffsetInpit &gt;= OffMax or posOffset &lt;= OffMin or posOffset &gt;= OffMax:</span>
            <span class="k">if</span> <span class="n">BotCornerDistance</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>



            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="c1"># xPos = [max_MMIL, max_MMIL, min_MMIL, min_MMIL]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                    <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                    <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                    <span class="p">])</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

                    <span class="c1"># Send Values to Lumerical and create solid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.MMI2x1">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.MMI2x1">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of the MMI.</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI.</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                 Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Waveguide length.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                    Offset of the input waveguide.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                    Taper can be set to be True ot False.</span>
<span class="sd">                    if Taper == False - No Taper used</span>
<span class="sd">                    if Taper == True - Taper placed</span>
<span class="sd">                Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
        <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># if offset_WG2 &lt; 0.5e-6:</span>
        <span class="c1">#     self.lum.deleteall()</span>
        <span class="c1">#     raise ValueError(&#39;The distance between the Tapers is less then 1 um !&#39;)</span>
        <span class="c1"># else:</span>

        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># if offset_WG &gt; OffMax:</span>
            <span class="c1">#     self.lum.deleteall()</span>
            <span class="c1">#     raise ValueError(&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;)</span>
            <span class="c1"># else:</span>
            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># create loop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>




        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># if offset_Taper &gt; OffMax:</span>
            <span class="c1">#     self.lum.deleteall()</span>
            <span class="c1">#     raise ValueError(&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;)</span>
            <span class="c1"># else:</span>
            <span class="c1"># Delate the Structure to start new</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="c1"># creating the MMI</span>
            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>


            <span class="c1"># New x Length of the Tapers</span>
            <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
            <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>
            <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># Taper loop</span>
            <span class="c1"># Taper Widths on Bott Cal</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

            <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                <span class="p">])</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
                
            

                <span class="c1"># Send Values to Lumerical and create solid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># create loop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span>

        <span class="c1"># create_cover</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>

    
    
    
    
    


<div class="viewcode-block" id="Constructor.MMI2x1_Trapez">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.MMI2x1_Trapez">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x1_Trapez</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of the MMI.</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI.</span>
<span class="sd">                Parameters[&#39;Middle MMI Length&#39;]: int/float</span>
<span class="sd">                    Length of the MMI in the Middle Part due to inperfection by manufacturing</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                 Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Waveguide length.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                    Offset of the input waveguide.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                    Taper can be set to be True ot False.</span>
<span class="sd">                    if Taper == False - No Taper used</span>
<span class="sd">                    if Taper == True - Taper placed</span>
<span class="sd">                Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length2</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Middle MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        
        
        
        <span class="c1">#Create the MMI L2 Tapers for the Trapezoid</span>
        <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Trapez&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Trapez&quot;</span><span class="p">]</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        
        
        

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
        <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">offset_WG2</span> <span class="o">&lt;</span> <span class="mf">0.5e-6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>

                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>




            <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Delate the Structure to start new</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="c1"># Device specifications</span>
                    <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
                    <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

                    <span class="c1"># creating the substrate</span>
                    <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
                    <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
                    <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

                    <span class="c1"># creating the thin film</span>
                    <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                    <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                    <span class="c1"># creating the MMI</span>
                    <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
                    <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># Triangle EQ for MMI Width</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
                    
                    <span class="c1">#Create the MMI L2 Tapers for the Trapezoid</span>
                    <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Trapez&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Trapez&quot;</span><span class="p">]</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
                    <span class="c1"># self.lum.set(&quot;first axis&quot;, &quot;z&quot;)</span>
                    <span class="c1"># self.lum.set(&quot;rotation 1&quot;,angleTheta)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">MMI_Length2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


                    <span class="c1"># New x Length of the Tapers</span>
                    <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
                    <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_output_WG_R&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_input_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper_output_WG_R&#39;</span><span class="p">]</span>

                    <span class="c1"># Taper loop</span>
                    <span class="c1"># Taper Widths on Bott Cal</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                    <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

                    <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                    <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                        <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                        <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                        <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                        <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                        <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                        <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                        <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                        <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                        <span class="p">])</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
                        
                    

                        <span class="c1"># Send Values to Lumerical and create solid</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span>

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.DirectionalCoupler">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.DirectionalCoupler">[docs]</a>
    <span class="k">def</span> <span class="nf">DirectionalCoupler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters</span>
<span class="sd">                ----------</span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;Substrate Width&#39;] : int/float</span>
<span class="sd">                    Substrate Width.</span>
<span class="sd">                Parameters[&#39;DC Length&#39;] : int/float</span>
<span class="sd">                    Length of the directional coupler</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. The minimum distance between Waveguides is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Width&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">Substrate_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_bott</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Top_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom_WG&#39;</span><span class="p">]</span>

            <span class="c1"># create loop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_bott</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.WDM">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.WDM">[docs]</a>
    <span class="k">def</span> <span class="nf">WDM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of the MMI.</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of the MMI.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">             Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Waveguide length.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&#39;Angle Thetha&#39;] : </span>
<span class="sd">                Input and output angle of the waveguide. This is only temporally </span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Backside width of the Taper, frontside width is the waveguide width</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Length of the Taper. </span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                If Taper == False, no Taper will be placed with the Waveguides.</span>
<span class="sd">                If Taper == True, tapers will be placed with the waveguides</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span> 
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">angleTheta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Angle Thetha&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>

        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
        


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>

             
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
             
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
             
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
             
            <span class="c1"># creating the MMI</span>
            <span class="c1"># creating the MMI</span>

            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> 
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>


            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

             
            <span class="c1"># self.lum.addwaveguide()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;MMI&quot;)</span>
            <span class="c1"># self.lum.set(&quot;base height&quot;, max_MMIH)</span>
            <span class="c1"># self.lum.set(&quot;base angle&quot;, 90 - angle)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z&quot;, z_Offset)</span>
            <span class="c1"># pole = np.array([[max_MMIL, 0], [min_MMIL, 0]])</span>
            <span class="c1"># self.lum.set(&quot;poles&quot;, pole)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, MaterialWG)</span>
            <span class="c1"># self.lum.set(&quot;base width&quot;, MMI_Wid)</span>
            
            
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">xLen</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">Diff</span> <span class="o">=</span> <span class="n">WG_W</span> <span class="o">-</span> <span class="n">WG_Width</span>

            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># - xLen - Diff/2 #</span>
            <span class="n">Li</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">MMI_Width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">WaveLength</span>


            <span class="c1">#Creaate MMI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">-</span> <span class="n">xLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">xLen</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            
            <span class="c1"># Names of the WGs</span>
            <span class="n">Waveguides</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_Output&#39;</span><span class="p">]</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Waveguides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># -MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Waveguides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># + MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span><span class="p">)</span>


            <span class="c1"># Create Cladding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">,</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>



        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
            
            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> 
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>


            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
            
            <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Taper&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Taper&quot;</span><span class="p">]</span>
            <span class="n">Waveguides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_WG&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_WG&quot;</span><span class="p">]</span>
            
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
            
            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">xLen</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>  
            <span class="n">Diff</span> <span class="o">=</span> <span class="n">WG_W</span> <span class="o">-</span> <span class="n">WG_Width</span> 
            
            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># - xLen - Diff/2 #</span>
            <span class="n">Li</span> <span class="o">=</span><span class="p">(</span> <span class="mi">4</span><span class="o">*</span><span class="mf">2.5</span><span class="o">*</span><span class="n">MMI_Width</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">WaveLength</span>

             
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
             
            
             
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
           
            <span class="c1"># creating the MMI</span>
             
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">-</span>  <span class="n">xLen</span> <span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="o">-</span> <span class="n">xLen</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            
            
            
            

            
            <span class="c1"># Input and Output Tapers and WGs</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperWidth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span><span class="p">)</span>
            



            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Waveguides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span> <span class="p">)</span>



            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperWidth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>  <span class="c1">#+ MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span> <span class="p">)</span>
            
            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Waveguides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>  <span class="c1">#+ MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span><span class="p">)</span>

            <span class="c1"># Create Cladding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">,</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>

                
                
                
        
        
   
<div class="viewcode-block" id="Constructor.InverseTaper">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.InverseTaper">[docs]</a>
    <span class="k">def</span> <span class="nf">InverseTaper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">            List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">            Check the names in Lumerical Materials viewer.</span>
<span class="sd">        Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">            Substrate height.</span>
<span class="sd">        Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">            Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">            For anfle = 90 we get a perfect rect!</span>
<span class="sd">        Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">            Waveguide hight. Also the height of the MMI section</span>
<span class="sd">        Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">            Waveguide width. Also in this function and ONLY in this function this will be the </span>
<span class="sd">            ibverse Taper width!!!</span>
<span class="sd">        Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">            Slab height</span>
<span class="sd">        Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">            Inverse Taper Length</span>
<span class="sd">        Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">            Front Width of the inverse Taper!! In this Function and ONLY in this function, the </span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] is the frond width of the inverse Taper! </span>
<span class="sd">        Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">            Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding) </span>
<span class="sd">        Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">            Photonic Wire Bonding Height back side (to the Photonic Wire Bonding) </span>
<span class="sd">        Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="sd">            Photonic Wirebonding (PWB) Width front side (to the photonic waveguide) </span>
<span class="sd">        Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="sd">            Photonic Wire Bonding Height front side (to the photonic waveguide) </span>
<span class="sd">        Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">            Length of the Photonic Wire Bonding Taper          </span>
<span class="sd">        </span>
<span class="sd">            </span>
<span class="sd">    </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Front&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Front&#39;</span><span class="p">]</span>
        <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 3 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Material Photonic Wire Bonding&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
            <span class="n">MaterialPWB</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


        
        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        
        <span class="c1"># make substrate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span> <span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 10e-6)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB * 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
        
        <span class="c1"># Slab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mf">0e-12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 10e-6)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB * 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
        
        <span class="c1"># Names of the WGs</span>
        <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_PWB&#39;</span><span class="p">,</span> <span class="s1">&#39;Inverse_Taper&#39;</span><span class="p">]</span>
        
        <span class="c1"># Taper sideangle widths</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        


        
        <span class="c1"># PWD Taper Y-Parameters</span>
        <span class="n">PWB_TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        
        <span class="c1"># Inverse   Taper Y-Parameters</span>
        <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        

      
        
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span>
        
        <span class="c1"># PWD Taper Hights</span>
        <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
        <span class="n">TaperZmaxF</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">TaperHightF</span>
        <span class="n">TaperZmaxB</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">TaperHightB</span>
        
        <span class="c1"># Inverse Taper Hights</span>
        <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
        <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span>
        
        <span class="c1"># PWB Taper Length</span>
        <span class="n">PWB_TaperXmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">PWB_TaperXmax</span> <span class="o">=</span> <span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Inverse Taper Length</span>
        <span class="n">TaperXmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Create PWB Taper</span>
        <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 5</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 6</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 7</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 8</span>
                        <span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
        
        <span class="c1"># Send Values to Lumerical and create solid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialPWB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        
        <span class="c1"># Create Inverse Taper</span>
        <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                        <span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
        
        <span class="n">Offset_InvTaper</span> <span class="o">=</span> <span class="n">PWB_TaperXmin</span> <span class="o">+</span> <span class="n">TaperXmax</span>
        
        <span class="k">if</span> <span class="n">Offset_InvTaper</span> <span class="o">-</span> <span class="n">TaperXmax</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">PWB_TaperXmax</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Inverse Taper is moved outside the PWB Taper! The maximal x-Offset of the Inverse Taper is Parameters[&#39;Offset Inverse Taper&#39;] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">PWB_TaperXmax</span> <span class="o">+</span> <span class="n">TaperXmax</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Send Values to Lumerical and create solid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;second axis&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rotation 2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">Offset_InvTaper</span><span class="p">)</span>
        
        
        <span class="c1"># Make Sqered WG-Extention of the PWB for mode Calculations</span>
        
        <span class="c1"># Extra Waveguide Lenght</span>
        <span class="n">Ext_WGLength</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="n">PWD_x_Offset</span> <span class="o">=</span> <span class="n">PWB_TaperXmin</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x min&#39;</span><span class="p">,</span> <span class="n">PWD_x_Offset</span> <span class="o">-</span> <span class="n">Ext_WGLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x max&#39;</span><span class="p">,</span><span class="n">PWD_x_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">TaperWidthB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;WG_Extention_PWB&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialPWB</span><span class="p">)</span>
        
        <span class="c1"># Make Sqred WG-Extention for the inverse Taper</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">Offset_InvTaper</span> <span class="o">+</span> <span class="n">TaperXmax</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span>  <span class="n">PWB_TaperXmax</span> <span class="o">+</span> <span class="n">Ext_WGLength</span> 
        <span class="n">center</span> <span class="o">=</span> <span class="n">TaperXmax</span> <span class="o">+</span> <span class="n">Offset_InvTaper</span>
        
        <span class="n">ZOffset_WG</span> <span class="o">=</span> <span class="n">TaperZmin</span><span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;WG_Extention_Inverse_Taper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">center</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">ZOffset_WG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span></div>








<div class="viewcode-block" id="Constructor.CascadetMMI">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.CascadetMMI">[docs]</a>
    <span class="k">def</span> <span class="nf">CascadetMMI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">SpaceX</span><span class="p">,</span> <span class="n">SpaceY</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">polesList</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;poles&quot;</span><span class="p">]</span>
        
        
        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceX</span> <span class="p">)</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WaveLength</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">SpaceY</span>   <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate_Main&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab_Main&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
        


        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        
        <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
        <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        

        <span class="n">names_MMI</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMI_In&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI_Out1&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI_Out2&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names_MMI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
        <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">offset_WG2</span> <span class="o">&lt;</span> <span class="mf">0.5e-6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                    
                    
                                
                    <span class="c1"># Create two Bends Cos or Bezier depending on the poles option</span>
                    <span class="n">x_span</span> <span class="o">=</span> <span class="n">SpaceX</span>
                    <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                    
                    
                    <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>
        
        
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend_Top&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bend_Bot&quot;</span><span class="p">]</span>
                    <span class="n">S_Bend_X_Offset</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="n">WG_Length</span><span class="p">),</span> <span class="p">(</span><span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">)]</span>
                    <span class="n">S_Bend_Y_Offset</span> <span class="o">=</span> <span class="p">[(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="p">(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">z_rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span>
                    <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="n">pole1</span><span class="p">,</span> <span class="n">pole</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">S_Bend_X_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">S_Bend_Y_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">z_rotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        
                        

                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names1</span><span class="p">,</span> <span class="n">names2</span><span class="p">,</span> <span class="n">names3</span><span class="p">]</span>

                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>




            <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Delate the Structure to start new</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="c1"># Device specifications</span>
              
                
                    <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceX</span> 
                    <span class="n">Device_Width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WaveLength</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">SpaceY</span>  <span class="c1"># MMI_Width</span>

                    <span class="c1"># creating the substrate</span>
                    <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
                    <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
                    <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">max_subL</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate_Main&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

                    <span class="c1"># creating the thin film</span>
                    <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                    <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab_Mian&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
                    

                    <span class="c1"># creating the MMI</span>
                    <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
                    <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>

                    <span class="c1"># Triangle EQ for MMI Width</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                    
                    
                    <span class="n">Parameters__Position_X</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                    
                    <span class="n">names_MMI</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMI_In&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI_Out1&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI_Out2&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names_MMI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>


                    <span class="c1"># New x Length of the Tapers</span>
                    <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
                    <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>


                    <span class="c1"># Taper loop</span>
                    <span class="c1"># Taper Widths on Bott Cal</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                    <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

                    <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                    <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    
                    
                    <span class="c1"># Create two Bends Cos or Bezier depending on the poles option</span>
                    <span class="n">x_span</span> <span class="o">=</span> <span class="n">SpaceX</span>
                    <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                    
                    
                    <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>
        
        
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend_Top&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bend_Bot&quot;</span><span class="p">]</span>
                    <span class="n">S_Bend_X_Offset</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">),</span> <span class="p">(</span><span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">)]</span>
                    <span class="n">S_Bend_Y_Offset</span> <span class="o">=</span> <span class="p">[(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="p">(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">z_rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span>
                    <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="n">pole1</span><span class="p">,</span> <span class="n">pole</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">S_Bend_X_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">S_Bend_Y_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">z_rotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    
                    <span class="n">TapersNames1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI_Taper_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Taper_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Taper_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1_Taper_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Taper_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Taper_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2_Taper_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_Taper_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_Taper_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">TapersNames1</span><span class="p">,</span> <span class="n">TapersNames2</span><span class="p">,</span> <span class="n">TapersNames3</span><span class="p">]</span>
                    
                    
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                            <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>
    
                            <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                            <span class="p">])</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
                            
                        
    
                            <span class="c1"># Send Values to Lumerical and create solid</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            
                    <span class="c1"># Names of the WGs</span>
                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1_Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2_In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2_In_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names1</span><span class="p">,</span> <span class="n">names2</span><span class="p">,</span> <span class="n">names3</span><span class="p">]</span>
                    


                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span>
        
            

            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>

        
        
        
        
       
        
        
     
            

 
                

    <span class="c1"># =============================================================================</span>
    <span class="c1"># Functions for the solvers</span>
    <span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="Constructor.setStraightWaveguideFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setStraightWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setStraightWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">               Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                   Substrate height.</span>
<span class="sd">               Parameters[&#39;WG Lrngth&#39;] : int/float</span>
<span class="sd">                   Waveguide Length</span>
<span class="sd">               Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                   Waveguide hight. Also the height of the MMI section</span>
<span class="sd">               Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                   Waveguide width. </span>
<span class="sd">               Parameters[&quot;Taper&quot;] : boolen</span>
<span class="sd">                   If Taper == False, only straight Waveguide will be simulated, </span>
<span class="sd">                   If Taper == True an Taper will be simulated </span>
<span class="sd">               Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                   Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="sd">               Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                   Taper Length</span>
<span class="sd">               Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                     EME Mesh resolutio,</span>
<span class="sd">               Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                   Height of the slab.</span>
<span class="sd">               Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                   Wavelength</span>
<span class="sd">               Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">                   This Parameter will set the theta ratation angle of the port. It can be 90 or 180. </span>
<span class="sd">               Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                   List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">               Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>




        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">WG_Length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>




        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    
                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    
    
                <span class="c1"># Define Ports</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">EME_WGLength</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
    
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
    
    
    
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
                <span class="c1"># Add Movie monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
    
                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    
            <span class="k">else</span><span class="p">:</span>
    
                <span class="c1"># Calc Output Loc</span>
                <span class="n">sideLength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span> <span class="n">WG_Length</span>
                <span class="n">sideHight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">WG_Length</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sideLength</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
              
                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
    
                <span class="c1"># Define Ports</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">EME_WGLength</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">sideHight</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>
    
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
                <span class="c1"># Add Movie monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
    
                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                
                
                
        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            
            <span class="c1"># Adds a FDTD Solver</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>



            <span class="c1"># Define Ports</span>
            <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span> 
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span> <span class="mf">0.1e-6</span> <span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                <span class="c1"># Power Monitor Port 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            
            <span class="c1"># Add Movie monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setArcWaveguideFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setArcWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setArcWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">               Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                   Substrate height.</span>
<span class="sd">               Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                   Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                   Waveguide width.</span>
<span class="sd">                Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                     EME Mesh resolutio,</span>
<span class="sd">               Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                   Height of the slab.</span>
<span class="sd">               Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                   Wavelength</span>
<span class="sd">                Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="sd">                   S-Bend Radius in um.</span>
<span class="sd">               Parameters[&#39;Arc deg&#39;] : int/float</span>
<span class="sd">                   Arc define the Arc of the curve. It can be 90 or 180 degrees only.</span>
<span class="sd">                   This two will define an 1/4 of a circle or 1/2 of a circle.</span>
<span class="sd">              Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>




<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;S_Band Radius&quot;</span><span class="p">]</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Arc deg&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>



        <span class="k">if</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>

            <span class="c1"># Device dimentions</span>
            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            


            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend orientation&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>


            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend orientation&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span>

            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend orientation&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setBendWaveguideFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setBendWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setBendWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">               Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                   Substrate height.</span>
<span class="sd">               Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                   Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                   Waveguide width.</span>
<span class="sd">                Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                     EME Mesh resolutio,</span>
<span class="sd">               Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                   Height of the slab.</span>
<span class="sd">               Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                   Wavelength</span>
<span class="sd">               Parameters[&quot;x span&quot;] : int/float</span>
<span class="sd">                   Length of the S-Bend Waveguide</span>
<span class="sd">               Parameters[&quot;y span&quot;] : int/float</span>
<span class="sd">                   Width of the S-Bend Waveguide</span>
<span class="sd">               Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">               Parameters[&quot;Port Span&quot;][0] : int/float</span>
<span class="sd">                   Span of Port in x direction</span>
<span class="sd">               Parameters[&quot;Port Span&quot;][1] : int/float</span>
<span class="sd">                   Span of Port in y direction</span>
<span class="sd">               Parameters[&quot;Port Span&quot;][2] ; int/float</span>
<span class="sd">                   Span of Port in z direction</span>
<span class="sd">                   </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">x_span</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">y_span</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_span</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


        <span class="c1"># Power Monitor Port 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Power Monitor Port 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">x_span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>



        <span class="c1"># Add Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;FieldMonitor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">x_span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setMMI2x2FDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI2x2FDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x2FDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of MMI</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of MMI</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Heigth of waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Width og waveguide</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Length of waveguide</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength.</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>



<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        
        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
   
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
    
            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
    
    
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 
    
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
    
    
            <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    
                <span class="c1"># Power Monitor Port 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
                <span class="c1"># Ports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
    
            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
           
        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
    
            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
    
    
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 
    
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
    
    
            <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    
                <span class="c1"># Power Monitor Port 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
                <span class="c1"># Ports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
    
            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>

            




<div class="viewcode-block" id="Constructor.setMMI2x1FDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI2x1FDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x1FDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of MMI</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of MMI</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Heigth of waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Width og waveguide</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Length of waveguide</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                    Input waveguide/taper offset.</span>
<span class="sd">                Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength.</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">    </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">    </span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>

        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        
        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            
    
    
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="c1"># Ports_mid = Substrate_Height + Slab_Height + WG_Height / 2</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># WG_H = WG_Height</span>
        
            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
            <span class="c1"># Positions of the Input and Output WGs</span>
            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
        
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_Port_Span_old</span> <span class="o">=</span> <span class="n">y_Port_Span</span>
                <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = </span><span class="si">{</span><span class="n">y_Port_Span_old</span><span class="si">}</span><span class="s2"> to y_span_new = </span><span class="si">{</span><span class="n">y_Port_Span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># raise ValueError(&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YOu are in the else part Now&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>

                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        
        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="c1"># WG_H = WG_Height</span>
        
            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
            <span class="c1"># Positions of the Input and Output WGs</span>
            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
        
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_Port_Span_old</span> <span class="o">=</span> <span class="n">y_Port_Span</span>
                <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = </span><span class="si">{</span><span class="n">y_Port_Span_old</span><span class="si">}</span><span class="s2"> to y_span_new = </span><span class="si">{</span><span class="n">y_Port_Span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># raise ValueError(&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>

                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>

            


<div class="viewcode-block" id="Constructor.setDCFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setDCFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setDCFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="sd">                    Height of the Substrate</span>
<span class="sd">                Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="sd">                    Width of the MMI</span>
<span class="sd">                Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="sd">                    Length of the Directional coupler</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="sd">                    Height of the Waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="sd">                    Waveguide Width</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="sd">                    Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="sd">                    will be offset of the middle position (y = 0) by the half of there</span>
<span class="sd">                    Width. In this case they will not overlap if the Offset is 0.</span>
<span class="sd">                Parameters[&#39;x res&#39;] : float/int</span>
<span class="sd">                    Mesh resolution for the x-Axis</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="sd">                    Slab height.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Width&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">Substrate_Width</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
        <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
        
        <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            
            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Add Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

        
        
        
        
        
<div class="viewcode-block" id="Constructor.setCascadetMMIFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setCascadetMMIFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setCascadetMMIFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">SpaceX</span><span class="p">,</span> <span class="n">SpaceY</span><span class="p">):</span>
        
        
            <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
            <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
            <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
    
            <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
            <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
            <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
            <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
            <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
            <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
            <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
            <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
            <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
            <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
            <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
            <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            
            
            
            <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                
        
        
                <span class="c1"># Device specifications</span>
                <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span>
                <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceY</span><span class="c1"># MMI_Width</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
                <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="c1"># Ports_mid = Substrate_Height + Slab_Height + WG_Height / 2</span>
                <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
                <span class="c1"># WG_H = WG_Height</span>
            
                <span class="n">x_Offset</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="n">WG_Length</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
                <span class="c1"># Positions of the Input and Output WGs</span>
                <span class="c1"># Triangle EQ for MMI Width</span>

                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> 
                <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)]</span>
                <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="p">)</span>  <span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">)]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Bot&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Bot&#39;</span><span class="p">]</span>
                
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">+</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span><span class="o">-</span> <span class="n">posOffset</span> <span class="o">-</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                
                <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
                <span class="c1"># if overLapp &lt; 0:</span>
                <span class="c1">#     y_Port_Span_old = y_Port_Span</span>
                <span class="c1">#     y_Port_Span = yPort_vec[2]*2</span>
                <span class="c1">#     print((f&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = {y_Port_Span_old} to y_span_new = {y_Port_Span}&quot;))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



            
            <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                
     
                <span class="c1"># Device specifications</span>
                <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span><span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="n">SpaceX</span>
                <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceY</span><span class="c1"># MMI_Width</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
                <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
                <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="c1"># WG_H = WG_Height</span>
                <span class="n">x_Offset</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">TaperLength</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
                <span class="c1"># Positions of the Input and Output WGs</span>
                <span class="c1"># Triangle EQ for MMI Width</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> 
                <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)]</span>
                <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">TaperLength</span> <span class="p">)</span>  <span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">)]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Bot&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Bot&#39;</span><span class="p">]</span>
                
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">+</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span><span class="o">-</span> <span class="n">posOffset</span> <span class="o">-</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                
                
                <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


              

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>

            
            
            





    <span class="c1"># def setWDMFDTDSolver(self, Parameters):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>


    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     Parameters : Dictionary</span>
    <span class="c1">#         Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
    <span class="c1">#             Parameters</span>
    <span class="c1">#             ----------</span>
    <span class="c1">#             Parameters[&#39;Substrate Height&#39;] : int/float</span>
    <span class="c1">#                 Substrate height.</span>
    <span class="c1">#             Parameters[&#39;MMI Width&#39;] : int/float</span>
    <span class="c1">#                 Width of the MMI.</span>
    <span class="c1">#             Parameters[&#39;MMI Length&#39;] : int/float</span>
    <span class="c1">#                 Length of the MMI.</span>
    <span class="c1">#             Parameters[&#39;WG Height&#39; : int/float</span>
    <span class="c1">#                 Waveguide hight. Also the height of the MMI section</span>
    <span class="c1">#             Parameters[&#39;WG Width&#39;] : int/float</span>
    <span class="c1">#                 Waveguide width.</span>
    <span class="c1">#             Parameters[&#39;WG Length&#39;] : int/float</span>
    <span class="c1">#                 Waveguide length.</span>
    <span class="c1">#             Parameters[&#39;y res&#39;] : int/float</span>
    <span class="c1">#                 Mesh y-Axis</span>
    <span class="c1">#             Parameters[&#39;z res&#39;] : int/float</span>
    <span class="c1">#                 Mesh z-Axis</span>
    <span class="c1">#             Parameters[&#39;Slab Height&#39;] : int/float</span>
    <span class="c1">#                 Slab Height.</span>
    <span class="c1">#             Parameters[&#39;Wavelength&#39;] : int/float</span>
    <span class="c1">#                 Wavelength</span>
    <span class="c1">#             Parameters[&#39;Angle Thetha&#39;] : boolen</span>
    <span class="c1">#                 Angle for the input and output waveguides</span>
    <span class="c1">#             Parameters[&quot;Mode&quot;] : str</span>
    <span class="c1">#                 Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     None.</span>

    <span class="c1">#     &#39;&#39;&#39;</span>

    <span class="c1">#     Substrate_Height = Parameters[&#39;Substrate Height&#39;]</span>
    <span class="c1">#     MMI_Width = Parameters[&#39;MMI Width&#39;]</span>
    <span class="c1">#     MMI_Length = Parameters[&#39;MMI Length&#39;]</span>
    <span class="c1">#     WG_Height = Parameters[&#39;WG Height&#39;]</span>
    <span class="c1">#     WG_Width = Parameters[&#39;WG Width&#39;]</span>
    <span class="c1">#     WG_Length = Parameters[&#39;WG Length&#39;]</span>
    <span class="c1">#     y_res = Parameters[&#39;y res&#39;]</span>
    <span class="c1">#     z_res = Parameters[&#39;z res&#39;]</span>
    <span class="c1">#     Slab_Height = Parameters[&#39;Slab Height&#39;]</span>
    <span class="c1">#     WaveLength = Parameters[&#39;Wavelength&#39;]</span>
    <span class="c1">#     angleTheta = Parameters[&#39;Angle Thetha&#39;]</span>
    <span class="c1">#     Mode = Parameters[&quot;Mode&quot;]</span>


    <span class="c1">#     # Device specifications</span>
    <span class="c1">#     Device_Length = MMI_Length + 2 * WG_Length</span>
    <span class="c1">#     Device_Width = MMI_Width + 2*(WG_Length) + WaveLength * 2  # MMI_Width</span>
    <span class="c1">#     max_slabH = Slab_Height</span>
    <span class="c1">#     MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
    <span class="c1">#     Ports_mid = (max_slabH + WG_Height) / 2</span>

    <span class="c1">#     # Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
    <span class="c1">#     self.lum.addeme()</span>
    <span class="c1">#     self.lum.set(&#39;simulation temperature&#39;, 273.15 + 20)</span>
    <span class="c1">#     self.lum.set(&quot;x min&quot;, 1e-6)</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, Device_Width)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Substrate_Height)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 4e-6)</span>
    <span class="c1">#     self.lum.set(&quot;wavelength&quot;, WaveLength)</span>
    <span class="c1">#     self.lum.set(&quot;z min bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;z max bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;y min bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;y max bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     # set cell properties</span>
    <span class="c1">#     self.lum.set(&quot;number of cell groups&quot;, 3)</span>
    <span class="c1">#     self.lum.set(&quot;group spans&quot;, np.array([[WG_Length - 1e-6], [MMI_Length], [WG_Length - 1e-6]]))</span>
    <span class="c1">#     self.lum.set(&quot;cells&quot;, np.array([[3], [3], [3]]))</span>
    <span class="c1">#     self.lum.set(&quot;subcell method&quot;, np.array([[0], [0], [0]]))</span>

    <span class="c1">#     # Modes to Calculate</span>
    <span class="c1">#     self.lum.set(&#39;number of modes for all cell groups&#39;, 20)</span>

    <span class="c1">#     # Mesh Cells</span>
    <span class="c1">#     self.lum.set(&quot;define y mesh by&quot;, &quot;maximum mesh step&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;dy&quot;, y_res)</span>
    <span class="c1">#     self.lum.set(&quot;define z mesh by&quot;, &quot;maximum mesh step&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;dz&quot;, z_res)</span>
    <span class="c1">#     self.lum.set(&#39;fit materials with multi-coefficient model&#39;, 1)</span>
    <span class="c1">#     self.lum.set(&#39;wavelength start&#39;, 0.4e-6)</span>
    <span class="c1">#     self.lum.set(&#39;wavelength stop&#39;, 2e-6)</span>

    <span class="c1">#     # max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
    <span class="c1">#     # min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>

    <span class="c1">#     Input_yPos = -MMI_Width / 2 + WG_Width / 2</span>
    <span class="c1">#     y = WG_Length * np.tan(angleTheta * np.pi / 180)</span>
    <span class="c1">#     Input_Y = Input_yPos - y + WG_Width</span>

    <span class="c1">#     Output_yPos = MMI_Width / 2 - WG_Width / 2</span>
    <span class="c1">#     y2 = WG_Length * np.tan(angleTheta * np.pi / 180)</span>
    <span class="c1">#     Output_Y = Output_yPos + y2 - WG_Width / 2</span>
    <span class="c1">#     portLoc = [&quot;left&quot;, &quot;right&quot;]</span>

    <span class="c1">#     self.lum.select(&quot;EME::Ports::port_&quot; + str(1))</span>
    <span class="c1">#     self.lum.set(&quot;port location&quot;, portLoc[0])</span>
    <span class="c1">#     self.lum.set(&quot;use full simulation span&quot;, 0)</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, min_yPos[1])</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, max_yPos[1])</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, Input_Y)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, WG_Width + 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Ports_mid)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;mode selection&quot;, Mode)</span>
    <span class="c1">#     self.lum.set(&quot;theta&quot;, angleTheta)</span>

    <span class="c1">#     self.lum.select(&quot;EME::Ports::port_&quot; + str(2))</span>
    <span class="c1">#     self.lum.set(&quot;port location&quot;, portLoc[1])</span>
    <span class="c1">#     self.lum.set(&quot;use full simulation span&quot;, 0)</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, min_yPos[2])</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, max_yPos[2])</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, Output_Y)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, WG_Width + 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Ports_mid)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;mode selection&quot;, Mode)</span>
    <span class="c1">#     self.lum.set(&quot;theta&quot;, angleTheta)</span>

    <span class="c1">#     # Add monitor</span>
    <span class="c1">#     # x_MMI = Device_Length / 2</span>
    <span class="c1">#     self.lum.addemeprofile()</span>
    <span class="c1">#     self.lum.set(&quot;x&quot;, Device_Length / 2)</span>
    <span class="c1">#     self.lum.set(&quot;x span&quot;, Device_Length)</span>
    <span class="c1">#     # self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
    <span class="c1">#     # self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, Device_Width )</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, -Device_Width / 2)</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, Device_Width / 2)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, MonitorHeight)</span>





<div class="viewcode-block" id="Constructor.setStraightWaveguideEMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setStraightWaveguideEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setStraightWaveguideEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">               Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                   Substrate height.</span>
<span class="sd">               Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                   Waveguide hight. Also the height of the MMI section</span>
<span class="sd">               Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                   Waveguide length</span>
<span class="sd">               Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                   Waveguide width</span>
<span class="sd">               Parameters[&quot;Taper&quot;] : boolen</span>
<span class="sd">                   If Taper == False, only straight Waveguide will be simulated, </span>
<span class="sd">                   If Taper == True an Taper will be simulated </span>
<span class="sd">               Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                   Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="sd">               Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                   Taper Length</span>
<span class="sd">               Parameters[&#39;y res&#39;]: int/float</span>
<span class="sd">                     EME Mesh resolutio,</span>
<span class="sd">               Parameters[&#39;y res&#39;]: int/float</span>
<span class="sd">                     EME Mesh resolutio,</span>
<span class="sd">               Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                   Height of the slab.</span>
<span class="sd">               Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                   Wavelength</span>
<span class="sd">               Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">                   This Parameter will set the theta ratation angle of the port.</span>
<span class="sd">               Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                   List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">               Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>




<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>



        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>




        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> 
        <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">WG_Length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
    
                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>
    
                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    
                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
    
                <span class="c1"># Define Ports</span>
    
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
    
    
            <span class="k">else</span><span class="p">:</span>
    
                <span class="c1"># Calc Output Loc</span>
                <span class="n">sideLength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span> <span class="n">WG_Length</span>
                <span class="n">sideHight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">WG_Length</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sideLength</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
    
                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>
    
                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    
                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
    
    
    
                <span class="c1"># Define Ports</span>
    
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">sideHight</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>
    
    
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                
                
                
        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            
            
            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span> <span class="o">-</span> <span class="mf">0.2e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>

            <span class="c1"># Modes to Calculate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

            <span class="c1"># Mesh Cells</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

            <span class="c1"># Define Ports       </span>
            <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span> 
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">]</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>

            
            






<div class="viewcode-block" id="Constructor.setDCEMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setDCEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setDCEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="sd">                    Height of the Substrate</span>
<span class="sd">                Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="sd">                    Width of the MMI</span>
<span class="sd">                Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="sd">                    Length of the Directional coupler</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="sd">                    Height of the Waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="sd">                    Waveguide Width</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="sd">                    Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="sd">                    will be offset of the middle position (y = 0) by the half of there</span>
<span class="sd">                    Width. In this case they will not overlap if the Offset is 0.</span>
<span class="sd">                Parameters[&#39;y res&#39;] : float/int</span>
<span class="sd">                    Mesh resolution for the y-Axis</span>
<span class="sd">                Parameters[&#39;z res&#39;] : float/int</span>
<span class="sd">                    Mesh resolution for the z Axis</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="sd">                    Slab height.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="sd">                    Wavelength</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                    List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        
        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">DC_Lenght</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># Define Ports</span>
        <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        
        <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span> 

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Add monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.setMMI2x1EMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI2x1EMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x1EMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of MMI</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of MMI</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Heigth of waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Width og waveguide</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Length of waveguide</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                    Input waveguide/taper offset.</span>
<span class="sd">                Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength.</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                    List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># 1x2 MMI</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="c1"># set cell properties no Taper</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># 1x2 MMI</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Set_R</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">&lt;=</span> <span class="n">OffMin</span> <span class="ow">or</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">&gt;=</span> <span class="n">OffMax</span> <span class="ow">or</span> <span class="n">offset_Set_R</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;You are Trying to move the input or output Waveguide outside the MMI area. This is not possible! Max Input/Output Offset = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">OffMax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; and Min Input/output Offset = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OffMin</span><span class="p">))</span>


        <span class="c1"># Define Ports</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if OffsetInput &gt; 0:</span>
            <span class="c1">#     max_yPos = [(OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [0, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>
            <span class="c1"># elif OffsetInput &lt; 0:</span>
            <span class="c1">#     max_yPos = [0, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [-(abs(OffsetInput)) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>

            <span class="c1"># else:</span>
            <span class="c1">#     max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>
            
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">]</span>
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="c1"># self.lum.set(&quot;y min&quot;, min_yPos[i])</span>
                <span class="c1"># self.lum.set(&quot;y max&quot;, max_yPos[i])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Define the Motinot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.setMMI2x2EMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI2x2EMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x2EMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of MMI</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of MMI</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Heigth of waveguide</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Width og waveguide</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Length of waveguide</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                    Mesh cell size.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength.</span>
<span class="sd">                Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                    List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>



<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="c1"># x_res            = Parameters[&#39;x res&#39;]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>




        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>


            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># define two values for upper and lower limit of the WG offsets</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">posOffset</span> <span class="o">&lt;=</span> <span class="n">OffMin</span> <span class="ow">or</span> <span class="n">posOffset</span> <span class="o">&gt;=</span> <span class="n">OffMax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define Ports</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
            
            
            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span> 
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.setWDMEMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setWDMEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setWDMEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">            Substrate height.</span>
<span class="sd">        Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">            Width of the MMI.</span>
<span class="sd">        Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">            Length of the MMI.</span>
<span class="sd">        Parameters[&#39;WG Height&#39; : int/float</span>
<span class="sd">            Waveguide hight. Also the height of the MMI section</span>
<span class="sd">        Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">            Waveguide length.</span>
<span class="sd">        Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">            Waveguide width.</span>
<span class="sd">        Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">            Taper backside width, frontside width is the waveguide width.</span>
<span class="sd">        Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">            Taper Length</span>
<span class="sd">        Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">            Mesh y-Axis</span>
<span class="sd">        Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">            Mesh z-Axis</span>
<span class="sd">        Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">            Slab Height.</span>
<span class="sd">        Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">            Wavelength</span>
<span class="sd">        Parameters[&#39;Angle Thetha&#39;] : boolen</span>
<span class="sd">            Angle for the input and output waveguides</span>
<span class="sd">        Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">            Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">         Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">            List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>



<span class="sd">            Raises</span>
<span class="sd">            ------</span>
<span class="sd">            ValueError</span>
<span class="sd">                DESCRIPTION.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None.</span>

<span class="sd">                &#39;&#39;&#39;</span>
                
        

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">angleTheta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Angle Thetha&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="c1"># Device_Width = MMI_Width + 2*WG_Length + WaveLength * 2  # MMI_Width</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
        <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span>


        <span class="c1"># EME Boundary Length</span>
        <span class="n">BoardLen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">TaperLength</span>
        <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">BoardLen</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">BoardLen</span> <span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">BoardLen</span> <span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">15</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
        <span class="c1"># min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>


        <span class="k">if</span> <span class="n">angleTheta</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">Input_yPos</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>   <span class="c1"># Correction factor so that Ports are in the WG 0.1e-6</span>
            <span class="n">Input_Y</span> <span class="o">=</span> <span class="n">Input_yPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>


            <span class="n">Output_yPos</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span><span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span> 
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="n">Output_yPos</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>




            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Input_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Output_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
            <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            
            
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># - xLen - Diff/2 #</span>

            <span class="n">Input_yPos</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Corr</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Input_Y</span> <span class="o">=</span> <span class="n">NewY</span> <span class="o">-</span> <span class="n">difY</span><span class="o">/</span><span class="mi">2</span>


            <span class="n">Output_yPos</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span> 
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="n">Output_yPos</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">WG_Width</span>
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="o">-</span><span class="n">NewY</span> <span class="o">+</span> <span class="n">difY</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>




            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Input_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="o">*</span><span class="mi">3</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Output_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="o">*</span><span class="mi">3</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
            <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>

            
                





<div class="viewcode-block" id="Constructor.setInverseTaperEMESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setInverseTaperEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setInverseTaperEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Parameters</span>
<span class="sd">          ----------</span>
<span class="sd">          Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">              Substrate height.</span>
<span class="sd">          Parameters[&#39;WG Height&#39; : int/float</span>
<span class="sd">              Waveguide hight. Also the height of the MMI section</span>
<span class="sd">          Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">              Waveguide width.</span>
<span class="sd">          Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">              Slab height</span>
<span class="sd">          Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">              Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding) </span>
<span class="sd">          Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">              Photonic Wire Bonding Height back side (to the Photonic Wire Bonding) </span>
<span class="sd">          Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">              Length of the Photonic Wire Bonding Taper      </span>
<span class="sd">          Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">              Mesh y-Axis</span>
<span class="sd">          Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">              Mesh z-Axis</span>
<span class="sd">          Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">              Wavelength</span>
<span class="sd">          Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">              Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">          Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">              List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
        <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    
    
        <span class="c1"># # Device specifications</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Ports_PWB_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightB</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5e-6</span>
    
    
    
        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">TaperWidthB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#Substrate_Height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength_PWB</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.9e-6</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
    
        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    
        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
    
    
        <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="n">z_span_PWB</span> <span class="o">=</span> <span class="n">TaperHightB</span> <span class="o">+</span> <span class="p">(</span><span class="n">z_Port_Span</span> <span class="o">-</span> <span class="n">WG_Height</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;use full simulation span&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, TaperWidthB + y_Port_Span/2)</span>
        <span class="c1"># self.lum.set(&quot;z&quot;, Ports_PWB_mid)</span>
        <span class="c1"># self.lum.set(&quot;z span&quot;, z_span_PWB)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;use full simulation span&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, y_Port_Span)</span>
        <span class="c1"># self.lum.set(&quot;z&quot;, Ports_mid)</span>
        <span class="c1"># self.lum.set(&quot;z span&quot;, z_Port_Span)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
    
    
    
        <span class="c1"># Add monitor Horizondal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB+11e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span> <span class="o">-</span> <span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">15e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        
        
        <span class="c1"># Add monitor Vertical   </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D Y-normal&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB+11e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span> <span class="o">-</span> <span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">15e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, TaperWidthB*2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span></div>








<div class="viewcode-block" id="Constructor.setMMI1x2VarFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI1x2VarFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI1x2VarFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Slab_Height : int/float</span>
<span class="sd">            Height of the slab.</span>
<span class="sd">        MMI_Width : int/float</span>
<span class="sd">            Width of MMI</span>
<span class="sd">        MMI_Length : int/float</span>
<span class="sd">            Length of MMI</span>
<span class="sd">        angle : int/float</span>
<span class="sd">            Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">            For anfle = 90 we get a perfect rect!</span>
<span class="sd">        WG_Height : int/float</span>
<span class="sd">            Heigth of waveguide</span>
<span class="sd">        WG_Width : int/float</span>
<span class="sd">            Width og waveguide</span>
<span class="sd">        WG_Length : int/float</span>
<span class="sd">            Length of waveguide</span>
<span class="sd">        posOffset : int/float</span>
<span class="sd">            Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">            betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">            the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">            becouse of manufactering restrictions in the University.</span>
<span class="sd">        OffsetInpit : int/float</span>
<span class="sd">            Input waveguide/taper offset.</span>
<span class="sd">        y_res : int/float</span>
<span class="sd">            Mesh cell sizes.</span>
<span class="sd">        z_res : int/float</span>
<span class="sd">            Mesh cell size.</span>
<span class="sd">        Slab_Height : int/float</span>
<span class="sd">            Height of the slab.</span>
<span class="sd">        WaveLength : int/float</span>
<span class="sd">            Wavelength.</span>
<span class="sd">        Taper : boolen, optional</span>
<span class="sd">            Defoult Taper == False</span>
<span class="sd">                if Taper == True Simulation region will ajust for simulation with tapers</span>
<span class="sd">        TaperLength : int/float</span>
<span class="sd">            Length of taper.</span>
<span class="sd">        Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Lnoi_H</span> <span class="o">=</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">WG_H</span> <span class="o">=</span> <span class="n">WG_Height</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addvarfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of test points&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># define two values for upper and lower limit of the WG offsets</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_H</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_H</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="n">offset_Set_R</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">xPos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">]</span>
        <span class="n">yPos_min</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodesource</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1e-7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;override global source settings&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos_min</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


        <span class="c1"># # Add monitor</span>
        <span class="c1"># self.lum.addpower()</span>
        <span class="c1"># self.lum.set(&#39;monitor type&#39;, &#39;2D X-normal&#39;)</span>
        <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>
        <span class="c1"># self.lum.set(&quot;y min&quot;, -Device_Width / 2)</span>
        <span class="c1"># self.lum.set(&quot;y max&quot;, Device_Width / 2)</span>
        <span class="c1"># self.lum.set(&quot;z&quot;, MonitorHeight)</span>



<div class="viewcode-block" id="Constructor.setMMI2x2VarFDTDSolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setMMI2x2VarFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x2VarFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Slab_Height : int/float</span>
<span class="sd">            Height of the slab.</span>
<span class="sd">        MMI_Width : int/float</span>
<span class="sd">            Width of MMI</span>
<span class="sd">        MMI_Length : int/float</span>
<span class="sd">            Length of MMI</span>
<span class="sd">        angle : int/float</span>
<span class="sd">            Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">            For anfle = 90 we get a perfect rect!</span>
<span class="sd">        WG_Height : int/float</span>
<span class="sd">            Heigth of waveguide</span>
<span class="sd">        WG_Width : int/float</span>
<span class="sd">            Width og waveguide</span>
<span class="sd">        WG_Length : int/float</span>
<span class="sd">            Length of waveguide</span>
<span class="sd">        posOffset : int/float</span>
<span class="sd">            Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">            betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">            the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">            becouse of manufactering restrictions in the University.</span>
<span class="sd">        OffsetInpit : int/float</span>
<span class="sd">            Input waveguide/taper offset.</span>
<span class="sd">        y_res : int/float</span>
<span class="sd">            Mesh cell sizes.</span>
<span class="sd">        z_res : int/float</span>
<span class="sd">            Mesh cell size.</span>
<span class="sd">        Slab_Height : int/float</span>
<span class="sd">            Height of the slab.</span>
<span class="sd">        WaveLength : int/float</span>
<span class="sd">            Wavelength.</span>
<span class="sd">        Taper : boolen, optional</span>
<span class="sd">            Defoult Taper == False</span>
<span class="sd">                if Taper == True Simulation region will ajust for simulation with tapers</span>
<span class="sd">        TaperLength : int/float</span>
<span class="sd">            Length of taper.</span>
<span class="sd">        Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                    Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Lnoi_H</span> <span class="o">=</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">WG_H</span> <span class="o">=</span> <span class="n">WG_Height</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addvarfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of test points&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># define two values for upper and lower limit of the WG offsets</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_H</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_H</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="n">offset_Set_R</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">xPos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">,</span>
                <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">]</span>
        <span class="n">yPos_min</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodesource</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1e-7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;override global source settings&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos_min</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>


        <span class="c1"># # Add monitor</span>
        <span class="c1"># self.lum.addpower()</span>
        <span class="c1"># self.lum.set(&#39;monitor type&#39;, &#39;2D X-normal&#39;)</span>
        <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>
        <span class="c1"># self.lum.set(&quot;y min&quot;, -Device_Width / 2)</span>
        <span class="c1"># self.lum.set(&quot;y max&quot;, Device_Width / 2)</span>
        <span class="c1"># self.lum.set(&quot;z&quot;, MonitorHeight)</span>




<div class="viewcode-block" id="Constructor.setWaveguideFDESolver">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.setWaveguideFDESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setWaveguideFDESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Heigth of waveguide</span>
<span class="sd">                Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                    Mesh cell sizes.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                    Wavelength.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>

        <span class="c1"># FDE Dimensions</span>
        <span class="n">WG_Mid</span> <span class="o">=</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfde</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;solver type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D X normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define y mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define z mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">WG_Mid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span></div>






    <span class="c1"># =============================================================================</span>
    <span class="c1"># Functions</span>
    <span class="c1"># =============================================================================</span>
    
    
<div class="viewcode-block" id="Constructor.StartEMESimulation">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.StartEMESimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartEMESimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;emepropagation&#39; of the mode 1 port 1</span>
<span class="sd">        will be done.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">emepropagate</span><span class="p">()</span></div>





<div class="viewcode-block" id="Constructor.StartFDTDSimulation">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.StartFDTDSimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFDTDSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;emepropagation&#39; of the mode 1 port 1</span>
<span class="sd">        will be done.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

        
        
        

<div class="viewcode-block" id="Constructor.StartFDESimulation">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.StartFDESimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFDESimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;findmodes&#39; will simulate all 20 modes</span>
<span class="sd">        that are set by defoult to be calculated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">findmodes</span><span class="p">()</span></div>





<div class="viewcode-block" id="Constructor.ExtractFDTDResults">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ExtractFDTDResults">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDTDResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ports</span><span class="p">,</span> <span class="n">Sparam</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This fuction will add an S-Parameter Sweep to the FDTD simulation.</span>
<span class="sd">        This will allowed to sweep the S-parameter Matrix like it is done in</span>
<span class="sd">        EMe solver. Additionally will extract the Power on each port according to the time</span>
<span class="sd">        monitors that ware set in the solver functions.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">Sparam</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addsweep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="c1"># Check &quot;Excite all ports&quot; option</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">setsweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">,</span> <span class="s2">&quot;Excite all ports&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
            <span class="c1"># run s-parameter sweep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">runsweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">)</span>

            <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">Power</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getsweepresult</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">,</span> <span class="s2">&quot;S matrix&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deletesweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span><span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Port number in ExtractFDTD() Function. Possible Port Numbers are int: 3 or 4! &quot;</span><span class="p">)</span>
            <span class="c1"># S21 = abs(OptionsEME1[&#39;S&#39;][0][2])**2</span>
            <span class="c1"># S31 = abs(OptionsEME1[&#39;S&#39;][0][1])**2</span>
            <span class="k">return</span> <span class="n">OptionsEME1</span><span class="p">,</span> <span class="n">Power</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">Power</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Incorect Port number in ExtractFDTD() Function. Possible Port Numbers are int: 3 or 4! &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Power</span></div>






<div class="viewcode-block" id="Constructor.ExtractEMEResults">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ExtractEMEResults">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractEMEResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="n">EMEName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        MonitorName : str</span>
<span class="sd">            The name of the monitor. By defoult the name will be &#39;monitor&#39;.</span>
<span class="sd">            So MonitorName = &#39;monitor&#39; can be used. In case of change in the name</span>
<span class="sd">            the new name of the monitor should be given.</span>
<span class="sd">        EMEName : str</span>
<span class="sd">            The name of the solver. In this case per defoult will be EMEName =</span>
<span class="sd">            &#39;EME&#39;. In case of change in the name, the new name should be given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OptionsMonitor : dict</span>
<span class="sd">            Dictionary with:</span>
<span class="sd">                    &#39;lambda&#39;</span>
<span class="sd">                    &#39;f&#39;</span>
<span class="sd">                    &#39;x&#39;</span>
<span class="sd">                    &#39;y&#39;</span>
<span class="sd">                    &#39;z&#39;</span>
<span class="sd">                    &#39;E&#39;</span>
<span class="sd">                    &#39;H&#39;</span>
<span class="sd">                    &#39;Lumerical_dataset&#39;</span>
<span class="sd">        EME_Data : dict</span>
<span class="sd">            Dictionary with:</span>
<span class="sd">                    &#39;user s matrix&#39;</span>
<span class="sd">                    &#39;internal s matrix&#39;</span>
<span class="sd">                    &#39;local diagnostics&#39;</span>
<span class="sd">                    &#39;coefficients&#39;</span>
<span class="sd">                    &#39;global diagnostics&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Define List with all the data from monitor and EME</span>
        <span class="n">EME_Data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Check all avaliable variables for the monitor and EME</span>
        <span class="n">OptionsMonitor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">),</span> <span class="s1">&#39;field profile&#39;</span><span class="p">)</span>
        <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EMEName</span><span class="p">))</span>
        <span class="n">OptionsEME</span> <span class="o">=</span> <span class="n">OptionsEME1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">OptionsEME</span><span class="p">:</span>
            <span class="n">EME_Data</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EMEName</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span></div>

    
    
    

<div class="viewcode-block" id="Constructor.ExtractFDEModes">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ExtractFDEModes">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDEModes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EffIndexValue</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EffIndexValue : float/int</span>
<span class="sd">            Effective index value. All modes with effective index smaller then</span>
<span class="sd">            the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="sd">            index from the hole construction (usualy the cladding).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictData : dict</span>
<span class="sd">                 Dictionary with the modes polarization numbers</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dictModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictModes2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">modeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                    <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                  <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                      <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes2</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                   <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">return</span> <span class="n">dictModes</span><span class="p">,</span> <span class="n">dictModes2</span></div>

    
    

<div class="viewcode-block" id="Constructor.CoppyDcard">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.CoppyDcard">[docs]</a>
    <span class="k">def</span> <span class="nf">CoppyDcard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeTE</span><span class="p">,</span> <span class="n">modeTM</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        modeTE : str</span>
<span class="sd">            The TE mode that will be copy to dCard to do the overlap analysis.</span>

<span class="sd">        modeTM : str</span>
<span class="sd">           The TM mode that will be copy to dCard to do the overlap analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">copydcard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">modeTE</span><span class="p">),</span> <span class="s1">&#39;TE&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">copydcard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">modeTM</span><span class="p">),</span> <span class="s1">&#39;TM&#39;</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.Overlap">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.Overlap">[docs]</a>
    <span class="k">def</span> <span class="nf">Overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TEModes : dict</span>
<span class="sd">            Dictionary of TE - Modes.</span>
<span class="sd">        dictDataTE : dict</span>
<span class="sd">            Dictionary of TE - Modes E field values</span>
<span class="sd">        SweepDictTE : dict</span>
<span class="sd">            Dictionary of TE - Modes:</span>
<span class="sd">                    1) overlap Procentage</span>
<span class="sd">                    2) TE polarization fraction number</span>
<span class="sd">                    3) TE polarization fraction</span>
<span class="sd">                    4) loss</span>
<span class="sd">                    5) Ex</span>
<span class="sd">                    6) Ey</span>
<span class="sd">                    7) Ez</span>

<span class="sd">        TMModes : dict</span>
<span class="sd">            Dictionary of TM - Modes..</span>
<span class="sd">        dictDataTM : dict</span>
<span class="sd">            Dictionary of TM - Modes E field values.</span>
<span class="sd">        SweepDictTM : dict</span>
<span class="sd">            Dictionary of TM - Modes:</span>
<span class="sd">                    1) overlap Procentage</span>
<span class="sd">                    2) TE polarization fraction number</span>
<span class="sd">                    3) TE polarization fraction</span>
<span class="sd">                    4) loss</span>
<span class="sd">                    5) Ex</span>
<span class="sd">                    6) Ey</span>
<span class="sd">                    7) Ez</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">numModes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="n">TEModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictDataTE</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">SweepDictTE</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">TMModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictDataTM</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">SweepDictTM</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">numModes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; overlap Procentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                <span class="n">TEModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                      <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                          <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="n">dictDataTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">numModes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; overlap Procentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                <span class="n">TMModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                      <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                          <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="n">dictDataTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">TEModes</span><span class="p">,</span> <span class="n">dictDataTE</span><span class="p">,</span> <span class="n">SweepDictTE</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">dictDataTM</span><span class="p">,</span> <span class="n">SweepDictTM</span></div>





<div class="viewcode-block" id="Constructor.ExtractFDEResultsExtendet">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Constructor.ExtractFDEResultsExtendet">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDEResultsExtendet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EffIndexValue</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EffIndexValue : float/int</span>
<span class="sd">            Effective index value. All modes with effective index smaller then</span>
<span class="sd">            the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="sd">            index from the hole construction (usualy the cladding).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictModes : dict</span>
<span class="sd">                Dictionary with:</span>
<span class="sd">                        &#39;TE polarization fraction num&#39;</span>
<span class="sd">                        &#39;effective area&#39;</span>
<span class="sd">                        &#39;effective index num&#39;</span>
<span class="sd">                        &#39;group index num&#39;</span>
<span class="sd">                        &#39;Ex&#39;</span>
<span class="sd">                        &#39;Ey&#39;</span>
<span class="sd">                        &#39;Ez&#39;</span>

<span class="sd">        dictData : dict</span>
<span class="sd">                 Dictionary with:</span>
<span class="sd">                             &#39;E&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dictModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictModes2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictData2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">modeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                    <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                      <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                    <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>  <span class="c1"># 1.45625:</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                           <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; group index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;ng&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                      <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                            <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; group index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;ng&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dictModes</span><span class="p">,</span> <span class="n">dictData</span><span class="p">,</span> <span class="n">dictModes2</span><span class="p">,</span> <span class="n">dictData2</span></div>
</div>








<div class="viewcode-block" id="HelpSubject">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject">[docs]</a>
<span class="k">class</span> <span class="nc">HelpSubject</span><span class="p">:</span>
    
<div class="viewcode-block" id="HelpSubject.Help_Objects">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_Objects">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Help_Objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                  </span>
<span class="s2">                  Parameters for each object are given as dictionary!</span>
<span class="s2">                  </span>
<span class="s2">                  1) Waveguide(Parameters)</span>
<span class="s2">            </span>
<span class="s2">                    Parameters[&#39;WG Length&#39;]: int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  2) StraightWaveguide(Parameters)</span>
<span class="s2">                                                     </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used, only waveguide will be used</span>
<span class="s2">                        if Taper == True - Taper placed, no waveguides only taper will be used</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside width, the frontside width is the waveguide width</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height.</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                        Tilting angle of the Waveguide. Set it to 0 to simulate the straight waveguide. </span>
<span class="s2">                        If Waveguide Angle is different then 0, then the straight waveguide will be tilted </span>
<span class="s2">                        at the choosen angle. </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  3) BendWaveguide(Parameters)  </span>
<span class="s2">        </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;x span&quot;] : int/float</span>
<span class="s2">                        Length of the S Curve. Span of the object in x direction.</span>
<span class="s2">                    Parameters[&quot;y span&quot;] : int/float</span>
<span class="s2">                        Height of the curve. Span (difference between the input and output ports) of the S-curve in y direction.</span>
<span class="s2">                    Parameters[&quot;poles&quot;] : boolen</span>
<span class="s2">                        If Parameters[&quot;poles&quot;] = True an Bezier Curbe will be made.</span>
<span class="s2">                        if Parameters[&quot;poles&quot;] = False an Cosinus Curve = y_span*(cos((pi/(2*x_span))*t)^2) will be made. Where</span>
<span class="s2">                        t is in the range of 0 - y_span</span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  4) ArcWaveguide(Parameters) </span>
<span class="s2">        </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="s2">                        Radius of the Circle. The Radius is given in um. </span>
<span class="s2">                    Parameters[&#39;Arc deg&#39;] : int</span>
<span class="s2">                        Can be 90 or 180 for 1/4 of a cirle or 1/2 of a circle.</span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  5) MMI2x1(Parameters)    </span>
<span class="s2">                    </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth).</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used</span>
<span class="s2">                        if Taper == True - Taper placed</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                        Offset of the input waveguide.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  6) MMI2x2(Parameters)   </span>
<span class="s2">    </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth). This is also the</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used</span>
<span class="s2">                        if Taper == True - Taper placed</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given. </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  7) WDM(Parameters)</span>
<span class="s2">                                              </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                        </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                       Substrate Height</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                         Height of the Waveguide (Etching depth). This is also the</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                         Top width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                         Waveguide length. For the moment please choose the Parameters[&#39;WG Length&#39;] to be 1e-6 bigger then Parameters[&#39;Taper Length&#39;]!!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Angle Thetha&#39;] : </span>
<span class="s2">                        Input and output angle of the waveguide. This is the rotation angle of the waveguide and taper. </span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used</span>
<span class="s2">                        if Taper == True - Taper placed</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given. </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                  8) InverseTaper(Paraemters)                                                                      </span>

<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 3 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Photonic Wire Bonding&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;, &#39;Si (Silicon) - Palik&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                       Substrate Height</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth). This is also the</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the waveguide. Also in this function and ONLY in this function this will be the </span>
<span class="s2">                        ibverse Taper backside width!!!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Inverse Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Front Width of the inverse Taper!! In this Function and ONLY in this function, the </span>
<span class="s2">                        Parameters[&#39;Taper Width&#39;] is the frond width of the inverse Taper! </span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height back side (to the Photonic Wire Bonding) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width front side (to the waveguide) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height front side (to the waveguide) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                        Length of the Photonic Wire Bonding Taper       </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">                9) MMI2x1_Trapez(Parameters)    </span>
<span class="s2">                  </span>
<span class="s2">                  Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                      List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                      Check the names in Lumerical Materials viewer.</span>
<span class="s2">                      The List of materials must contain at least 2 materials! </span>
<span class="s2">                      Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                      For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                  Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                      Substrate Height</span>
<span class="s2">                  Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                      Top width of the MMI.</span>
<span class="s2">                  Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                      Length of the MMI.</span>
<span class="s2">                  Parameters[&#39;Middle MMI Length&#39;]: int/float</span>
<span class="s2">                      Length of the MMI in the Middle Part due to inperfection by manufacturing</span>
<span class="s2">                  Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                      Height of the LiNbO3 Slab</span>
<span class="s2">                  Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                      Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                      For angle = 90 , a perfect rect is created!</span>
<span class="s2">                  Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                      Height of the Waveguide (Etching depth).</span>
<span class="s2">                  Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                      Top width of the Waveguide.</span>
<span class="s2">                  Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                      Waveguide length</span>
<span class="s2">                  Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                      Taper can be set to be True ot False.</span>
<span class="s2">                      if Taper == False - No Taper used</span>
<span class="s2">                      if Taper == True - Taper placed</span>
<span class="s2">                  Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                      Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                      betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                      the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                      becouse of manufactering restrictions in the University.</span>
<span class="s2">                  Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                      Offset of the input waveguide.</span>
<span class="s2">                  Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                      Wavelength</span>
<span class="s2">                  Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                      If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                      this will be ignored and some random value can be given.</span>
<span class="s2">                  Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                      If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                      this will be ignored and some random value can be given.</span>
<span class="s2">                      </span>
<span class="s2">                      </span>
<span class="s2">                      </span>
<span class="s2">                10) MMI2x2_Trapez(Parameters)   </span>
<span class="s2">  </span>
<span class="s2">                  Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                      List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                      Check the names in Lumerical Materials viewer.</span>
<span class="s2">                      The List of materials must contain at least 2 materials! </span>
<span class="s2">                      Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                      For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                  Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                      Substrate Height</span>
<span class="s2">                  Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                      Top width of the MMI.</span>
<span class="s2">                  Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                      Length of the MMI.</span>
<span class="s2">                  Parameters[&#39;Middle MMI Length&#39;]: int/float</span>
<span class="s2">                      Length of the MMI in the Middle Part due to inperfection by manufacturing</span>
<span class="s2">                  Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                      Height of the LiNbO3 Slab</span>
<span class="s2">                  Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                      Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                      For angle = 90 , a perfect rect is created!</span>
<span class="s2">                  Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                      Height of the Waveguide (Etching depth). This is also the</span>
<span class="s2">                  Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                      Top width of the Waveguide.</span>
<span class="s2">                  Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                      Waveguide length</span>
<span class="s2">                  Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                      Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                      betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                      the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                      becouse of manufactering restrictions in the University.</span>
<span class="s2">                  Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                      Wavelength</span>
<span class="s2">                  Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                      Taper can be set to be True ot False.</span>
<span class="s2">                      if Taper == False - No Taper used</span>
<span class="s2">                      if Taper == True - Taper placed</span>
<span class="s2">                  Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                      If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                      this will be ignored and some random value can be given.</span>
<span class="s2">                  Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                      If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                      this will be ignored and some random value can be given.</span>
<span class="s2">                        </span>
<span class="s2">                  </span>
<span class="s2">                  &quot;&quot;&quot;</span><span class="p">)</span></div>

                  
                  
<div class="viewcode-block" id="HelpSubject.Help_Solvers">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_Solvers">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_Solvers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">         </span>
<span class="s2">                  1) Solver(&quot;Waveguide&quot;, &quot;FDE&quot;,  Parameters)                                                        </span>
<span class="s2">                                                                                                                    </span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float                                                                 </span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.                       </span>
<span class="s2">                        For angle = 90 , a perfect rect is created!                                                 </span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float                                                             </span>
<span class="s2">                        Height of the Waveguide (Etching depth).                                                    </span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float                                                                 </span>
<span class="s2">                        Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)       </span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float                                                                 </span>
<span class="s2">                        Maximum mesh step setting in z direction. (Size of the Mesh Box in y direction in um)       </span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float                                                           </span>
<span class="s2">                        Height of the LiNbO3 Slab                                                                    </span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float                                                            </span>
<span class="s2">                        Wavelength.                                                                                  </span>
<span class="s2">        </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  2) Solver(&quot;MMI2x1&quot;, &quot;EME&quot;, Parameters) and Solver(&quot;MMI2x2&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                    </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                        </span>
<span class="s2">                    Only for 2x1MMI !!!!!</span>
<span class="s2">                        Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                            Input waveguide/taper offset.</span>
<span class="s2">                    </span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Maximum mesh step setting in z direction. (Size of the Mesh Box in z direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  3) Solver(&#39;DirectionalCoupler&#39;, &#39;EME&#39;, Parameters)</span>
<span class="s2">        </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="s2">                        Height of the Substrate</span>
<span class="s2">                    Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="s2">                        Width of the Substrate</span>
<span class="s2">                    Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="s2">                        Length of the Directional Coupler</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="s2">                        Top width of the Waveguide </span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="s2">                        Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="s2">                        will be offset of the middle position (y = 0) by the half of there</span>
<span class="s2">                        Width. In this case they will not overlap if the Offset is 0.</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : float/int</span>
<span class="s2">                        Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : float/int</span>
<span class="s2">                        Maximum mesh step setting in z direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  4) Solver(&quot;StraightWaveguide&quot;, &quot;EME&quot;,  Parameters)  </span>
<span class="s2">                     </span>
<span class="s2">                                                       </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used, only waveguide will be used</span>
<span class="s2">                        if Taper == True - Taper placed, no waveguides only taper will be used</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside top waveguide width, the frontside top width of the waveguide is the waveguide top width</span>
<span class="s2">                    Parameters[&#39;y res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in z direction. (Size of the Mesh Box in z direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                        This Parameter will set the theta ratation angle of the port. Please choose the same angle as you gave for the Object StraightWaveguide!</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken, since we use x cut material.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                         Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                         </span>
<span class="s2">                    </span>
<span class="s2">                    </span>
<span class="s2">                  5) Solver(&quot;WDM&quot;, &quot;EME&quot;,  Parameters)</span>
<span class="s2">                                                </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside top width of the waveguide, the frontside width is the top width of the waveguide</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;y res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in z direction. (Size of the Mesh Box in z direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab Height.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Angle Thetha&#39;] : boolen</span>
<span class="s2">                        Input and output angle of the waveguide. This is the rotation angle of the waveguide and taper. </span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken, since we use x cut material.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                         Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;) </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">                  6) Solver(&quot;InverseTaper&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                                                  </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab Height.</span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height back side (to the Photonic Wire Bonding) </span>
<span class="s2">                    Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                        Length of the Photonic Wire Bonding Taper      </span>
<span class="s2">                    Parameters[&#39;y res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;]: int/float</span>
<span class="s2">                          Maximum mesh step setting in z direction. (Size of the Mesh Box in z direction in um)</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken, since we use x cut material.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                         Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;) </span>
<span class="s2">                         </span>
<span class="s2">      </span>
<span class="s2">                    </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  7) Solver(&quot;MMI2x1&quot;, &quot;FDTD&quot;, Parameters) and Solver(&quot;MMI2x2&quot;, &quot;FDTD&quot;, Parameters) </span>
<span class="s2">        </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39; : int/float</span>
<span class="s2">                        Waveguide hight</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length.</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Maximum mesh step setting in y direction. (Size of the Mesh Box in y direction in um)</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Maximum mesh step setting in z direction. (Size of the Mesh Box in z direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Angle Thetha&#39;] : int/float</span>
<span class="s2">                        Angle for the input and output waveguides </span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                   </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  8) Solver(&quot;MMI2x1&quot;, &quot;FDTD&quot;, Parameters) and Solver(&quot;MMI2x2&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                    </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Top width of the MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of the waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    </span>
<span class="s2">                    Only for 2x1MMI !!!!!</span>
<span class="s2">                        Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                            Input waveguide/taper offset.</span>
<span class="s2">         </span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                        Minimum mesh step setting in x direction. (Size of the Mesh Box in x direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  9) Solver(&quot;StraightWaveguide&quot;, &quot;FDTD&quot;,  Parameters)    </span>
<span class="s2">                             </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide Length</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used, only waveguide will be used</span>
<span class="s2">                        if Taper == True - Taper placed, no waveguides only taper will be used</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside top width of the waveguide, the frontside width is the top width of the waveguide</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                          Minimum mesh step setting in x direction. (Size of the Mesh Box in x direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                        This Parameter will set the theta ratation angle of the port</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                         Mode to analyse. (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                                         </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  10) Solver(&quot;ArcWaveguide&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                               </span>
<span class="s2">                     Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                         Substrate height.</span>
<span class="s2">                     Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                         Waveguide hight</span>
<span class="s2">                     Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                         Top width of the Waveguide.</span>
<span class="s2">                     Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                         Minimum mesh step setting in x direction. (Size of the Mesh Box in x direction in um)</span>
<span class="s2">                     Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                         Height of the LiNbO3 Slab</span>
<span class="s2">                     Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                         Wavelength</span>
<span class="s2">                     Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="s2">                         S-Bend Radius in um.</span>
<span class="s2">                     Parameters[&#39;Arc deg&#39;] : int/float</span>
<span class="s2">                         Arc define the Arc of the curve. It can be 90 or 180 degrees only.</span>
<span class="s2">                         This two will define an 1/4 of a circle or 1/2 of a circle.</span>
<span class="s2">                     Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                          Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                                                    </span>
<span class="s2">                    </span>
<span class="s2">        </span>
<span class="s2">                  11) Solver(&quot;BendWaveguide&quot;, &quot;FDTD&quot;, Parameters)    </span>
<span class="s2">                               </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                        Minimum mesh step setting in x direction. (Size of the Mesh Box in x direction in um)</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the LiNbO3 Slab</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;x span&quot;] : int/float</span>
<span class="s2">                        Length of the S-Bend Waveguide</span>
<span class="s2">                    Parameters[&quot;y span&quot;] : int/float</span>
<span class="s2">                        Width of the S-Bend Waveguide</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                         Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken, since we use x cut material.</span>
<span class="s2">                        </span>
<span class="s2">                   </span>
<span class="s2">                               </span>
<span class="s2">        </span>
<span class="s2">              &quot;&quot;&quot;</span><span class="p">)</span></div>

              
<div class="viewcode-block" id="HelpSubject.Help_StartSimulation">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_StartSimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_StartSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span>
<span class="s2">              Depending on the Solver Type (&quot;EME&quot; or &quot;FDTD&quot;) simulation can be started with:</span>
<span class="s2">                  </span>
<span class="s2">                  - For &quot;EME&quot; Solver </span>
<span class="s2">                  1) StartFDESimulation() </span>
<span class="s2">                  2) StartEMESimulation()</span>
<span class="s2">                           </span>
<span class="s2">                  - For &quot;FDTD&quot; Solver</span>
<span class="s2">                  3) StartFDTDSimulation()</span>
<span class="s2">             </span>
<span class="s2">        </span>
<span class="s2">              &quot;&quot;&quot;</span><span class="p">)</span></div>

              
              
              
              
<div class="viewcode-block" id="HelpSubject.Help_Results">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_Results">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_Results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">             Data can be Extracted from an FDE, EME or FDTD simulation. The Data will be writen in dictionaries!</span>
<span class="s2">             </span>
<span class="s2">             </span>
<span class="s2">    ############################################   FDE   ############################################</span>
<span class="s2">             After an FDE Simulation the user can:</span>
<span class="s2">                 </span>
<span class="s2">                 - Performe an Mode Overlap analisys. </span>
<span class="s2">                 Here an Waveguide with an choosen Parameters[] will be placed in the FDE solver. </span>
<span class="s2">                 Mode analysis is performed and the two fundamental modes TE and TM modes will be clipped to the Lumerical Board.</span>
<span class="s2">                 After the simulation the object will be removed. The two modes stay clipped to the board. </span>
<span class="s2">                 The user can then place an new Waveguide and performe and FDE Analysis. After the analysis </span>
<span class="s2">                 the modes can be compaired (overlapped) in Lumerical with the already clipped modes from the </span>
<span class="s2">                 first simulation. </span>
<span class="s2">    </span>
<span class="s2">                 With - OverlapFDEModes(Parameters)</span>
<span class="s2">                 Parameters[&quot;Effective Index&quot;] = Reflective Effektive index for the Material, Effective index value. </span>
<span class="s2">                 All modes with effective index smaller then the  Effective will be deleted. Effective is usualy the </span>
<span class="s2">                 smalles effective index from the hole construction (usualy the cladding). Since Lumerical will produce </span>
<span class="s2">                 modes with very small Effektive index, it make no sance to extract them !</span>
<span class="s2">                 </span>
<span class="s2">                </span>
<span class="s2">                </span>
<span class="s2">                </span>
<span class="s2">                 </span>
<span class="s2">                 - Extract Results from Simulation.</span>
<span class="s2">                 </span>
<span class="s2">                 With - ExtrtactData(&#39;FDE&#39;, Parameters)</span>
<span class="s2">                 </span>
<span class="s2">                 </span>
<span class="s2">                 Parameters[&quot;Effective Index&quot;] : float/int</span>
<span class="s2">                     Effective index value. All modes with effective index smaller then</span>
<span class="s2">                     the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="s2">                     index from the hole construction (usualy the cladding). Since Lumerical will produce </span>
<span class="s2">                     modes with very small Effektive index, it make no sance to extract them !</span>
<span class="s2">                     </span>
<span class="s2">                 Returns</span>
<span class="s2">                 -------</span>
<span class="s2">                 dictModesTE : dict</span>
<span class="s2">                         Dictionary with:</span>
<span class="s2">                                 &#39;TE polarization fraction num&#39;</span>
<span class="s2">                                 &#39;effective area&#39;</span>
<span class="s2">                                 &#39;effective index num&#39;</span>
<span class="s2">                                 &#39;group index num&#39;</span>
<span class="s2">                                 &#39;Ex&#39;</span>
<span class="s2">                                 &#39;Ey&#39;</span>
<span class="s2">                                 &#39;Ez&#39;</span>
<span class="s2">                                 </span>
<span class="s2">                 dictDataTE : dict</span>
<span class="s2">                         Dictionary with:</span>
<span class="s2">                                     &#39;E&#39;</span>
<span class="s2">                                     </span>
<span class="s2">                                     </span>
<span class="s2">                dictModesTM : dict</span>
<span class="s2">                        Dictionary with:</span>
<span class="s2">                                &#39;TE polarization fraction num&#39;</span>
<span class="s2">                                &#39;effective area&#39;</span>
<span class="s2">                                &#39;effective index num&#39;</span>
<span class="s2">                                &#39;group index num&#39;</span>
<span class="s2">                                &#39;Ex&#39;</span>
<span class="s2">                                &#39;Ey&#39;</span>
<span class="s2">                                &#39;Ez&#39;</span>
<span class="s2">                                </span>
<span class="s2">                dictDataTM : dict</span>
<span class="s2">                        Dictionary with:</span>
<span class="s2">                                    &#39;E&#39;</span>
<span class="s2">                    </span>
<span class="s2">    ############################################   FDE   ############################################</span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    ############################################   EME   ############################################</span>
<span class="s2">    </span>
<span class="s2">             After an EME Simulation the user can:</span>
<span class="s2">                 </span>
<span class="s2">                 </span>
<span class="s2">             - Extract all the data providet from the simulation.</span>
<span class="s2">             </span>
<span class="s2">             </span>
<span class="s2">               With - ExtrtactData(&#39;EME&#39;, Parameters)  </span>
<span class="s2">               </span>
<span class="s2">               Parameters here is an dummy variable, since you already give all the needed Parameter by the </span>
<span class="s2">               object and solver. They will be automatically taken for the result extraction.</span>
<span class="s2">    </span>
<span class="s2">               Returns</span>
<span class="s2">               -------</span>
<span class="s2">               MonitorData : dict</span>
<span class="s2">                   Dictionary with:</span>
<span class="s2">                           &#39;lambda&#39;</span>
<span class="s2">                           &#39;f&#39;</span>
<span class="s2">                           &#39;x&#39;</span>
<span class="s2">                           &#39;y&#39;</span>
<span class="s2">                           &#39;z&#39;</span>
<span class="s2">                           &#39;E&#39;</span>
<span class="s2">                           &#39;H&#39;</span>
<span class="s2">                           &#39;Lumerical_dataset&#39;</span>
<span class="s2">               EME_Sim_Data : dict</span>
<span class="s2">                   Dictionary with:</span>
<span class="s2">                           &#39;user s matrix&#39;</span>
<span class="s2">                           &#39;internal s matrix&#39;</span>
<span class="s2">                           &#39;local diagnostics&#39;</span>
<span class="s2">                           &#39;coefficients&#39;</span>
<span class="s2">                           &#39;global diagnostics&#39;</span>
<span class="s2">                           </span>
<span class="s2">                           </span>
<span class="s2">    ############################################   EME   ############################################</span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">    ############################################   FDTD   ############################################            </span>
<span class="s2">    </span>
<span class="s2">              After an FDTD Simulation the user can: </span>
<span class="s2">            </span>
<span class="s2">            </span>
<span class="s2">                With this fuction will add an S-Parameter Sweep to the FDTD simulation.</span>
<span class="s2">                This will allowed to sweep the S-parameter Matrix like it is done in</span>
<span class="s2">                EMe solver. Additionally will extract the Power on each port according to the time</span>
<span class="s2">                monitors that ware set in the solver functions.</span>
<span class="s2">                </span>
<span class="s2">            With - ExtrtactData(&#39;FDTD&#39;, Parameters)</span>
<span class="s2">            </span>
<span class="s2">            Here Paraameters is an boolen operator!!</span>
<span class="s2">            Parameter = True - An S-Parameter extraction sweep will be added to the simulation. This will increase the simulation time, </span>
<span class="s2">            since the S-Parameters need to be propagated thrue the strucutre. </span>
<span class="s2">            Parameter = False - No S-Parameter extraction sweep. The dictionary will return 0. </span>
<span class="s2">            </span>
<span class="s2">            Returns</span>
<span class="s2">            -------</span>
<span class="s2">             SParam_Dict: dict</span>
<span class="s2">                Dictionary with:</span>
<span class="s2">                        &quot;S Parameter&quot;</span>
<span class="s2">                    </span>
<span class="s2">             PowerData_Dict : dict</span>
<span class="s2">                Dictionary with:</span>
<span class="s2">                        &#39;Power Input Port/s&#39;</span>
<span class="s2">                        &#39;Power Output Port/s&#39;</span>
<span class="s2">                        &#39;Transmission&#39;</span>
<span class="s2">                        </span>
<span class="s2">                        </span>
<span class="s2">    ############################################   FDTD   ############################################ </span>
<span class="s2">    </span>
<span class="s2">    </span>
<span class="s2">              &quot;&quot;&quot;</span><span class="p">)</span></div>

              
              
            
              
              
              
              
<div class="viewcode-block" id="HelpSubject.Help_LoadingBar">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_LoadingBar">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_LoadingBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">              </span>
<span class="s2">              If the user want to keep track of the simulation state an laoding bar is imported in this library.</span>
<span class="s2">              The loading bar is not part of the class, so you dont need to call it like an class. </span>
<span class="s2">              </span>
<span class="s2">              loadingBar(count, total)</span>
<span class="s2">              count - is your loop variable</span>
<span class="s2">              total - is the lenght of the variables that will be sweeped</span>
<span class="s2">              </span>
<span class="s2">              </span>
<span class="s2">              Example python code of loading bar:</span>
<span class="s2">                  </span>
<span class="s2">                  from Constructor import loadingBar</span>

<span class="s2">                  for i in range(10):</span>
<span class="s2">                     loadingBar(i, 10)</span>
<span class="s2">                  </span>

<span class="s2">              &quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HelpSubject.Help_RemoveObject">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_RemoveObject">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_RemoveObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        </span>
<span class="s2">                To Remove an Object simply use:</span>
<span class="s2">                </span>
<span class="s2">                removeObject()</span>
<span class="s2">        </span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></div>

        
        
        
<div class="viewcode-block" id="HelpSubject.Help_LogFile">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.HelpSubject.Help_LogFile">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_LogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            When you load the Logfile function from the Constructor Library the user can keep track </span>
<span class="sd">            with the simulation and parameters used. To use the log File you need to give an list with </span>
<span class="sd">            two dictionarays. The first can be the dictionary with Parameters given for the simulation </span>
<span class="sd">            like &quot;Tapper Width&quot;, &quot;WG Width&quot;... The secound dictionary can be called direct after performing </span>
<span class="sd">            an analysis with obj.ReturnLogInfo(). This will extract the object that you simulate and the </span>
<span class="sd">            solver that you used. An text file will be created in the given Path. The name of the File </span>
<span class="sd">            will be &quot;Lumerical_Simulation_Log_15_10_52&quot;</span>
<span class="sd">            </span>
<span class="sd">            An example can be seen here:</span>
<span class="sd">                </span>
<span class="sd">                from Constructor import Logfile</span>
<span class="sd">                Path = &quot;C:/Downloads/&quot;</span>
<span class="sd">                solverInfo = obj.ReturnLogInfo()</span>
<span class="sd">                data = [solverInfo, Parameters]</span>
<span class="sd">                Logfile(data, Path)</span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Help">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Help">[docs]</a>
<span class="k">def</span> <span class="nf">Help</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span>
<span class="s2">    To start the Python Lumerical Constructor Library you need first to:</span>
<span class="s2">        from Constructor import Constructor</span>
<span class="s2">        from Constructor import loadingBar</span>
<span class="s2">        </span>
<span class="s2">        # Call the Constructor Object </span>
<span class="s2">        obj = Constructor(file, MaterialPath, Lumerical Solver Type)</span>
<span class="s2">            # file = Path to lumapi.py for example -&gt; &quot;lumerical/2022-r2.4/api/python/lumapi.py&quot;</span>
<span class="s2">            # MaterialPath = Path to Material Library for example -&gt; &quot;/Desktop/LNOI_Env/LiNbO3.mdf&quot;</span>
<span class="s2">            # Lumerical Solver Type = Solver Type can be EME or FDTD for example -&gt; &quot;EME&quot;</span>
<span class="s2">            </span>
<span class="s2">        # To Close Lumerical simply use</span>
<span class="s2">        obj.Close()</span>
<span class="s2">        </span>
<span class="s2">        # For Further Help after colling the Constructor Object please use:</span>
<span class="s2">            # obj.Help(&#39;Objects&#39;) -&gt; Shows how to build an photonic element</span>
<span class="s2">            # obj.Help(&#39;Solvers&#39;) -&gt; Shows hot to build an FDE, EME or FDTD Solver</span>
<span class="s2">            # obj.Help(&#39;Start Simulation&#39;) -&gt; Commands to start simulation</span>
<span class="s2">            # obj.Help(&#39;Results&#39;) -&gt; Shows how to extract resuslts form FDE, EME and FDTD Simulations</span>
<span class="s2">            # obj.Help(&#39;Loading Bar&#39;) -&gt; Shows how to use the Loading Bar Function </span>
<span class="s2">            # obj.Help(&#39;Remove Object&#39;) -&gt; Romove object function</span>
<span class="s2">            # obj.Help(&#39;Log File&#39;) -&gt; Generate an log file from the simulation </span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span></div>

    




<div class="viewcode-block" id="Logfile">
<a class="viewcode-back" href="../../index.html#Constructor.Constructor.Logfile">[docs]</a>
<span class="k">def</span> <span class="nf">Logfile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list</span>
<span class="sd">        List of dictionarys with all the data for the simulation (obj.ReturnLogInfo()) and the parameters (Parameters dictionary) given to the simulation. </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="c1"># datetime object containing current date and time</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="c1"># dd/mm/YY H:M:S</span>
    <span class="n">dt_string</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">)</span>
    
    
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Lumerical_Simulation_Log_&quot;</span><span class="o">+</span><span class="p">(</span><span class="n">dt_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="s2">&quot;EME&quot;</span> <span class="ow">or</span> <span class="s2">&quot;FDTD&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">SimulationData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Parameters</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Parameters</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">SimulationData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        



    <span class="n">ParamKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">SimulationDataKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">SimulationData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span> 
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This is an Simulation Log file from the Lumerical Simulation done on </span><span class="si">{</span><span class="n">dt_string</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                   
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ParamKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="n">ParamKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulated Abject and used Solver&quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SimulationData</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SimulationDataKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SimulationData</span><span class="p">[</span><span class="n">SimulationDataKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Martin Mihaylov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>