

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Constructor.Constructor &mdash; Python Lumercial Costructor Script 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Python Lumercial Costructor Script
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python Lumercial Costructor Script</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">Constructor.Constructor</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Constructor.Constructor</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri Feb 10 08:31:42 2023</span>

<span class="sd">@author: Martin.Mihaylov</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>



<div class="viewcode-block" id="loadingBar">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.loadingBar">[docs]</a>
<span class="k">def</span> <span class="nf">loadingBar</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    count : int</span>
<span class="sd">        count is the loop iteration variable. For example count = i in case &quot;for i in range(...):&quot; is used.</span>
<span class="sd">    total : int</span>
<span class="sd">        Total number of bars that must be loaded for the respective process. For example total = 10 in case &quot;for i in range(10):&quot; </span>
<span class="sd">    size : int, optional</span>
<span class="sd">        Defines how many &quot;=&quot; signs are used when the loading bar is printed in the console. The default is 1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span>
                     <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">total</span><span class="p">))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; [&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">percent</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span>
                     <span class="n">size</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">percent</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span></div>



<span class="c1"># Array with arange including the last element</span>
<div class="viewcode-block" id="arange">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.arange">[docs]</a>
<span class="k">def</span> <span class="nf">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">endpoint</span> <span class="ow">and</span> <span class="n">arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">arr</span></div>



<div class="viewcode-block" id="Constructor">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor">[docs]</a>
<span class="k">class</span> <span class="nc">Constructor</span><span class="p">:</span>

    <span class="c1"># Init Programm</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">MaterialLib</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            Path to the lumerical python file.</span>
<span class="sd">        Mode : str</span>
<span class="sd">            Solver Type, can be set to FDTD or EME.</span>
<span class="sd">        MaterialLib : str, optional</span>
<span class="sd">            Path to the lumerical material lib. The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong solver is given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="o">=</span> <span class="n">MaterialLib</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="o">=</span> <span class="n">MaterialLib</span>
            
         
        <span class="c1"># Check Python Version !!! No import imp module after python 3.11</span>
        <span class="n">PyVersion</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>
      
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">PyVersion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s2">&quot;3.11.0&quot;</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">importlib.util</span>
                <span class="kn">import</span> <span class="nn">importlib.machinery</span>

                <span class="k">def</span> <span class="nf">load_source</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                    <span class="n">loader</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">)</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                    <span class="c1"># The module is always executed and not cached in sys.modules.</span>
                    <span class="c1"># Uncomment the following line to cache the module.</span>
                    <span class="c1"># sys.modules[module.__name__] = module</span>
                    <span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">module</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span> <span class="o">=</span> <span class="n">load_source</span><span class="p">(</span><span class="s1">&#39;lumapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">imp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lumpi</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s1">&#39;lumapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ValueError encountered: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ImportError encountered: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">Mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Solver Used&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;FDTD&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EME</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Solver Used&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;EME&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non Valid Solver was choosen. Please pass on one of the two supported solvers [&#39;FDTD&#39; or &#39;EME&#39;]&quot;</span><span class="p">)</span>

    <span class="c1"># Close Programm</span>
<div class="viewcode-block" id="Constructor.Close">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Close">[docs]</a>
    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Close Lumerical GUI</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical API is closed&#39;</span><span class="p">)</span></div>



    <span class="c1"># Remove the object and solver region</span>
<div class="viewcode-block" id="Constructor.removeObject">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.removeObject">[docs]</a>
    <span class="k">def</span> <span class="nf">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Switch from simulation to layout mode.</span>
<span class="sd">        Remove all objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span></div>



<div class="viewcode-block" id="Constructor.Help">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Help">[docs]</a>
    <span class="k">def</span> <span class="nf">Help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Subject</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Subject</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i am in None section&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Help can be called with Help(str(subject)). Subject can be choosen from &#39;Objects&#39;, &#39;Solvers&#39;, &#39;Start Simulation&#39;, &#39;Results&#39;, &#39;Loading Bar&#39; and &#39;Log File&#39; !! &quot;</span><span class="p">)</span>
            
        <span class="c1"># Check Type</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">Subject</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i am in Dict section&quot;</span><span class="p">)</span>
            <span class="n">StartNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">ResultNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">StrucNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
            <span class="n">SolverNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">]</span>
            
            <span class="n">listSub</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Objects&#39;</span><span class="p">,</span> <span class="s1">&#39;Solvers&#39;</span><span class="p">,</span> <span class="s1">&#39;Start Simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;Results&#39;</span><span class="p">,</span> <span class="s1">&#39;Loading Bar&#39;</span><span class="p">,</span> <span class="s1">&#39;Log File&#39;</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Subject</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Subject</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">_help</span> <span class="o">=</span> <span class="n">HelpSubject</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Objects&quot;</span> <span class="ow">and</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">StrucNumbers</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Objects</span><span class="p">()</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Structures</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Solvers&quot;</span> <span class="ow">and</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">SolverNumber</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Solvers</span><span class="p">()</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Solvers</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Start Simulation&quot;</span> <span class="ow">and</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">StartNumber</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_StartSimulation</span><span class="p">()</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">StartSolver</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Results&quot;</span> <span class="ow">and</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ResultNumber</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Results</span><span class="p">()</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Result_extraction</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Loading Bar&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LoadingBar</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Remove Object&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_RemoveObject</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Log File&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LogFile</span><span class="p">()</span>  
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">listSub</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Help can be called with Help(str(subject)). Subject can be choosen from &#39;Objects&#39;, &#39;Solvers&#39;, &#39;Start Simulation&#39;, &#39;Results&#39;, &#39;Loading Bar&#39; and &#39;Log File&#39; !! &quot;</span><span class="p">)</span>
            <span class="c1">#elif val[0] not in StartNumber or ResultNumber or StrucNumbers or StrucNumbers:</span>
            
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">Subject</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;i am in STR section&quot;</span><span class="p">)</span>
            <span class="n">_help</span> <span class="o">=</span> <span class="n">HelpSubject</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Objects&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Objects</span><span class="p">()</span> 
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Solvers&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Solvers</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Start Simulation&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_StartSimulation</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Results&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_Results</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Loading Bar&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LoadingBar</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Remove Object&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_RemoveObject</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">Subject</span> <span class="o">==</span> <span class="s2">&quot;Log File&quot;</span><span class="p">:</span>
                <span class="n">_help</span><span class="o">.</span><span class="n">Help_LogFile</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Help can be called with Help(str(subject)). Subject can be choosen from &#39;Objects&#39;, &#39;Solvers&#39;, &#39;Start Simulation&#39;, &#39;Results&#39;, &#39;Loading Bar&#39; and &#39;Log File&#39; !! &quot;</span><span class="p">)</span></div>




                
            
         
        
     
      
            





    <span class="c1"># Choose Solver! Only FDTD and EME supported</span>
<div class="viewcode-block" id="Constructor.FDTD">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.FDTD">[docs]</a>
    <span class="k">def</span> <span class="nf">FDTD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        Calls the FDTD Solver.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span><span class="o">.</span><span class="n">FDTD</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">importmaterialdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical FDTD API is started&#39;</span><span class="p">)</span></div>

        
        

<div class="viewcode-block" id="Constructor.EME">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.EME">[docs]</a>
    <span class="k">def</span> <span class="nf">EME</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calls the EME solver.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span><span class="o">.</span><span class="n">MODE</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">importmaterialdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical EME API is started&#39;</span><span class="p">)</span></div>

    


    <span class="c1">#   Solvers Function</span>
<div class="viewcode-block" id="Constructor.Solver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Structure : str</span>
<span class="sd">            Object that will be simulated. </span>
<span class="sd">        Type : str</span>
<span class="sd">            Solver Type.</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary of solver parameters.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong solver type selected.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDTD_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EME_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FDE_Solver</span><span class="p">(</span><span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid Solver Type! Possible Options are FDE - For Waveguides, EME - for MMI , directional Couplers and FDTD - for MMI.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.StartSimFunction">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StartSimFunction">[docs]</a>
    <span class="k">def</span> <span class="nf">StartSimFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Type : str</span>
<span class="sd">            Solver Type.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong solver type selected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartFDTDSimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;FDTD Simulation&quot;</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartEMESimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;EME Simulation&quot;</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">StartFDESimulation</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulation Type&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;FDE Simulation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid simulation type. Possibpe options for Type are: &#39;FDTD&#39;, &#39;EME&#39;, &#39;FDE&#39; !&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.ExtrtactData">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ExtrtactData">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtrtactData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Type : str</span>
<span class="sd">            Solver Type.</span>
<span class="sd">        Parameters : boolen</span>
<span class="sd">            Need to be set True if S-Parameter analysis in FDTD solver is wanted. Otherwise False.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Error when wrong structure was selected.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDTD&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span><span class="p">:</span>
                <span class="n">S_Param3</span><span class="p">,</span> <span class="n">Power3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param3</span><span class="p">,</span> <span class="n">Power3</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span><span class="p">:</span>
                <span class="n">S_Param4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param4</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
                <span class="n">S_Param4</span><span class="p">,</span> <span class="n">Power4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param4</span><span class="p">,</span> <span class="n">Power4</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;ArcWaveguide&quot;</span><span class="p">:</span>
                <span class="n">S_Param2</span><span class="p">,</span> <span class="n">Power2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param2</span><span class="p">,</span> <span class="n">Power2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;BendWaveguide&quot;</span><span class="p">:</span>
                <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">==</span> <span class="s2">&quot;StraightWaveguide&quot;</span><span class="p">:</span>
                <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDTDResults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">S_Param22</span><span class="p">,</span> <span class="n">Power22</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Structure was given. Possible structures are &#39;MMI2x1&#39;, &#39;MMI2x2&#39;, &#39;DirectionalCoupler&#39;, &#39;ArcWaveguide&#39; and &#39;BendWaveguide&#39; !&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;EME&quot;</span><span class="p">:</span>
            <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractEMEResults</span><span class="p">(</span><span class="s1">&#39;monitor&#39;</span><span class="p">,</span> <span class="n">Type</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span>
        <span class="k">elif</span> <span class="n">Type</span> <span class="o">==</span> <span class="s2">&quot;FDE&quot;</span><span class="p">:</span>
            <span class="n">TEModes</span><span class="p">,</span> <span class="n">TEData</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">TMData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDEResultsExtendet</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Effective Index&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">TEModes</span><span class="p">,</span> <span class="n">TEData</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">TMData</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid solver Type was given. To extract data from the simulation please give a correct simulation Type! Possible Types are: &#39;FDTD&#39;, &#39;EME&#39; and &#39;FDE&#39;.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.OverlapFDEModes">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.OverlapFDEModes">[docs]</a>
    <span class="k">def</span> <span class="nf">OverlapFDEModes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with parameters needed for the FDE analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Waveguide</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FDE_Solver</span><span class="p">(</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StartFDESimulation</span><span class="p">()</span>
        <span class="n">TEModes</span><span class="p">,</span> <span class="n">TMModes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExtractFDEModes</span><span class="p">(</span><span class="n">EffIndexValue</span><span class="o">=</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Effective Index&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CoppyDcard</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">TEModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">TMModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeObject</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TE Mode </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">TEModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and TM Mode </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">TMModes</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> have been copyed to the Lumerical Dcard.&quot;</span><span class="p">)</span></div>


    <span class="c1"># =============================================================================</span>
    <span class="c1"># Selection of possible Functions</span>
    <span class="c1"># =============================================================================</span>



<div class="viewcode-block" id="Constructor.FDTD_Solver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.FDTD_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">FDTD_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Structure : str</span>
<span class="sd">            Structure to be simulated.</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with solver parameters.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong structure was selected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x1FDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x2FDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;DirectionalCoupler&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDCFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Directional Coupler&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;BendWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;BendWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setBendWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bend Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;ArcWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;ArcWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setArcWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arc Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;StraightWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;StraightWaveguide&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setStraightWaveguideFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Straight Waveguide&quot;</span>
        <span class="c1"># elif Structure == &quot;CascadetMMI&quot;:</span>
        <span class="c1">#     self.Struct = &quot;CascadetMMI&quot;</span>
        <span class="c1">#     self.setCascadetMMIFDTDSolver(Parameters, SpaceX, SpaceY)</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;InverseTaper&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Strcut</span> <span class="o">=</span> <span class="s2">&quot;InverseTaper&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setInverseTaperFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Inverse Taper&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;LenseFiber&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;LenseFiber&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setLenseFiberFDTD</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Lense Fiber&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;GratingCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;GratingCoupler&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setGratingCouplerFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GratingCoupler&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;RingGratingCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="s2">&quot;RingGratingCoupler&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setRingGratingCouplerFDTDSolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RingGratingCoupler&quot;</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Strucute for FDTD Solver is selected. Possible Strucures are MMI2x1, MMI2x2, DirectionalCoupler, BendWaveguide, ArcWaveguide, StraightWaveguide, InverseTaper, GratingCoupler and RingGratingCoupler&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Constructor.EME_Solver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.EME_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">EME_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Structure : str</span>
<span class="sd">            Structure to be simulated.</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with solver parameters.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong structure was selected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x1&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x1EMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x1&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;MMI2x2&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMMI2x2EMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MMI2x2&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;DirectionalCoupler&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setDCEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Directional Coupler&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;WDM&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWDMEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Angled Wavelength Division Multiplexer&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;StraightWaveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setStraightWaveguideEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Straight Waveguide&quot;</span>
        <span class="k">elif</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;InverseTaper&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setInverseTaperEMESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Inverse Tapers&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Structure for EME Solver is selected. Possible Strucutres are MMI2x1, MMI2x2, DirectionalCoupler, WDM, StraightWaveguide andInverseTaper &quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.FDE_Solver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.FDE_Solver">[docs]</a>
    <span class="k">def</span> <span class="nf">FDE_Solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Structure</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Structure : str</span>
<span class="sd">            Structure to be simulated.</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with solver parameters.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Error when wrong structure was selected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Structure</span> <span class="o">==</span> <span class="s2">&quot;Waveguide&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWaveguideFDESolver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Simulated Object&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Waveguide&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid Structure for FDE Solver is selected. Possible Structure is Waveguide.&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.ReturnLogInfo">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ReturnLogInfo">[docs]</a>
    <span class="k">def</span> <span class="nf">ReturnLogInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TYPE</span>
<span class="sd">            Solver log information from last simulation.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span></div>




<div class="viewcode-block" id="Constructor.Script">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Script">[docs]</a>
    <span class="k">def</span> <span class="nf">Script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        myscript : str</span>
<span class="sd">            small script syntax for creating Tapers tooken from Lumerical . It is used only for check comperisons.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="s1">&#39;delta_w = 2*thickness*tan((angle_side)*pi/180); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_l = &quot; + num2str(width_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_r = &quot; + num2str(width_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;width_top_l = width_l - (1-hfrac_ref)*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;width_top_r = width_r - (1-hfrac_ref)*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_top_l = &quot; + num2str(width_top_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_top_r = &quot; + num2str(width_top_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;width_bot_l = width_l + hfrac_ref*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;width_bot_r = width_r + hfrac_ref*delta_w; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_bot_l = &quot; + num2str(width_bot_l); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;?&quot;width_bot_r = &quot; + num2str(width_bot_r) + endl; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;if ((hfrac_ref&gt;1) or (hfrac_ref&lt;0)){?&quot;Error: hfrac_ref must be between 0 and 1.&quot;;break;} </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;if ((width_top_l&lt;0) or (width_top_r&lt;0) or (width_bot_l&lt;0) or (width_bot_r&lt;0)){?&quot;Error: width and angle values are not correct.&quot;;break;} </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;zmin = -thickness/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;zmax = thickness/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;xmin = -len/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;xmax = len/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymin_bot_l = -width_bot_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymax_bot_l = width_bot_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymin_bot_r = -width_bot_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymax_bot_r = width_bot_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymin_top_l = -width_top_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymax_top_l = width_top_l/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymin_top_r = -width_top_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;ymax_top_r = width_top_r/2; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;vtx=    [xmin,ymin_bot_l,zmin; xmax,ymin_bot_r,zmin; xmax,ymax_bot_r,zmin; xmin,ymax_bot_l,zmin; xmin,ymin_top_l,zmax; xmax,ymin_top_r,zmax; xmax,ymax_top_r,zmax; xmin,ymax_top_l,zmax];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a = cell(6); </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;for(i = 1:6){ a</span><span class="si">{i}</span><span class="s1"> = cell(1);}   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{1}{1}</span><span class="s1"> = [1,4,3,2];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{2}{1}</span><span class="s1"> = [1,2,6,5];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{3}{1}</span><span class="s1"> = [2,3,7,6];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{4}{1}</span><span class="s1"> = [3,4,8,7];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{5}{1}</span><span class="s1"> = [1,5,8,4];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;a</span><span class="si">{6}{1}</span><span class="s1"> = [5,6,7,8];   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;addplanarsolid(vtx,a);   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;if (material==&quot;&lt;Object defined dielectric&gt;&quot;){setnamed(&quot;solid&quot;, &quot;index&quot;,index);}   </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">myscript</span> <span class="o">=</span> <span class="n">myscript</span> <span class="o">+</span> <span class="s1">&#39;else{setnamed(&quot;solid&quot;, &quot;material&quot;,material);}   </span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">myscript</span></div>





<span class="c1"># =============================================================================</span>
<span class="c1"># Structures</span>
<span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="Constructor.Waveguide">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Waveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">Waveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span>


<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Wavaguide.</span>
<span class="sd">            </span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int7float</span>
<span class="sd">                Height of the substrate.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;]: int/float</span>
<span class="sd">                Length of the Waveguide.</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Height of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width of the Waveguide</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height.</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">SubstrateHight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        
        
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="c1"># Material defginition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>


        <span class="n">maxWGL</span> <span class="o">=</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">minWGL</span> <span class="o">=</span> <span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15e-6</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="mf">15e-6</span>
        <span class="c1"># Procentage deviation of the height between slab and waveguide</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">min_WGH</span> <span class="o">=</span> <span class="n">max_slabH</span>
        <span class="n">max_WGH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">min_BoxH</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4e-6</span>


        <span class="c1"># Triangle EQ for waveguide Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_WGH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_WGH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Waveguide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Mesh_Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;based on a structure&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;override x mesh&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="mf">0.01e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="mf">0.005e-6</span><span class="p">)</span>

            <span class="c1"># Add SiO2 Slubstrate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Silicon&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">SubstrateHight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span><span class="n">SubstrateHight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="k">pass</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Slab</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Waveguide</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_WGH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="c1"># Mesh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;Mesh_Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;based on a structure&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;structure&#39;</span><span class="p">,</span> <span class="s1">&#39;Waveguide&#39;</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&#39;dx&#39;, 0.01e-6)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="mf">0.01e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="mf">0.005e-6</span><span class="p">)</span>

            <span class="c1"># Add SiO2 Box</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Silicon&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_BoxH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Create Cladding</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">max_WGH</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">min_WGH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">minWGL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">maxWGL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>

            
            





<div class="viewcode-block" id="Constructor.StraightWaveguide">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StraightWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">StraightWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Straight Wavaguide.</span>
<span class="sd">            </span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int float</span>
<span class="sd">                Substrate Height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Height of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of the Waveguide</span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                If Taper == False, only Waveguiedes will be constructed.</span>
<span class="sd">                If Taper == True, only an single Taper will be constructed</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Taper Length</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Taper backside width, the frontside width is the waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height.</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">                Bending angle of the Waveguide. Set it to 0 to simulate the straight waveguide.</span>
<span class="sd">                If Waveguide Angle is different then 0, then the straight waveguide will be tilted</span>
<span class="sd">                at the choosen degrees.</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                will be set.</span>
<span class="sd">            Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="sd">                and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="sd">                If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="sd">                If Taper Type is selected the user need to provide additional information:</span>
<span class="sd">                    TaperWidthF = Parameters[&#39;PWB Taper Width Front&#39;]</span>
<span class="sd">                    TaperWidthB = Parameters[&#39;PWB Taper Width Back&#39;]</span>
<span class="sd">                    TaperHightB = Parameters[&#39;PWB Taper Hight Back&#39;]</span>
<span class="sd">                    TaperHightF = Parameters[&#39;PWB Taper Hight Front&#39;]</span>
<span class="sd">                    TaperLength_PWB = Parameters[&#39;PWB Taper Length&#39;]</span>
<span class="sd">                   </span>
<span class="sd">             </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;WG Length&quot;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">]</span>
        <span class="n">Side_Angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="s2">&quot;Taper Type&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Inverse&quot;</span>
                <span class="n">TaperWidthF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Front&#39;</span><span class="p">]</span>
                <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Front&#39;</span><span class="p">]</span>
                <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
        
            
        


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>





        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="c1">#+ 1e-6 * 2  </span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">Side_Angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
                
                
                <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="c1"># creating the thin film</span>
                    <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                    <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># create_cover</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                    
                    <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1"># create_cover</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
                        
                        
                    
                <span class="c1"># Triangle EQ for waveguide Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                



                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">+</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Side_Angle</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                
                

                
                

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>


                <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                
                <span class="k">else</span><span class="p">:</span>
                
                    <span class="c1"># creating the thin film</span>
                    <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                    <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                    
                    
                    
                    
                    
                <span class="c1"># Triangle EQ for waveguide Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>



                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">+</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Side_Angle</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Waveguide&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="c1"># create_cover</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>  

                
            
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># Taper Widths on Bott Cal</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                
                
                <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="c1"># create_cover</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
                
            <span class="k">else</span><span class="p">:</span>
            
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="c1"># Taper Widths on Bott Cal</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span>
                
                <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="c1"># create_cover</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            
            
            
            
            
            <span class="k">if</span> <span class="n">TaperType</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                <span class="c1"># PWD Taper Hights</span>
                <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
                <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span>

                <span class="c1"># PWB Taper Length</span>
                <span class="n">TaperXmax</span> <span class="o">=</span>  <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">TaperXmin</span> <span class="o">=</span>  <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>

                <span class="c1"># Create PWB Taper</span>
                <span class="n">ymin_bot_l</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">ymax_bot_l</span> <span class="o">=</span>    <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">ymin_bot_r</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">ymax_bot_r</span> <span class="o">=</span>    <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">ymin_top_l</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">ymax_top_l</span> <span class="o">=</span>    <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="n">ymin_top_r</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">ymax_top_r</span> <span class="o">=</span>    <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>



                <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                <span class="p">])</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>



                <span class="c1"># Send Values to Lumerical and create solid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Taper&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Taper&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                
                
            
            <span class="k">else</span><span class="p">:</span>
            
                <span class="c1"># PWB Taper Length</span>
                <span class="n">PWB_TaperXmax</span> <span class="o">=</span>  <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">PWB_TaperXmin</span> <span class="o">=</span>  <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span>
                
                        
                <span class="c1"># PWB Taper Hights</span>
                <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
                <span class="n">TaperZmaxF</span> <span class="o">=</span>  <span class="n">TaperHightF</span> <span class="o">+</span> <span class="n">Substrate_Height</span>
                <span class="n">TaperZmaxB</span> <span class="o">=</span>  <span class="n">TaperHightB</span> <span class="o">+</span> <span class="n">Substrate_Height</span>
                
                        
                <span class="c1"># PWD Taper Y-Parameters</span>
                <span class="n">PWB_TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">PWB_TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                
                <span class="c1"># Create PWB Taper</span>
                <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 5</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 6</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 7</span>
                                <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 8</span>
                                <span class="p">])</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

                <span class="c1"># Send Values to Lumerical and create solid</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>  <span class="s2">&quot;Taper&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Taper&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide::cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>

                
                
               

<div class="viewcode-block" id="Constructor.BendWaveguide">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.BendWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">BendWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Bend Wavaguide. </span>
<span class="sd">            </span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate Height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide Height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&quot;x span&quot;] : int/float</span>
<span class="sd">                Length of the S Curve. Span of the object.</span>
<span class="sd">            Parameters[&quot;y span&quot;] : int/float</span>
<span class="sd">                Height of the curve. Difference between the input and output of the S-curve.</span>
<span class="sd">            Parameters[&quot;poles&quot;] : boolen</span>
<span class="sd">                If Parameters[&quot;poles&quot;] = True an Bezier Curbe will be made.</span>
<span class="sd">                if Parameters[&quot;poles&quot;] = False an Cosinus Curve = y_span*(cos((pi/(2*x_span))*t)^2) will be made. Where</span>
<span class="sd">                t is in the range of 0 - y_span</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                will be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error Massage.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">polesList</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;poles&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>



        <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">])</span><span class="o">-</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">],</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>





        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">y_span</span> <span class="o">+</span> <span class="mf">3e-6</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">x_span</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
        
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Slab&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;S Bend&quot;</span><span class="p">)</span>
            
            
        <span class="c1"># Triangle EQ for waveguide Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>


        <span class="c1"># if polesList == None:</span>
        <span class="c1">#     pole = np.array([[0, 0], [x_span / 2, 0], [x_span / 2, y_span], [x_span, y_span]])</span>
        <span class="c1">#     self.lum.set(&quot;poles&quot;, pole)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, MaterialWG)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     pole = np.array(polesList)</span>
        <span class="c1">#     self.lum.set(&quot;poles&quot;, pole)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, MaterialWG)</span>
        
        <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;S Bend&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S-Bend&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;S Bend&quot;</span><span class="p">)</span></div>

        





<div class="viewcode-block" id="Constructor.ArcWaveguide">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ArcWaveguide">[docs]</a>
    <span class="k">def</span> <span class="nf">ArcWaveguide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Arc Wavaguide.</span>
<span class="sd">            </span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="sd">                Radius of the Circle in um</span>
<span class="sd">            Parameters[&#39;Arc deg&#39;] : int</span>
<span class="sd">                Can be 90 or 180 for 1/4 of a cirle or 1/2 of a circle.</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                will be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;S_Band Radius&quot;</span><span class="p">]</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Arc deg&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>




        <span class="k">if</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>

           

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="c1"># max_subW = Device_Width / 2</span>
            <span class="c1"># min_subW = -Device_Width / 2</span>
            <span class="c1"># min_subL = 0</span>
            <span class="c1"># max_subL = radius</span>

            <span class="c1"># Device specifications</span>
            <span class="c1"># Device_Width = 2 * radius + WaveLength * 2 + WG_Width * 2  # MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="c1"># max_subW = Device_Width / 2</span>
            <span class="c1"># min_subW = -Device_Width / 2</span>
            <span class="c1"># min_subL = 0</span>
            <span class="c1"># max_subL = radius</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># creating the thin film</span>
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Slab&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;90 Grad Bend&quot;</span><span class="p">)</span>
                
            <span class="c1"># Triangle EQ for waveguide Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bend_Waveguide&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;In_STR&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Out_STR&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span> <span class="p">,</span> <span class="o">-</span><span class="mf">1e-6</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Bend_Waveguide&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;90 Grad Bend&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;In_STR&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;90 Grad Bend&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Out_STR&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;90 Grad Bend&quot;</span><span class="p">)</span>
            
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
               <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cladding&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;180 Grad Bend&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>



        <span class="k">elif</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="c1"># Device_Width = 2 * radius + WaveLength * 2 + WG_Width * 2  # MMI_Width</span>

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
            
            
            <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Slab&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;180 Grad Bend&quot;</span><span class="p">)</span>
                
            <span class="c1"># Triangle EQ for waveguide Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arc Waveguide1&#39;</span><span class="p">,</span> <span class="s1">&#39;Arc Waveguie2&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span>
                 <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">],</span>
                 <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>


            
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Arc Waveguide1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;180 Grad Bend&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Arc Waveguie2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;180 Grad Bend&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
               <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cladding&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;180 Grad Bend&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorrect Arc Value. The arc can only be an integer and can only be arc = 90 or arc = 180!&quot;</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.MMI2x2">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.MMI2x2">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the 2x2 MMI.</span>
<span class="sd">            </span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of the MMI.</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of the MMI.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Waveguide length.</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                Taper can be set to be True ot False.</span>
<span class="sd">                if Taper == False - No Taper used</span>
<span class="sd">                if Taper == True - Taper placed</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                this will be ignored and some random value can be given.</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                this will be ignored and some random value can be given.</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                    This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                    and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                    will be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Value Error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>



        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mf">3e-6</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>      
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

           
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Slab&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            
            
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1">#Too Fara and Too close</span>
            <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>



            <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>

            <span class="c1"># elif offset_WG2 &lt;0.5e-6:</span>
            <span class="c1">#     self.lum.deleteall()</span>
            <span class="c1">#     raise ValueError(&#39;The distance between the Tapers is less then 1 um !&#39;)</span>



            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                <span class="c1"># Names of the WGs</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_R&#39;</span><span class="p">]</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Input WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Input WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Output WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Output WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
                    
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
               <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cladding&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

           
            


        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Delate the Structure to start new</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mf">3e-6</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
            <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

            <span class="c1"># creating the MMI</span>
            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># creating the thin film</span>
                <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                
                <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Slab&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            

            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

            <span class="c1"># New x Length of the Tapers</span>
            <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
            <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="o">-</span><span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_R&#39;</span><span class="p">]</span>
            <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper Input WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper Input WG_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper Output WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># Taper Widths on Bott Cal</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span>
                            <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

            <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
            <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="c1"># offset_Set_R = posOffset/2+TaperWidth/2</span>

            <span class="c1"># if OffsetInpit &lt;= OffMin or OffsetInpit &gt;= OffMax or posOffset &lt;= OffMin or posOffset &gt;= OffMax:</span>
            <span class="k">if</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
            <span class="c1"># elif BotCornerDistance &lt; 1e-6:</span>
            <span class="c1">#     self.lum.deleteall()</span>
            <span class="c1">#     raise ValueError(&#39;The distance between the Tapers is less then 1 um !&#39;)</span>
            



            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="c1"># xPos = [max_MMIL, max_MMIL, min_MMIL, min_MMIL]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                    <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                    <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                    <span class="p">])</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

                    <span class="c1"># Send Values to Lumerical and create solid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
                

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Input WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Input WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Output WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Output WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Taper Input WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Taper Input WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Taper Output WG_L&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;Taper Output WG_R&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;cladding&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>


            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span></div>








<div class="viewcode-block" id="Constructor.MMI2x1">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.MMI2x1">[docs]</a>
    <span class="k">def</span> <span class="nf">MMI2x1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the 2x1 MMI. </span>
<span class="sd">            </span>
<span class="sd">                Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                    List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                    Check the names in Lumerical Materials viewer.</span>
<span class="sd">                    The List of materials must contain at least 2 materials! </span>
<span class="sd">                    Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                    For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">                Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                    Substrate height.</span>
<span class="sd">                Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                    Width of the MMI.</span>
<span class="sd">                Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                    Length of the MMI.</span>
<span class="sd">                Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                    Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                    For anfle = 90 we get a perfect rect!</span>
<span class="sd">                Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                    Waveguide hight. Also the height of the MMI section</span>
<span class="sd">                Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                    Waveguide width.</span>
<span class="sd">                Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                    Waveguide length.</span>
<span class="sd">                Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                    Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                    betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                    the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                    becouse of manufactering restrictions in the University.</span>
<span class="sd">                Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                    Offset of the input waveguide.</span>
<span class="sd">                Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                    Height of the slab.</span>
<span class="sd">                Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                    Taper can be set to be True ot False.</span>
<span class="sd">                    if Taper == False - No Taper used</span>
<span class="sd">                    if Taper == True - Taper placed</span>
<span class="sd">                Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                    If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="sd">                    this will be ignored and some random value can be given.</span>
<span class="sd">                Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                    This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                    and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                    will be set.</span>
<span class="sd">                Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="sd">                    This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="sd">                    becouse the maschine of our physic departmant had some proiblems with the LNOI objects design. </span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">if</span> <span class="s1">&#39;Offset Output&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">OffsetOutput</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OffsetOutput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Output&#39;</span><span class="p">]</span>




        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mf">3e-6</span>  <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            
            

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
        <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># if offset_WG2 &lt; 0.5e-6:</span>
            <span class="c1"># self.lum.deleteall()</span>
            <span class="c1"># raise ValueError(&#39;The distance between the Tapers is less then 1 um !&#39;)</span>
        <span class="c1"># else:</span>

        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># if offset_WG &gt; OffMax:</span>
                <span class="c1"># self.lum.deleteall()</span>
                <span class="c1"># raise ValueError(&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;)</span>
            <span class="c1"># else:</span>
            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">OffsetOutput</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="p">(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">OffsetOutput</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">OffsetOutput</span> <span class="p">]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_R&#39;</span><span class="p">]</span>

            <span class="c1"># create loop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Input WG&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Output WG_L&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Output WG_R&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">+</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
            
            

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Delate the Structure to start new</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                <span class="c1"># Device specifications</span>
                <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
                <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mf">3e-6</span> <span class="c1"># WaveLength * 2  </span>

                <span class="c1"># creating the substrate</span>
                <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
                <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
                <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
                
                <span class="c1"># creating the MMI</span>
                <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
                <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                
                <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    

                    <span class="c1"># creating the thin film</span>
                    <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                    <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                    
                    <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
                    
                    

                <span class="c1"># Triangle EQ for MMI Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>


                <span class="c1"># New x Length of the Tapers</span>
                <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
                <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

                <span class="c1"># Mirror the In and Out WG on both sides</span>
                <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

                <span class="c1"># Names of the WGs</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output WG_R&#39;</span><span class="p">]</span>
                <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper Input WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper Output WG_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Taper Output WG_R&#39;</span><span class="p">]</span>

                <span class="c1"># Taper loop</span>
                <span class="c1"># Taper Widths on Bott Cal</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

                <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                     <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                     <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                    <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>

                    <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                    <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                    <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                    <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                    <span class="p">])</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                         <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>



                    <span class="c1"># Send Values to Lumerical and create solid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># create loop</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                    <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
                    
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Input WG&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Output WG_L&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Output WG_R&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Taper Input WG&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Taper Output WG_L&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Taper Output WG_R&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">+</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;MMI Object&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.DirectionalCoupler">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.DirectionalCoupler">[docs]</a>
    <span class="k">def</span> <span class="nf">DirectionalCoupler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the Directional Coupler. </span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;Substrate Width&#39;] : int/float</span>
<span class="sd">                Substrate Width.</span>
<span class="sd">            Parameters[&#39;DC Length&#39;] : int/float</span>
<span class="sd">                Length of the directional coupler</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. The minimum distance between Waveguides is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                will be set.</span>


<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Width&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span>




        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">Substrate_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">max_subW</span> <span class="o">=</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subW</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Directional Coupler&quot;</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_bott</span> <span class="o">=</span> <span class="n">WG_W</span>
        
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Mirror the In and Out WG on both sides</span>
            <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">DC_Lenght</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Names of the WGs</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Top WG&#39;</span><span class="p">,</span> <span class="s1">&#39;Bottom WG&#39;</span><span class="p">]</span>

            <span class="c1"># create loop</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_bott</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Top WG&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Directional Coupler&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Bottom WG&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Directional Coupler&quot;</span><span class="p">)</span>
            
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># create_cover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="n">min_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">max_subW</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
       
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Directional Coupler&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>





<div class="viewcode-block" id="Constructor.WDM">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.WDM">[docs]</a>
    <span class="k">def</span> <span class="nf">WDM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the WDM. </span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of the MMI.</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of the MMI.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Waveguide length.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Angle Thetha&#39;] :</span>
<span class="sd">                Input and output angle of the waveguide. This is only temporally</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Backside width of the Taper, frontside width is the waveguide width</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Length of the Taper.</span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                If Taper == False, no Taper will be placed with the Waveguides.</span>
<span class="sd">                If Taper == True, tapers will be placed with the waveguides</span>
<span class="sd">            Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="sd">                This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="sd">                and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="sd">                will be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">angleTheta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Angle Thetha&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s2">&quot;Cladding&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Cladding</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="mf">3e-6</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>
            

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>

            <span class="c1"># creating the MMI</span>
            <span class="c1"># creating the MMI</span>

            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>


            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>


            <span class="c1"># self.lum.addwaveguide()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;MMI&quot;)</span>
            <span class="c1"># self.lum.set(&quot;base height&quot;, max_MMIH)</span>
            <span class="c1"># self.lum.set(&quot;base angle&quot;, 90 - angle)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z&quot;, z_Offset)</span>
            <span class="c1"># pole = np.array([[max_MMIL, 0], [min_MMIL, 0]])</span>
            <span class="c1"># self.lum.set(&quot;poles&quot;, pole)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, MaterialWG)</span>
            <span class="c1"># self.lum.set(&quot;base width&quot;, MMI_Wid)</span>


            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">xLen</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">Diff</span> <span class="o">=</span> <span class="n">WG_W</span> <span class="o">-</span> <span class="n">WG_Width</span>

            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># - xLen - Diff/2 #</span>
            <span class="n">Li</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">MMI_Width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">WaveLength</span>


            <span class="c1">#Creaate MMI</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">-</span> <span class="n">xLen</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">xLen</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>
            

            <span class="c1"># Names of the WGs</span>
            <span class="n">Waveguides</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LN_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;LN_Output&#39;</span><span class="p">]</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Waveguides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># -MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Waveguides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># + MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span><span class="p">)</span>
            
            
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Create Cladding</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">,</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>
                
                <span class="c1"># self.lum.select(&quot;cladding&quot;)</span>
                <span class="c1"># self.lum.addtogroup(&quot;Directional Coupler&quot;)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>


     


        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>


            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  

            <span class="c1"># creating the substrate</span>
            <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
            <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>

            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
            <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>


            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="n">TaperNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_Taper&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_Taper&quot;</span><span class="p">]</span>
            <span class="n">Waveguides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_WG&quot;</span><span class="p">,</span> <span class="s2">&quot;Output_WG&quot;</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
            <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">xLen</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
            <span class="n">Diff</span> <span class="o">=</span> <span class="n">WG_W</span> <span class="o">-</span> <span class="n">WG_Width</span>

            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># - xLen - Diff/2 #</span>
            <span class="n">Li</span> <span class="o">=</span><span class="p">(</span> <span class="mi">4</span><span class="o">*</span><span class="mf">2.5</span><span class="o">*</span><span class="n">MMI_Width</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">WaveLength</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>
            



            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>
           

            <span class="c1"># creating the MMI</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">-</span>  <span class="n">xLen</span> <span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="o">-</span> <span class="n">xLen</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>






            <span class="c1"># Input and Output Tapers and WGs</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperWidth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span><span class="p">)</span>




            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Waveguides</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#-MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">NewY</span> <span class="p">)</span>



            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">TaperNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperWidth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>  <span class="c1">#+ MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span> <span class="p">)</span>



            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Waveguides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span><span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">angleTheta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>  <span class="c1">#+ MMI_Length / 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">NewY</span><span class="p">)</span>
            
            
            
            <span class="k">if</span> <span class="n">Cladding</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Create Cladding</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min&#39;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max&#39;</span><span class="p">,</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;WDM&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span></div>


            






<div class="viewcode-block" id="Constructor.InverseTaper">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.InverseTaper">[docs]</a>
    <span class="k">def</span> <span class="nf">InverseTaper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the InverseTaper.</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer.</span>
<span class="sd">                The List of materials must contain at least 2 materials! </span>
<span class="sd">                For this structure 3 Material will be needed</span>
<span class="sd">                Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="sd">                For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width. Also in this function and ONLY in this function this will be the</span>
<span class="sd">                ibverse Taper width!!!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Inverse Taper Length</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Front Width of the inverse Taper!! In this Function and ONLY in this function, the</span>
<span class="sd">                Parameters[&#39;Taper Width&#39;] is the frond width of the inverse Taper!</span>
<span class="sd">            Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">                Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="sd">            Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">                Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="sd">            Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="sd">                Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="sd">            Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="sd">                Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="sd">            Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">                Length of the Photonic Wire Bonding Taper</span>
<span class="sd">            Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">            Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">            Parameters[&quot;SMF Core Index&quot;]</span>
<span class="sd">                Single Mode Fiber Core Index</span>
<span class="sd">            Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="sd">                Single Mode Fiber Cladding Index</span>
<span class="sd">                </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Front&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Front&#39;</span><span class="p">]</span>
        <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        
        <span class="c1"># SMF Parameters</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">CladdingDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span>
        <span class="n">CoreIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Index&quot;</span><span class="p">]</span>
        <span class="n">CladdingIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Index&quot;</span><span class="p">]</span>

     


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 3 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Material Photonic Wire Bonding&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
            <span class="n">MaterialPWB</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>



        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># make substrate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate InverseTaper&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 10e-6)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB * 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>

        <span class="c1"># creating the thin film</span>
        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

        <span class="c1"># Create Slab and Check if Slab is needed</span>
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mf">0e-12</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 10e-6)</span>
            <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB * 2)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

        <span class="c1"># Names of the WGs</span>
        <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Taper_PWB&#39;</span><span class="p">,</span> <span class="s1">&#39;Inverse_Taper&#39;</span><span class="p">]</span>

        <span class="c1"># Taper sideangle widths</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>




        <span class="c1"># PWD Taper Y-Parameters</span>
        <span class="n">PWB_TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">PWB_TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidthB</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="c1"># Inverse   Taper Y-Parameters</span>
        <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>



        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span>

        <span class="c1"># PWB Taper Hights</span>
        <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
        <span class="n">TaperZmaxF</span> <span class="o">=</span>  <span class="n">TaperHightF</span> <span class="o">+</span> <span class="n">TaperZmin</span>
        <span class="n">TaperZmaxB</span> <span class="o">=</span>  <span class="n">TaperHightB</span> <span class="o">+</span> <span class="n">TaperZmin</span>

        <span class="c1"># Inverse Taper Hights</span>
        <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">z_Offset</span>
        <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span>

        <span class="c1"># PWB Taper Length</span>
        <span class="n">PWB_TaperXmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">PWB_TaperXmax</span> <span class="o">=</span> <span class="n">TaperLength_PWB</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Inverse Taper Length</span>
        <span class="n">TaperXmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Create Inverse Taper</span>
        <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                        <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                        <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                        <span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

        <span class="n">Offset_InvTaper</span> <span class="o">=</span> <span class="n">PWB_TaperXmin</span> <span class="o">+</span> <span class="n">TaperXmax</span>

        <span class="k">if</span> <span class="n">Offset_InvTaper</span> <span class="o">-</span> <span class="n">TaperXmax</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="n">PWB_TaperXmax</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Inverse Taper is moved outside the PWB Taper! The maximal x-Offset of the Inverse Taper is Parameters[&#39;Offset Inverse Taper&#39;] = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">PWB_TaperXmax</span> <span class="o">+</span> <span class="n">TaperXmax</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Send Values to Lumerical and create solid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;second axis&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rotation 2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">Offset_InvTaper</span><span class="p">)</span>

        <span class="c1"># Create PWB Taper</span>
        <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_BotR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMin_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">PWB_TaperPosYMax_TopR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 5</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 6</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmaxF</span><span class="p">],</span>  <span class="c1"># 7</span>
                        <span class="p">[</span><span class="n">PWB_TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmaxB</span><span class="p">],</span>  <span class="c1"># 8</span>
                        <span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
             <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>

        <span class="c1"># Send Values to Lumerical and create solid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialPWB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Make Sqered WG-Extention of the PWB for mode Calculations</span>

        <span class="c1"># Extra Waveguide Lenght</span>
        <span class="n">Ext_WGLength</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="c1"># PWD_x_Offset = PWB_TaperXmin</span>

        <span class="c1"># self.lum.addrect()</span>
        <span class="c1"># self.lum.set(&#39;x min&#39;, PWD_x_Offset - Ext_WGLength)</span>
        <span class="c1"># self.lum.set(&#39;x max&#39;,PWD_x_Offset)</span>
        <span class="c1"># self.lum.set(&#39;y&#39;, 0)</span>
        <span class="c1"># self.lum.set(&#39;y span&#39;, TaperWidthB)</span>
        <span class="c1"># self.lum.set(&#39;z min&#39;, TaperZmin)</span>
        <span class="c1"># self.lum.set(&#39;z max&#39;, TaperZmaxB)</span>
        <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, 1)</span>
        <span class="c1"># self.lum.set(&quot;mesh order&quot;, 3)</span>
        <span class="c1"># self.lum.set(&#39;name&#39;, &#39;WG_Extention_PWB&#39;)</span>
        <span class="c1"># self.lum.set(&#39;material&#39;, MaterialPWB)</span>

        <span class="c1"># Make Sqred WG-Extention for the inverse Taper</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">Offset_InvTaper</span> <span class="o">+</span> <span class="n">TaperXmax</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span>  <span class="n">PWB_TaperXmax</span> <span class="o">+</span> <span class="n">Ext_WGLength</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">TaperXmax</span> <span class="o">+</span> <span class="n">Offset_InvTaper</span>

        <span class="n">ZOffset_WG</span> <span class="o">=</span> <span class="n">TaperZmin</span><span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s1">&#39;WG_Extention_Inverse_Taper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">center</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">ZOffset_WG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
        
        <span class="c1"># Create Taper abjects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;WG_Extention_Inverse_Taper&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;InverseTaper&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">TapersNames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;InverseTaper&#39;</span><span class="p">)</span>
        
        
 
        
        
        <span class="c1"># Create the SMF </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CoreIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">PWB_TaperXmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">CladdingDiameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CladdingIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">PWB_TaperXmin</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">1e-6</span><span class="p">)</span></div>



    
        
        
        
<div class="viewcode-block" id="Constructor.CascadetMMI">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.CascadetMMI">[docs]</a>
    <span class="k">def</span> <span class="nf">CascadetMMI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">SpaceX</span><span class="p">,</span> <span class="n">SpaceY</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : TYPE</span>
<span class="sd">            DESCRIPTION.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">polesList</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;poles&quot;</span><span class="p">]</span>
        
        
        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Material</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;List of materials must contain at least 2 materials!, Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceX</span> <span class="p">)</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WaveLength</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">SpaceY</span>   <span class="c1"># MMI_Width</span>

        <span class="c1"># creating the substrate</span>
        <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
        <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
        <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">max_subL</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate Main&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        
        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
        <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># creating the thin film</span>
            <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab Main&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Slab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
            

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        
        <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
        <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        

        <span class="n">names_MMI</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMI In&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI Out1&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI Out2&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names_MMI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">offset_Taper</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># + WG_W / 2</span>
        <span class="n">BotCornerDistance</span> <span class="o">=</span> <span class="n">posOffset</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">offset_WG2</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">offset_WG2</span> <span class="o">&lt;</span> <span class="mf">0.5e-6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The distance between the Tapers is less then 1 um !&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">offset_WG</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                    
                    
                                
                    <span class="c1"># Create two Bends Cos or Bezier depending on the poles option</span>
                    <span class="n">x_span</span> <span class="o">=</span> <span class="n">SpaceX</span>
                    <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                    
                    
                    <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>
        
        
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend Top&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bend Bot&quot;</span><span class="p">]</span>
                    <span class="n">S_Bend_X_Offset</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="n">WG_Length</span><span class="p">),</span> <span class="p">(</span><span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">)]</span>
                    <span class="n">S_Bend_Y_Offset</span> <span class="o">=</span> <span class="p">[(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="p">(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">z_rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span>
                    <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="n">pole1</span><span class="p">,</span> <span class="n">pole</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">S_Bend_X_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">S_Bend_Y_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">z_rotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        
                        

                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1 In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2 In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 Out_WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 Out_WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names1</span><span class="p">,</span> <span class="n">names2</span><span class="p">,</span> <span class="n">names3</span><span class="p">]</span>

                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>


                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI In&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI Out1&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI Out2&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI In_WG&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Out_WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Out_WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Out_WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Out_WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Out_WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Out_WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S-Bend Top&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S-Bend Bot&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">offset_Taper</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Taper outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Delate the Structure to start new</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
                    <span class="c1"># Device specifications</span>
              
                
                    <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceX</span> 
                    <span class="n">Device_Width</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WaveLength</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">SpaceY</span>  <span class="c1"># MMI_Width</span>

                    <span class="c1"># creating the substrate</span>
                    <span class="n">max_subH</span> <span class="o">=</span> <span class="n">Substrate_Height</span>
                    <span class="n">min_subH</span> <span class="o">=</span> <span class="o">-</span><span class="n">Substrate_Height</span>
                    <span class="n">min_subL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">max_subL</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate_Main&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_subH</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
                    
                    <span class="c1"># creating the MMI</span>
                    <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>
                    <span class="n">max_MMIL</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">min_MMIL</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">/</span> <span class="mi">2</span>
                    
                    <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># creating the thin film</span>
                        <span class="n">min_slabH</span> <span class="o">=</span> <span class="n">max_subH</span>
                        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">max_subH</span> <span class="o">+</span> <span class="n">Slab_Height</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Slab Mian&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">min_slabH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">max_slabH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>

                        <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI In&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                        

                    <span class="c1"># Triangle EQ for MMI Width</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
                    
                    
                    <span class="n">Parameters__Position_X</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                    
                    <span class="n">names_MMI</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MMI In&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI Out1&quot;</span><span class="p">,</span> <span class="s2">&quot;MMI Out2&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names_MMI</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">min_MMIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">MMI_Wid</span><span class="p">)</span>


                    <span class="c1"># New x Length of the Tapers</span>
                    <span class="n">maxLength</span> <span class="o">=</span> <span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span>
                    <span class="n">minLength</span> <span class="o">=</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span>

                    <span class="c1"># Mirror the In and Out WG on both sides</span>
                    <span class="n">maxWGL</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_Length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">minWGL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span><span class="p">]</span>
                    <span class="n">xPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">minLength</span><span class="p">]</span>
                    <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>


                    <span class="c1"># Taper loop</span>
                    <span class="c1"># Taper Widths on Bott Cal</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
                    <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">TaperSideWidth</span> <span class="o">=</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

                    <span class="n">TaperPosXmin</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">,</span> <span class="n">min_MMIL</span><span class="p">]</span>
                    <span class="n">TaperPosXmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_MMIL</span> <span class="o">+</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">,</span> <span class="n">min_MMIL</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">]</span>

                    <span class="n">PosOffset</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopR</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

                    <span class="n">TaperPosYMax_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">-</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_BotL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                                         <span class="p">(</span><span class="o">+</span><span class="n">TaperSideWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMax_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">TaperPosYMin_TopL</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    
                    
                    <span class="c1"># Create two Bends Cos or Bezier depending on the poles option</span>
                    <span class="n">x_span</span> <span class="o">=</span> <span class="n">SpaceX</span>
                    <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                    
                    
                    <span class="k">if</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="k">elif</span> <span class="n">polesList</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">K</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
                        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]])</span>
                        <span class="n">pole1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="n">y_span</span><span class="p">],</span> <span class="p">[(</span><span class="n">x_span</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">x_span</span><span class="o">*</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">x_span</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Parameters[&quot;poles&quot;] should be an boolen variable! Please set Parameters[&quot;poles&quot;] to True if Bezier Curves needed. Set Parameters[&quot;poles&quot;] to False for Cosinus Curve!&#39;</span><span class="p">)</span>
        
        
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;S-Bend Top&quot;</span><span class="p">,</span> <span class="s2">&quot;S-Bend Bot&quot;</span><span class="p">]</span>
                    <span class="n">S_Bend_X_Offset</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">),</span> <span class="p">(</span><span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">SpaceX</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">TaperLength</span> <span class="o">-</span> <span class="n">WG_Length</span><span class="p">)]</span>
                    <span class="n">S_Bend_Y_Offset</span> <span class="o">=</span> <span class="p">[(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span><span class="o">-</span><span class="p">(</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
                    <span class="n">z_rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span>
                    <span class="n">poles</span> <span class="o">=</span> <span class="p">[</span><span class="n">pole1</span><span class="p">,</span> <span class="n">pole</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">S_Bend_X_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">S_Bend_Y_Offset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">WG_Height</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">poles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span><span class="n">z_rotation</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    
                    <span class="n">TapersNames1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI Taper In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Taper Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Taper Out WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1 Taper In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Taper Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Taper Out WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2 Taper In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 Taper Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 Taper ut WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">TapersNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">TapersNames1</span><span class="p">,</span> <span class="n">TapersNames2</span><span class="p">,</span> <span class="n">TapersNames3</span><span class="p">]</span>
                    
                    
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="n">TaperZmin</span> <span class="o">=</span> <span class="n">max_slabH</span>
                            <span class="n">TaperZmax</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">max_MMIH</span>
    
                            <span class="n">TaperXmin</span> <span class="o">=</span> <span class="n">TaperPosXmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">TaperXmax</span> <span class="o">=</span> <span class="n">TaperPosXmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_bot_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_bot_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_BotR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_top_l</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">ymin_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMin_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">ymax_top_r</span> <span class="o">=</span> <span class="n">TaperPosYMax_TopR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
                            <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 1</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 2</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_bot_r</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 3</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_bot_l</span><span class="p">,</span> <span class="n">TaperZmin</span><span class="p">],</span>  <span class="c1"># 4</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymin_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 5</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymin_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 6</span>
                                            <span class="p">[</span><span class="n">TaperXmax</span><span class="p">,</span> <span class="n">ymax_top_r</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 7</span>
                                            <span class="p">[</span><span class="n">TaperXmin</span><span class="p">,</span> <span class="n">ymax_top_l</span><span class="p">,</span> <span class="n">TaperZmax</span><span class="p">],</span>  <span class="c1"># 8</span>
                                            <span class="p">])</span>
                            <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span>
                                 <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)]]</span>
                            
                        
    
                            <span class="c1"># Send Values to Lumerical and create solid</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;facets&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addplanarsolid</span><span class="p">(</span><span class="n">vtx</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">TapersNames</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">PosOffset</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            
                    <span class="c1"># Names of the WGs</span>
                    <span class="c1"># Names of the WGs</span>
                    <span class="n">names1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMI In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMI Out WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut1 In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut1 Out WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MMIOut2 In_WG&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 Out WG_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;MMIOut2 In WG_Bot&#39;</span><span class="p">]</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">names1</span><span class="p">,</span> <span class="n">names2</span><span class="p">,</span> <span class="n">names3</span><span class="p">]</span>
                    


                    <span class="c1"># create loop</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xPos</span><span class="p">)):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_X</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">xPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_Width_top</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
                            <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">maxWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">minWGL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
                

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI In&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI Out1&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI Out2&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;MMI In_WG&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Out WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Out WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Out WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S-Bend Top&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S-Bend Bot&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Taper In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Taper Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMI Taper Out WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Taper In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Taper Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut1 Taper Out WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Taper In_WG&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Taper Out WG_Top&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;MMIOut2 Taper ut WG_Bot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;Cascadet MMI&quot;</span><span class="p">)</span>
                    

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Incorect Taper input. Taper must be an boolen. You can choose from Taper = True or Taper = False!&quot;</span><span class="p">)</span>
        
            
            
            <span class="c1"># create_cover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialClad</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">max_MMIH</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">min_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">max_subL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.GratingCoupler">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.GratingCoupler">[docs]</a>
    <span class="k">def</span> <span class="nf">GratingCoupler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the GratingCoupler.</span>
<span class="sd">            Parameters[&#39;Material GC&#39;] : list of str</span>
<span class="sd">                List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer. For Example &quot;Parameters[&#39;Material GC&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &quot;Si (Silicon) - Palik&quot;]&quot;</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="sd">                Lenght of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="sd">                Widht of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="sd">                Hight of the Grating Coupler Material</span>
<span class="sd">            Parameters[&quot;Etch Depth GC&quot;]: int/float</span>
<span class="sd">                How deep, taken from the Parameters[&quot;Hight GC&quot;] will be the etchin depth of the gratings</span>
<span class="sd">            Parameters[&quot;Duty Cycle&quot;]: int/float</span>
<span class="sd">                Duty cycle of the gratings. For example Parameters[&quot;Duty Cycle&quot;] = 0.39 will result in 39% Duty Cycle </span>
<span class="sd">            Parameters[&quot;Pitch GC&quot;]: int/float</span>
<span class="sd">                Pitch of the Grating Coupler. For Example Parameters[&quot;Pitch GC&quot;] = 0.6e-6 will result in 6um Etch Space + Rib Space = 0.6um.</span>
<span class="sd">            Parameters[&quot;Input Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="sd">            Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect! In this case is used only when Parameters[&quot;Taper&quot;] = True</span>
<span class="sd">            Parameters[&quot;Taper&quot;] : boolen</span>
<span class="sd">                You can create an input Taper to your Grating Coupler structure</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width. Also in this function and ONLY in this function this will be the</span>
<span class="sd">                ibverse Taper width!!!</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Taper Length</span>
<span class="sd">            Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">            Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">            Parameters[&quot;SMF Core Index&quot;]</span>
<span class="sd">                Single Mode Fiber Core Index</span>
<span class="sd">            Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="sd">                Single Mode Fiber Cladding Index</span>
<span class="sd">            Parameters[&quot;SMF Theta&quot;]: int/float</span>
<span class="sd">                Tilting Angle of the Single Mode Fiber to the Grating Coupler. Normaly we choose Parameters[&quot;SMF Theta&quot;] = 15</span>
<span class="sd">            Parameters[&quot;SMF Z Span&quot;]: int/float</span>
<span class="sd">                Lenght/Span of the Single Mode Fiber</span>
<span class="sd">            </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># simplify variable names by removing spaces</span>
        <span class="n">TargetLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Length GC&quot;</span><span class="p">]</span>
        <span class="n">WidthGC</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Width GC&quot;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">EtchDepth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Etch Depth GC&quot;</span><span class="p">]</span>
        <span class="n">DutyCycle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Duty Cycle&quot;</span><span class="p">]</span>
        <span class="n">Pitch</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Pitch GC&quot;</span><span class="p">]</span>
        <span class="n">InputLlength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Input Length GC&quot;</span><span class="p">]</span>
        <span class="n">OutputLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Output Length GC&quot;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Material GC&quot;</span><span class="p">]</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">CladdingDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span>
        <span class="n">ZSpan</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Z Span&quot;</span><span class="p">]</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Theta&quot;</span><span class="p">]</span>
        <span class="n">CoreIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Index&quot;</span><span class="p">]</span>
        <span class="n">CladdingIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Index&quot;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Taper&quot;</span><span class="p">]</span>
        <span class="n">SubstrateThickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>

        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>



        <span class="c1"># Create the MMI L2 Tapers for the Trapezoid</span>
        <span class="n">GCNames</span> <span class="o">=</span> <span class="s2">&quot;Grating Coupler&quot;</span>
        <span class="n">FiberName</span> <span class="o">=</span> <span class="s2">&quot;SMF&quot;</span>
        

        <span class="c1"># Make the Grating Coupler</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="n">n_periods</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">TargetLength</span> <span class="o">/</span> <span class="n">Pitch</span><span class="p">)</span>
        <span class="n">fill_width</span> <span class="o">=</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="n">DutyCycle</span>
        <span class="n">etch_width</span> <span class="o">=</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DutyCycle</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">n_periods</span> <span class="o">*</span> <span class="n">Pitch</span> <span class="o">+</span> <span class="n">etch_width</span>
        <span class="n">spanX</span> <span class="o">=</span> <span class="n">OutputLength</span> <span class="o">+</span> <span class="n">TargetLength</span> <span class="o">+</span> <span class="n">InputLlength</span>

        <span class="k">if</span> <span class="n">EtchDepth</span> <span class="o">&gt;</span> <span class="n">Hight</span><span class="p">:</span>
            <span class="n">EtchDepth</span> <span class="o">=</span> <span class="n">Hight</span>
        <span class="k">elif</span> <span class="n">EtchDepth</span> <span class="o">&lt;</span> <span class="n">Hight</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;lower layer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
            
        

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;input waveguide&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">InputLlength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;output waveguide&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">L</span> <span class="o">+</span> <span class="n">OutputLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_periods</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">etch_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">selectall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">selectall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="n">GCNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">GCNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TargetLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>





        <span class="c1"># Build SMF</span>

        <span class="n">core_index</span> <span class="o">=</span> <span class="n">CoreIndex</span>
        <span class="n">cladding_index</span> <span class="o">=</span> <span class="n">CladdingIndex</span>
        <span class="n">core_radius</span> <span class="o">=</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">cladding_radius</span> <span class="o">=</span> <span class="n">CladdingDiameter</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">ZSpan</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span>



        <span class="c1"># Check if Material Cable is given</span>
        <span class="c1"># if len(Material) == 2:</span>
        <span class="n">CoreIndex</span> <span class="o">=</span> <span class="n">CoreIndex</span>
        <span class="n">CladdingIndex</span> <span class="o">=</span> <span class="n">CladdingIndex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">core_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CoreIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Theta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">cladding_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CladdingIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="n">Theta</span><span class="p">)</span>

        <span class="c1"># else:</span>
            <span class="c1"># CoreMaterial = Material[2]</span>
            <span class="c1"># CladdingMaterial = Material[3]</span>
            <span class="c1"># </span>
            <span class="c1"># self.lum.addcircle()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;core&quot;)</span>
            <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, 1)</span>
            <span class="c1"># self.lum.set(&quot;mesh order&quot;, 4)</span>
            <span class="c1"># self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
            <span class="c1"># self.lum.set(&quot;rotation 1&quot;, 10)</span>
            <span class="c1"># self.lum.set(&quot;alpha&quot;, 1)</span>
            <span class="c1"># self.lum.set(&quot;radius&quot;, core_radius)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, CoreMaterial)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z span&quot;, L)</span>
            <span class="c1"># self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
            <span class="c1"># self.lum.set(&quot;rotation 1&quot;, Theta)</span>
            <span class="c1"># </span>
            <span class="c1"># self.lum.addcircle()</span>
            <span class="c1"># self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
            <span class="c1"># self.lum.set(&quot;override mesh order from material database&quot;, 1)</span>
            <span class="c1"># self.lum.set(&quot;mesh order&quot;, 5)</span>
            <span class="c1"># self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
            <span class="c1"># self.lum.set(&quot;rotation 1&quot;, 10)</span>
            <span class="c1"># self.lum.set(&quot;alpha&quot;, 0.35)</span>
            <span class="c1"># self.lum.set(&quot;radius&quot;, cladding_radius)</span>
            <span class="c1"># self.lum.set(&quot;material&quot;, CladdingMaterial)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;z span&quot;, L)</span>
            <span class="c1"># self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
            <span class="c1"># self.lum.set(&quot;rotation 1&quot;, Theta)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Add Taper</span>
            <span class="n">TaperNames</span> <span class="o">=</span> <span class="s2">&quot;Taper&quot;</span>
            <span class="n">myscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Script</span><span class="p">()</span>
            <span class="n">spanX</span> <span class="o">=</span> <span class="n">OutputLength</span><span class="o">+</span><span class="n">TargetLength</span> <span class="o">+</span> <span class="n">InputLlength</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addstructuregroup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">TaperNames</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;construction group&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;thickness&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;angle_side&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_l&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;width_r&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;hfrac_ref&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;len&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">adduserprop</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">,</span> <span class="n">myscript</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TargetLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLlength</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
            
        <span class="c1"># global substrate and Si-Layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;SubstrateGlobal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">SubstrateThickness</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">SubstrateThickness</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Si_Layer Global&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span> <span class="n">SubstrateThickness</span> <span class="o">-</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Cladding Global&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">+</span> <span class="mf">0.7e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.RingGratingCoupler">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.RingGratingCoupler">[docs]</a>
    <span class="k">def</span> <span class="nf">RingGratingCoupler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the GratingCoupler.</span>
<span class="sd">            Parameters[&#39;Material GC&#39;] : list of str</span>
<span class="sd">                List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer. For Example &quot;Parameters[&#39;Material GC&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &quot;Si (Silicon) - Palik&quot;]&quot;</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="sd">                Lenght of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="sd">                Widht of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="sd">                Hight of the Grating Coupler Material</span>
<span class="sd">            Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="sd">                Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="sd">            Parameters[&quot;Etch Depth GC&quot;]: int/float</span>
<span class="sd">                How deep, taken from the Parameters[&quot;Hight GC&quot;] will be the etchin depth of the gratings</span>
<span class="sd">            Parameters[&quot;Duty Cycle&quot;]: int/float</span>
<span class="sd">                Duty cycle of the gratings. For example Parameters[&quot;Duty Cycle&quot;] = 0.39 will result in 39% Duty Cycle </span>
<span class="sd">            Parameters[&quot;Pitch GC&quot;]: int/float</span>
<span class="sd">                Pitch of the Grating Coupler. For Example Parameters[&quot;Pitch GC&quot;] = 0.6e-6 will result in 6um Etch Space + Rib Space = 0.6um.</span>
<span class="sd">            Parameters[&quot;Input LengthGC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="sd">            Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect! </span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width. </span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab height</span>
<span class="sd">            Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">            Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">            Parameters[&quot;SMF Core Index&quot;]</span>
<span class="sd">                Single Mode Fiber Core Index</span>
<span class="sd">            Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="sd">                Single Mode Fiber Cladding Index</span>
<span class="sd">            Parameters[&quot;SMF Theta&quot;]: int/float</span>
<span class="sd">                Tilting Angle of the Single Mode Fiber to the Grating Coupler. Normaly we choose Parameters[&quot;SMF Theta&quot;] = 15</span>
<span class="sd">            Parameters[&quot;SMF Z Span&quot;]: int/float</span>
<span class="sd">                Lenght/Span of the Single Mode Fiber</span>
<span class="sd">            </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># simplify variable names by removing spaces</span>
        <span class="n">TargetLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Length GC&quot;</span><span class="p">]</span>
        <span class="n">WidthGC</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Width GC&quot;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">EtchDepth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Etch Depth GC&quot;</span><span class="p">]</span>
        <span class="n">DutyCycle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Duty Cycle&quot;</span><span class="p">]</span>
        <span class="n">Pitch</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Pitch GC&quot;</span><span class="p">]</span>
        <span class="n">InputLlength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Input Length GC&quot;</span><span class="p">]</span>
        <span class="n">OutputLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Output Length GC&quot;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Material GC&quot;</span><span class="p">]</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">CladdingDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span>
        <span class="n">ZSpan</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Z Span&quot;</span><span class="p">]</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Theta&quot;</span><span class="p">]</span>
        <span class="n">CoreIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Index&quot;</span><span class="p">]</span>
        <span class="n">CladdingIndex</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Index&quot;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Taper&quot;</span><span class="p">]</span>
        <span class="n">SubstrateThickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">GCRadius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GC Radius&quot;</span><span class="p">]</span>

        
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>



        <span class="c1"># Create the MMI L2 Tapers for the Trapezoid</span>
        <span class="n">GCNames</span> <span class="o">=</span> <span class="s2">&quot;Grating Coupler&quot;</span>
        <span class="n">FiberName</span> <span class="o">=</span> <span class="s2">&quot;SMF&quot;</span>
    


        <span class="c1"># Make the Grating Coupler</span>
        <span class="kn">import</span> <span class="nn">math</span>
        <span class="n">n_periods</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">TargetLength</span> <span class="o">/</span> <span class="n">Pitch</span><span class="p">)</span>
        <span class="n">fill_width</span> <span class="o">=</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="n">DutyCycle</span>
        <span class="n">etch_width</span> <span class="o">=</span> <span class="n">Pitch</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DutyCycle</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">n_periods</span> <span class="o">*</span> <span class="n">Pitch</span> <span class="o">+</span> <span class="n">etch_width</span>
        <span class="n">spanX</span> <span class="o">=</span> <span class="n">OutputLength</span> <span class="o">+</span> <span class="n">TargetLength</span> <span class="o">+</span> <span class="n">InputLlength</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">WidthGC</span><span class="o">/</span><span class="n">GCRadius</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        

        <span class="k">if</span> <span class="n">EtchDepth</span> <span class="o">&gt;</span> <span class="n">Hight</span><span class="p">:</span>
            <span class="n">EtchDepth</span> <span class="o">=</span> <span class="n">Hight</span>
        <span class="k">elif</span> <span class="n">EtchDepth</span> <span class="o">&lt;</span> <span class="n">Hight</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addring</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;lower layer&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">+</span><span class="n">L</span> <span class="o">+</span> <span class="n">OutputLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta start&quot;</span><span class="p">,</span><span class="o">-</span><span class="n">Theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta stop&quot;</span><span class="p">,</span><span class="n">Theta</span><span class="p">)</span>
            


 
        <span class="c1"># input section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addring</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;input section&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;inner radius&quot;,GCRadius * np.cos(Theta*np.pi/180))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span><span class="n">Hight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta start&quot;</span><span class="p">,</span><span class="o">-</span><span class="n">Theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta stop&quot;</span><span class="p">,</span><span class="n">Theta</span><span class="p">)</span>


        <span class="c1"># output section</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addring</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;output section&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">+</span> <span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">+</span><span class="n">L</span> <span class="o">+</span> <span class="n">OutputLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span><span class="n">Hight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta start&quot;</span><span class="p">,</span><span class="o">-</span><span class="n">Theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta stop&quot;</span><span class="p">,</span><span class="n">Theta</span><span class="p">)</span>

       
        <span class="c1"># Add Grating</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_periods</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addring</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span><span class="n">Hight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta start&quot;</span><span class="p">,</span><span class="o">-</span><span class="n">Theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta stop&quot;</span><span class="p">,</span><span class="n">Theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">+</span>  <span class="n">Pitch</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">etch_width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span><span class="n">GCRadius</span> <span class="o">+</span> <span class="n">Pitch</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">)</span>
       

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">selectall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">selectall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="n">GCNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">GCNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TargetLength</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>





        <span class="c1"># Build SMF</span>

        <span class="n">core_index</span> <span class="o">=</span> <span class="n">CoreIndex</span>
        <span class="n">cladding_index</span> <span class="o">=</span> <span class="n">CladdingIndex</span>
        <span class="n">core_radius</span> <span class="o">=</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">cladding_radius</span> <span class="o">=</span> <span class="n">CladdingDiameter</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">theta_rad</span> <span class="o">=</span> <span class="n">Theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">ZSpan</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_rad</span><span class="p">)</span>



        <span class="c1"># Check if Material Cable is given</span>
        <span class="c1"># if len(Material) == 2:</span>
        <span class="n">CoreIndex</span> <span class="o">=</span> <span class="n">CoreIndex</span>
        <span class="n">CladdingIndex</span> <span class="o">=</span> <span class="n">CladdingIndex</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">core_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CoreIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">cladding_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">CladdingIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>


        <span class="c1"># else:</span>
        <span class="c1">#     CoreMaterial = Material[2]</span>
        <span class="c1">#     CladdingMaterial = Material[3]</span>
        <span class="c1"># </span>
        <span class="c1">#     self.lum.addcircle()</span>
        <span class="c1">#     self.lum.set(&quot;name&quot;, &quot;core&quot;)</span>
        <span class="c1">#     self.lum.set(&quot;override mesh order from material database&quot;, 1)</span>
        <span class="c1">#     self.lum.set(&quot;mesh order&quot;, 4)</span>
        <span class="c1">#     self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
        <span class="c1">#     self.lum.set(&quot;rotation 1&quot;, 10)</span>
        <span class="c1">#     self.lum.set(&quot;alpha&quot;, 1)</span>
        <span class="c1">#     self.lum.set(&quot;radius&quot;, core_radius)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, CoreMaterial)</span>
        <span class="c1">#     self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;z&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;z span&quot;, L)</span>
        <span class="c1"># </span>
        <span class="c1"># </span>
        <span class="c1">#     self.lum.addcircle()</span>
        <span class="c1">#     self.lum.set(&quot;name&quot;, &quot;cladding&quot;)</span>
        <span class="c1">#     self.lum.set(&quot;override mesh order from material database&quot;, 1)</span>
        <span class="c1">#     self.lum.set(&quot;mesh order&quot;, 5)</span>
        <span class="c1">#     self.lum.set(&quot;first axis&quot;, &quot;y&quot;)</span>
        <span class="c1">#     self.lum.set(&quot;rotation 1&quot;, 10)</span>
        <span class="c1">#     self.lum.set(&quot;alpha&quot;, 0.35)</span>
        <span class="c1">#     self.lum.set(&quot;radius&quot;, cladding_radius)</span>
        <span class="c1">#     self.lum.set(&quot;material&quot;, CladdingMaterial)</span>
        <span class="c1">#     self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;z&quot;, 0)</span>
        <span class="c1">#     self.lum.set(&quot;z span&quot;, L)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TargetLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span><span class="n">GCRadius</span> <span class="o">+</span> <span class="n">core_radius</span><span class="p">)</span> <span class="c1">#TargetLength</span>

        
        
        
        <span class="c1"># Triangle EQ for waveguide Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Hight</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">Hight</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
    
      
        <span class="c1"># Add Waveguide </span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addwaveguide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GCRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base width&quot;</span><span class="p">,</span> <span class="n">WG_W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base height&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;base angle&quot;</span><span class="p">,</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">20e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5e-6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;Input Waveguide&#39;</span><span class="p">)</span>
       

        <span class="c1"># global substrate and Si-Layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;SubstrateGlobal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">SubstrateThickness</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">SubstrateThickness</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Si_Layer Global&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span> <span class="n">SubstrateThickness</span> <span class="o">-</span><span class="p">(</span><span class="mf">2e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Cladding Global&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">120e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">+</span> <span class="mf">0.7e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

        




    
    
    
<div class="viewcode-block" id="Constructor.GratingCouplerNeff">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.GratingCouplerNeff">[docs]</a>
    <span class="k">def</span> <span class="nf">GratingCouplerNeff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

        <span class="n">Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">EtchDepth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Etch Depth GC&quot;</span><span class="p">]</span>
        <span class="n">Pitch</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Pitch GC&quot;</span><span class="p">]</span>
        <span class="n">Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Material  GC&quot;</span><span class="p">]</span>



        <span class="c1"># Make the Grating Coupler</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">-</span> <span class="n">Pitch</span>


        <span class="c1"># Create Ribs and Gaps</span>
        <span class="c1"># for i in range(1, 2 ):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Pitch&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Pitch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span>

        <span class="c1">#Add Bottom Layer of Material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;lower layer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Pitch</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Gap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span>

        <span class="c1"># Add Substrate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Pitch</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Gap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Add Cladding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Pitch</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Gap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">-</span> <span class="n">EtchDepth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">+</span> <span class="mf">0.7e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Material</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;override mesh order from material database&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">selectall</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s2">&quot;GC Rib&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;GC Rib&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.LenseModeSystem">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.LenseModeSystem">[docs]</a>
    <span class="k">def</span> <span class="nf">LenseModeSystem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Parameters</span><span class="p">):</span>
        
        <span class="n">f_lense</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Focal Length&quot;</span><span class="p">]</span>
        <span class="n">Outter_R</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Ring Outter Radius&quot;</span><span class="p">]</span>
        <span class="n">Iner_R</span>   <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Ring Iner Radius&quot;</span><span class="p">]</span>
        <span class="n">Lense_Thickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Lense Thickness&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span> 
        <span class="n">Wavelength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span> 
        <span class="n">Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">]</span> 
        <span class="n">Materials</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>


        <span class="c1"># SMF Parameters</span>
        <span class="n">Core_Diameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span> 
        <span class="n">Cladding_Diameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span> 
        <span class="n">Core_Index</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Index&quot;</span><span class="p">]</span>
        <span class="n">Cladding_Index</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Index&quot;</span><span class="p">]</span> 
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide::Waveguide&quot;</span><span class="p">)</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Core_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">Core_Index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">Cladding_Index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        
        
        
        <span class="c1"># Extract SMF Positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
        <span class="n">x_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">y_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide::Waveguide&quot;</span><span class="p">)</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="n">z_Sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addring</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Support Ring Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">z_Sub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer radius&quot;</span><span class="p">,</span> <span class="n">Outter_R</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;inner radius&quot;</span><span class="p">,</span> <span class="n">Iner_R</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta start&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta stop&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Materials</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addsphere</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">f_lense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Iner_R</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;make ellipsoid&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius 2&quot;</span><span class="p">,</span> <span class="n">Iner_R</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius 3&quot;</span><span class="p">,</span> <span class="n">Lense_Thickness</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Materials</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Support Ring Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;Funnel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;Funnel&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="n">x_adj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x_adj</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Funnel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_adj</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="n">x_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
        <span class="n">y_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="n">Solver_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">Solver_X_Span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">)</span>
        <span class="n">Solver_X_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">)</span>
        <span class="n">Solver_X_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">)</span>
        <span class="n">Solver_Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">Solver_Y_Span</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">)</span>
        <span class="n">Solver_Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">)</span>
        

        <span class="c1"># Solver Object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, Solver_X)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, Solver_X_Span)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Solver_X_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">Solver_X_min</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Solver_Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="mf">0.5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">Wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


        <span class="c1"># Add Gausssian Source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addgaussian</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z-axis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;direction&quot;</span><span class="p">,</span><span class="s2">&quot;Backward&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waist radius w0&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide::Waveguide&quot;</span><span class="p">)</span>
        <span class="n">WG_Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="c1"># Add Movie monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Movie&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">WG_Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Solver_X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Solver_X_Span</span><span class="p">)</span>

        <span class="c1"># Add Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Solver_X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Solver_X_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">WG_Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="s2">&quot;Output&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Straight Waveguide::Waveguide&quot;</span><span class="p">)</span>
        <span class="n">WG_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">)</span>
        <span class="n">x_Monitor</span> <span class="o">=</span> <span class="p">[</span><span class="n">WG_X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="n">WG_X</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="n">z_sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
        <span class="n">z_Min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">)</span>
        

        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Monitor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Port_Span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">WG_Z</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Port_Span</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power Beam &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Solver_X_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Min</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">z_Min</span> <span class="o">=</span> <span class="n">z_Min</span><span class="o">/</span><span class="mi">2</span>
        
        <span class="c1"># Monitor Behind the Port </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power Beam back&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Solver_X_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
              

        <span class="c1"># Monitor Mode  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Beam Profile Monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="mf">0.5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Monitor Index  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;index_monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;3D&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Solver_X_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">Solver_X_min</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Solver_Y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Solver_Y_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">Solver_Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="mf">0.5e-6</span><span class="p">)</span></div>

  
  
  
  
<div class="viewcode-block" id="Constructor.LenseFiber">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.LenseFiber">[docs]</a>
    <span class="k">def</span> <span class="nf">LenseFiber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the GratingCoupler.</span>
<span class="sd">            Take care since this object will create his own FDTD simulation object. No extra Solvers needed!</span>
<span class="sd">            Parameters[&#39;Material&#39;] : list of str</span>
<span class="sd">                List of Materials. the list should be with names (str) of a valid Lumerical materials.</span>
<span class="sd">                Check the names in Lumerical Materials viewer. For Example &quot;Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &quot;Si (Silicon) - Palik&quot;]&quot;</span>
<span class="sd">            Parameters[&quot;Lense Diameter&quot;] : int/float</span>
<span class="sd">                Lense diameter.</span>
<span class="sd">            Parameters[&quot;Lense Thickness&quot;]: int/float</span>
<span class="sd">                Lens thickness</span>
<span class="sd">            Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">            Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">            Parameters[&quot;SMF Core Index&quot;]</span>
<span class="sd">                Single Mode Fiber Core Index</span>
<span class="sd">            Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="sd">                Single Mode Fiber Cladding Index</span>
<span class="sd">            Parameters[&#39;Support Cylunder Hight&#39;]: int/float</span>
<span class="sd">                Hight of the Cylinder holding the Lense. This is needed so that the Lense can have flat fine serface to be printed on.</span>
<span class="sd">            Parameters[&#39;Hexagon Hight&#39;]: optional int/float</span>
<span class="sd">                Hight of the Hexagon holding the Cylinder. If the Parameter is not set the Hexagon will be made with 4 um thickness. Where 2 um </span>
<span class="sd">                will go into the fiber array and 2 um will be above to print the cylinder on it. This is how is done in NanoPrintX.</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                Mesh step size</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;]: int/float</span>
<span class="sd">                Simulation Wavelenght</span>
<span class="sd">                </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
    
    
    
        <span class="n">Lens_d</span>   <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Lense Diameter&quot;</span><span class="p">]</span>
        <span class="n">Lense_Thickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Lense Thickness&quot;</span><span class="p">]</span>
        <span class="n">Materials</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Material&#39;</span><span class="p">]</span>
        <span class="n">Cylinder_Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Support Cylunder Hight&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="s2">&quot;Hexagon Hight&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">Hexagon_Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Hexagon Hight&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Hexagon_Hight</span> <span class="o">=</span> <span class="mf">4e-6</span>
            
        


        <span class="c1"># SMF Parameters</span>
        <span class="n">Core_Diameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span> 
        <span class="n">Cladding_Diameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span> 
        <span class="n">Core_Index</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Index&quot;</span><span class="p">]</span>
        <span class="n">Cladding_Index</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Index&quot;</span><span class="p">]</span> 
        
       
        
        
        <span class="c1">#Create SMF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Core_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">Core_Index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">Cladding_Index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;cladding&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtogroup</span><span class="p">(</span><span class="s1">&#39;SMF&#39;</span><span class="p">)</span>
        
        
        
        <span class="c1"># Extract SMF Positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
        <span class="n">x_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">y_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        
        
        
        <span class="c1"># Create Hexagon support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpoly</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Support Hexagon&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">pole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">Cladding_Diameter</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span> <span class="n">pole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">Hexagon_Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Hexagon_Hight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Materials</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        
       
        <span class="c1"># Set support ring with 0,5 um min thickness becouse of Voxel of Nanoscribe</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addcircle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Support Ring Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Core_Diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Materials</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="o">+</span> <span class="n">Cylinder_Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Cylinder_Hight</span><span class="p">)</span>
        
        
        <span class="c1"># Add lense to on top of the o,5um Voxel ring</span>
        <span class="n">z_Pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addsphere</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Lense&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;override mesh order from material database&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh order&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">Lens_d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;make ellipsoid&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius 2&quot;</span><span class="p">,</span> <span class="n">Lens_d</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;radius 3&quot;</span><span class="p">,</span> <span class="n">Lense_Thickness</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">Materials</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

        

        
    


    <span class="c1"># =============================================================================</span>
    <span class="c1"># Functions for the solvers</span>
    <span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="Constructor.setStraightWaveguideFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setStraightWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setStraightWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the StraightWaveguideFDTDSolver.</span>
<span class="sd">            Parameters : Dictionary</span>
<span class="sd">                Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">               Substrate height.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">               Waveguide Length</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">               Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">               Waveguide width.</span>
<span class="sd">            Parameters[&quot;Taper&quot;] : boolen</span>
<span class="sd">               If Taper == False, only straight Waveguide will be simulated,</span>
<span class="sd">               If Taper == True an Taper will be simulated</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">               Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">               Taper Length</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                 EME Mesh resolutio,</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">               Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">               Wavelength</span>
<span class="sd">            Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">               This Parameter will set the theta ratation angle of the port. It can be 90 or 180.</span>
<span class="sd">            Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">               List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="sd">                    This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="sd">                    and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="sd">                    If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="sd">                    </span>
<span class="sd">                    If Parameters[&quot;Taper Type&quot;] is given, themn the user need to set couple more parameters:</span>
<span class="sd">                        Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">                            Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">                            Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="sd">                            Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="sd">                            Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">                            Length of the Photonic Wire Bonding Taper</span>
<span class="sd">                    </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;Taper Type&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Inverse&quot;</span>
                <span class="n">TaperWidthF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Front&#39;</span><span class="p">]</span>
                <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Front&#39;</span><span class="p">]</span>
                <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
            
                
        <span class="c1"># Device specifications</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="p">(</span><span class="n">WG_Length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">))</span>




        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                


                <span class="c1"># Define Ports</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">EME_WGLength</span><span class="p">]</span>
                <span class="n">x_Monitor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">,</span><span class="n">EME_WGLength</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D X-normal&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Monitor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Add Movie monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Calc Output Loc</span>
                <span class="n">sideLength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span> <span class="n">WG_Length</span>
                <span class="n">sideHight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">WG_Length</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sideLength</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>


                <span class="c1"># Define Ports</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">EME_WGLength</span><span class="p">]</span>
                <span class="n">x_Monitor</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">,</span><span class="n">EME_WGLength</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">sideHight</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Monitor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Add Movie monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>


            
            
            
            <span class="k">if</span> <span class="n">TaperType</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
            
                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
                <span class="c1"># Define Ports</span>
                <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span> <span class="mf">0.1e-6</span> <span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">x_Monitor</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span> <span class="mf">0.1e-6</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">,</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                
                
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Monitor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    
                    
                    
                    <span class="c1"># Add Movie monitor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>

                    <span class="c1"># Add Power and Freq Monitor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Adds a FDTD Solver</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidthB</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span> <span class="o">+</span>  <span class="n">TaperHightB</span>  <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                
                
                <span class="c1"># Define Ports</span>
                <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span> <span class="mf">0.1e-6</span> <span class="p">,</span> <span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">x_Monitor</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span> <span class="mf">0.1e-6</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">,</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.1e-6</span> <span class="o">-</span> <span class="mf">0.1e-6</span><span class="p">]</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">Diff_Span</span> <span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidthF</span> <span class="o">+</span> <span class="n">Diff_Span</span> <span class="p">]</span>
                <span class="n">z_Pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightB</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightF</span><span class="o">/</span><span class="mi">2</span> <span class="p">]</span>
                <span class="n">z_Span</span> <span class="o">=</span> <span class="p">[</span> <span class="n">TaperHightB</span> <span class="o">+</span> <span class="n">z_Port_Span</span> <span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">]</span><span class="c1"># TaperHightF/2  + z_Port_Span]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_Monitor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                


                <span class="c1"># Add Movie monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">TaperLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setArcWaveguideFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setArcWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setArcWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the ArcWaveguideFDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                EME Mesh resolutio,</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="sd">                S-Bend Radius in um.</span>
<span class="sd">            Parameters[&#39;Arc deg&#39;] : int/float</span>
<span class="sd">                Arc define the Arc of the curve. It can be 90 or 180 degrees only.</span>
<span class="sd">                This two will define an 1/4 of a circle or 1/2 of a circle.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;S_Band Radius&quot;</span><span class="p">]</span>
        <span class="n">arc</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Arc deg&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>



        <span class="k">if</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">90</span><span class="p">:</span>

            <span class="c1"># Device dimentions</span>
            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span><span class="o">+</span><span class="mf">2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mf">0.2e-6</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">radius</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mf">0.2e-6</span><span class="p">]</span>

            <span class="c1"># Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;bent waveguide&quot;, 1)</span>
            <span class="c1"># self.lum.set(&quot;bend radius&quot;, radius)</span>



            <span class="c1"># Time Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;2D X-mormal Input Power Monitor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D X-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



            <span class="c1">#  Port 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;bent waveguide&quot;, 1)</span>
            <span class="c1"># self.lum.set(&quot;bend radius&quot;, radius)</span>
            <span class="c1"># self.lum.set(&quot;bend orientation&quot;, 90)</span>


            <span class="c1"># Time Monitor Port 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Power Monitor Port 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;2D Y-mormal Input Power Monitor&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span><span class="s2">&quot;2D Y-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>  <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


            <span class="c1"># Add Movie Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">arc</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span>

            <span class="c1"># magic number</span>
            <span class="c1"># The cubic Bezier curve using this magic number in the pole points approximates the semi-circile with least error</span>
            <span class="n">m</span> <span class="o">=</span> <span class="mf">0.55191502449</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend orientation&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span>

            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;y-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span> <span class="c1"># Only becouse we just rotate the previus WG on 90 degrees!!!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bent waveguide&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend radius&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;bend orientation&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>

            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addtime</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setBendWaveguideFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setBendWaveguideFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setBendWaveguideFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the BendWaveguideFDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">               Substrate height.</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">               Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                 EME Mesh resolutio,</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">               Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">               Wavelength</span>
<span class="sd">            Parameters[&quot;x span&quot;] : int/float</span>
<span class="sd">               Length of the S-Bend Waveguide</span>
<span class="sd">            Parameters[&quot;y span&quot;] : int/float</span>
<span class="sd">               Width of the S-Bend Waveguide</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">x_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;x span&quot;</span><span class="p">]</span>
        <span class="n">y_span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;y span&quot;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">x_span</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">y_span</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Check Object Geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;S Bend::S-Bend&quot;</span><span class="p">)</span>
        <span class="n">z_Structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="n">z_Object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Base Height&quot;</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">z_Structure</span> <span class="o">+</span> <span class="n">z_Object</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Z</span> <span class="o">+</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_span</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_span</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


        <span class="c1"># Power Monitor Port 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Power Monitor Port 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">x_span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>



        <span class="c1"># Add Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;FieldMonitor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">x_span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">y_span</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setMMI2x2FDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setMMI2x2FDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x2FDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the MMI2x2FDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of MMI</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of MMI</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Heigth of waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width og waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of waveguide</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&quot;Taper&quot;]: boolen </span>
<span class="sd">                Add Taper to the structure on the input and output waveguids</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="sd">                Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>


            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>


            <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

                <span class="c1"># Power Monitor Port 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Ports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>


            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>

            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>


            <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

                <span class="c1"># Power Monitor Port 1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Ports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

            <span class="c1"># Add Power and Freq Monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setMMI2x1FDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setMMI2x1FDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x1FDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the MMI2x1FDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of MMI</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of MMI</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Heigth of waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width og waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of waveguide</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                Input waveguide/taper offset.</span>
<span class="sd">            Parameters[&quot;Taper&quot;]: boolen </span>
<span class="sd">                Add Taper to the structure on the input and output waveguids</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="sd">                Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="sd">            Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="sd">                This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="sd">                becouse the maschine of our physic departmant had some proiblems with the LNOI objects design. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>

        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;Offset Output&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">OffsetOutput</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">OffsetOutput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Output&#39;</span><span class="p">]</span>
        


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>



            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="c1"># Ports_mid = Substrate_Height + Slab_Height + WG_Height / 2</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># WG_H = WG_Height</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Positions of the Input and Output WGs</span>
            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">OffsetOutput</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">OffsetOutput</span><span class="p">,</span> <span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">OffsetOutput</span><span class="p">]</span>

            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_Port_Span_old</span> <span class="o">=</span> <span class="n">y_Port_Span</span>
                <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
                <span class="nb">print</span><span class="p">((</span><span class="sa">f</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = </span><span class="si">{</span><span class="n">y_Port_Span_old</span><span class="si">}</span><span class="s2"> to y_span_new = </span><span class="si">{</span><span class="n">y_Port_Span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span_old</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span_old</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># raise ValueError(&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;YOu are in the else part Now&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>

                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="c1"># WG_H = WG_Height</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Positions of the Input and Output WGs</span>
            <span class="c1"># Triangle EQ for MMI Width</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>

            <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>

            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">y_Port_Span_old</span> <span class="o">=</span> <span class="n">y_Port_Span</span>
                <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = </span><span class="si">{</span><span class="n">y_Port_Span_old</span><span class="si">}</span><span class="s2"> to y_span_new = </span><span class="si">{</span><span class="n">y_Port_Span</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># raise ValueError(&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>

                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.setDCFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setDCFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setDCFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the DCFDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="sd">                Height of the Substrate</span>
<span class="sd">            Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="sd">                Width of the MMI</span>
<span class="sd">            Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="sd">                Length of the Directional coupler</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="sd">                Height of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="sd">                Waveguide Width</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="sd">                Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="sd">                will be offset of the middle position (y = 0) by the half of there</span>
<span class="sd">                Width. In this case they will not overlap if the Offset is 0.</span>
<span class="sd">            Parameters[&#39;x res&#39;] : float/int</span>
<span class="sd">                Mesh resolution for the x-Axis</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="sd">                Slab height.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Substrate_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Width&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>



        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">Substrate_Width</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
        <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Output_R&#39;</span><span class="p">]</span>

        <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

            <span class="c1"># Power Monitor Port 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Add Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






    <span class="c1"># def setWDMFDTDSolver(self, Parameters):</span>
    <span class="c1">#     &#39;&#39;&#39;</span>


    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     Parameters : Dictionary</span>
    <span class="c1">#         Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
    <span class="c1">#             Parameters</span>
    <span class="c1">#             ----------</span>
    <span class="c1">#             Parameters[&#39;Substrate Height&#39;] : int/float</span>
    <span class="c1">#                 Substrate height.</span>
    <span class="c1">#             Parameters[&#39;MMI Width&#39;] : int/float</span>
    <span class="c1">#                 Width of the MMI.</span>
    <span class="c1">#             Parameters[&#39;MMI Length&#39;] : int/float</span>
    <span class="c1">#                 Length of the MMI.</span>
    <span class="c1">#             Parameters[&#39;WG Height&#39; : int/float</span>
    <span class="c1">#                 Waveguide hight. Also the height of the MMI section</span>
    <span class="c1">#             Parameters[&#39;WG Width&#39;] : int/float</span>
    <span class="c1">#                 Waveguide width.</span>
    <span class="c1">#             Parameters[&#39;WG Length&#39;] : int/float</span>
    <span class="c1">#                 Waveguide length.</span>
    <span class="c1">#             Parameters[&#39;y res&#39;] : int/float</span>
    <span class="c1">#                 Mesh y-Axis</span>
    <span class="c1">#             Parameters[&#39;z res&#39;] : int/float</span>
    <span class="c1">#                 Mesh z-Axis</span>
    <span class="c1">#             Parameters[&#39;Slab Height&#39;] : int/float</span>
    <span class="c1">#                 Slab Height.</span>
    <span class="c1">#             Parameters[&#39;Wavelength&#39;] : int/float</span>
    <span class="c1">#                 Wavelength</span>
    <span class="c1">#             Parameters[&#39;Angle Thetha&#39;] : boolen</span>
    <span class="c1">#                 Angle for the input and output waveguides</span>
    <span class="c1">#             Parameters[&quot;Mode&quot;] : str</span>
    <span class="c1">#                 Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     None.</span>

    <span class="c1">#     &#39;&#39;&#39;</span>

    <span class="c1">#     Substrate_Height = Parameters[&#39;Substrate Height&#39;]</span>
    <span class="c1">#     MMI_Width = Parameters[&#39;MMI Width&#39;]</span>
    <span class="c1">#     MMI_Length = Parameters[&#39;MMI Length&#39;]</span>
    <span class="c1">#     WG_Height = Parameters[&#39;WG Height&#39;]</span>
    <span class="c1">#     WG_Width = Parameters[&#39;WG Width&#39;]</span>
    <span class="c1">#     WG_Length = Parameters[&#39;WG Length&#39;]</span>
    <span class="c1">#     y_res = Parameters[&#39;y res&#39;]</span>
    <span class="c1">#     z_res = Parameters[&#39;z res&#39;]</span>
    <span class="c1">#     Slab_Height = Parameters[&#39;Slab Height&#39;]</span>
    <span class="c1">#     WaveLength = Parameters[&#39;Wavelength&#39;]</span>
    <span class="c1">#     angleTheta = Parameters[&#39;Angle Thetha&#39;]</span>
    <span class="c1">#     Mode = Parameters[&quot;Mode&quot;]</span>


    <span class="c1">#     # Device specifications</span>
    <span class="c1">#     Device_Length = MMI_Length + 2 * WG_Length</span>
    <span class="c1">#     Device_Width = MMI_Width + 2*(WG_Length) + WaveLength * 2  # MMI_Width</span>
    <span class="c1">#     max_slabH = Slab_Height</span>
    <span class="c1">#     MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
    <span class="c1">#     Ports_mid = (max_slabH + WG_Height) / 2</span>

    <span class="c1">#     # Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
    <span class="c1">#     self.lum.addeme()</span>
    <span class="c1">#     self.lum.set(&#39;simulation temperature&#39;, 273.15 + 20)</span>
    <span class="c1">#     self.lum.set(&quot;x min&quot;, 1e-6)</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, Device_Width)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Substrate_Height)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 4e-6)</span>
    <span class="c1">#     self.lum.set(&quot;wavelength&quot;, WaveLength)</span>
    <span class="c1">#     self.lum.set(&quot;z min bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;z max bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;y min bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;y max bc&quot;, &quot;PML&quot;)</span>
    <span class="c1">#     # set cell properties</span>
    <span class="c1">#     self.lum.set(&quot;number of cell groups&quot;, 3)</span>
    <span class="c1">#     self.lum.set(&quot;group spans&quot;, np.array([[WG_Length - 1e-6], [MMI_Length], [WG_Length - 1e-6]]))</span>
    <span class="c1">#     self.lum.set(&quot;cells&quot;, np.array([[3], [3], [3]]))</span>
    <span class="c1">#     self.lum.set(&quot;subcell method&quot;, np.array([[0], [0], [0]]))</span>

    <span class="c1">#     # Modes to Calculate</span>
    <span class="c1">#     self.lum.set(&#39;number of modes for all cell groups&#39;, 20)</span>

    <span class="c1">#     # Mesh Cells</span>
    <span class="c1">#     self.lum.set(&quot;define y mesh by&quot;, &quot;maximum mesh step&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;dy&quot;, y_res)</span>
    <span class="c1">#     self.lum.set(&quot;define z mesh by&quot;, &quot;maximum mesh step&quot;)</span>
    <span class="c1">#     self.lum.set(&quot;dz&quot;, z_res)</span>
    <span class="c1">#     self.lum.set(&#39;fit materials with multi-coefficient model&#39;, 1)</span>
    <span class="c1">#     self.lum.set(&#39;wavelength start&#39;, 0.4e-6)</span>
    <span class="c1">#     self.lum.set(&#39;wavelength stop&#39;, 2e-6)</span>

    <span class="c1">#     # max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
    <span class="c1">#     # min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>

    <span class="c1">#     Input_yPos = -MMI_Width / 2 + WG_Width / 2</span>
    <span class="c1">#     y = WG_Length * np.tan(angleTheta * np.pi / 180)</span>
    <span class="c1">#     Input_Y = Input_yPos - y + WG_Width</span>

    <span class="c1">#     Output_yPos = MMI_Width / 2 - WG_Width / 2</span>
    <span class="c1">#     y2 = WG_Length * np.tan(angleTheta * np.pi / 180)</span>
    <span class="c1">#     Output_Y = Output_yPos + y2 - WG_Width / 2</span>
    <span class="c1">#     portLoc = [&quot;left&quot;, &quot;right&quot;]</span>

    <span class="c1">#     self.lum.select(&quot;EME::Ports::port_&quot; + str(1))</span>
    <span class="c1">#     self.lum.set(&quot;port location&quot;, portLoc[0])</span>
    <span class="c1">#     self.lum.set(&quot;use full simulation span&quot;, 0)</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, min_yPos[1])</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, max_yPos[1])</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, Input_Y)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, WG_Width + 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Ports_mid)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;mode selection&quot;, Mode)</span>
    <span class="c1">#     self.lum.set(&quot;theta&quot;, angleTheta)</span>

    <span class="c1">#     self.lum.select(&quot;EME::Ports::port_&quot; + str(2))</span>
    <span class="c1">#     self.lum.set(&quot;port location&quot;, portLoc[1])</span>
    <span class="c1">#     self.lum.set(&quot;use full simulation span&quot;, 0)</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, min_yPos[2])</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, max_yPos[2])</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, Output_Y)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, WG_Width + 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, Ports_mid)</span>
    <span class="c1">#     self.lum.set(&quot;z span&quot;, 2e-6)</span>
    <span class="c1">#     self.lum.set(&quot;mode selection&quot;, Mode)</span>
    <span class="c1">#     self.lum.set(&quot;theta&quot;, angleTheta)</span>

    <span class="c1">#     # Add monitor</span>
    <span class="c1">#     # x_MMI = Device_Length / 2</span>
    <span class="c1">#     self.lum.addemeprofile()</span>
    <span class="c1">#     self.lum.set(&quot;x&quot;, Device_Length / 2)</span>
    <span class="c1">#     self.lum.set(&quot;x span&quot;, Device_Length)</span>
    <span class="c1">#     # self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
    <span class="c1">#     # self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>
    <span class="c1">#     self.lum.set(&quot;y&quot;, 0)</span>
    <span class="c1">#     self.lum.set(&quot;y span&quot;, Device_Width )</span>
    <span class="c1">#     # self.lum.set(&quot;y min&quot;, -Device_Width / 2)</span>
    <span class="c1">#     # self.lum.set(&quot;y max&quot;, Device_Width / 2)</span>
    <span class="c1">#     self.lum.set(&quot;z&quot;, MonitorHeight)</span>
    
    
    
<div class="viewcode-block" id="Constructor.setInverseTaperFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setInverseTaperFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setInverseTaperFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Parameters</span>
<span class="sd">          ----------</span>
<span class="sd">          Parameters : Dictionary</span>
<span class="sd">              Dictionary with all the data needet for the InverseTaperFDTDSolver.</span>
<span class="sd">              Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                  Substrate height.</span>
<span class="sd">              Parameters[&#39;WG Height&#39; : int/float</span>
<span class="sd">                  Waveguide hight. Also the height of the MMI section</span>
<span class="sd">              Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                  Waveguide width.</span>
<span class="sd">              Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                  Slab height</span>
<span class="sd">              Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">                  Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="sd">              Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">                  Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="sd">              Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">                  Length of the Photonic Wire Bonding Taper</span>
<span class="sd">              Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">              Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">              Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                  Mesh x-Axis</span>
<span class="sd">              Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                  Wavelength</span>
<span class="sd">              Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                  Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">              Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                  List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
        <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># SMF Parameters</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">CladdingDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># # Device specifications</span>

            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Ports_PWB_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># TaperHightB/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">xPos_SMF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xPos_SMF</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># # Device specifications</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>

            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Ports_PWB_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># TaperHightB/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">xPos_SMF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xPos_SMF</span><span class="p">)</span>
            
            
        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidthB</span> <span class="p">)</span><span class="c1"># + TaperWidthB/2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#Substrate_Height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        
        <span class="c1"># Ports Positions</span>
        <span class="n">xPort_Pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_min</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="p">]</span>
        <span class="n">yPort_Pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">CoreDiameter</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
        <span class="n">zPort_Pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">CoreDiameter</span><span class="o">+</span><span class="mf">2e-6</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SMF Port&#39;</span><span class="p">,</span> <span class="s1">&#39;Waveguide Port&#39;</span><span class="p">]</span>
        

   
        <span class="n">x</span> <span class="o">=</span><span class="p">[</span><span class="n">X_min</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">]</span>
        <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]</span>
        <span class="n">zMid_Pos_Ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ports_PWB_mid</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">]</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Forward&quot;</span><span class="p">,</span> <span class="s2">&quot;Backward&quot;</span><span class="p">]</span>
        
        <span class="c1"># Gaussian Source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addgaussian</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;direction&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span>  <span class="mi">2</span><span class="o">*</span><span class="n">TaperWidthB</span><span class="p">)</span> <span class="c1"># yPort_Pos[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zMid_Pos_Ports</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># zPort_Pos[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waist radius w0&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;distance from waist&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    

        <span class="c1"># Add Ports to Structure and power monitors</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPort_Pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">zMid_Pos_Ports</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">zPort_Pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># self.lum.addport()</span>
            <span class="c1"># self.lum.set(&#39;name&#39;, name[i])</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, x[i])</span>
            <span class="c1"># self.lum.set(&quot;y&quot;, 0)</span>
            <span class="c1"># self.lum.set(&quot;y span&quot;, yPort_Pos[i])</span>
            <span class="c1"># self.lum.set(&quot;z&quot;, zMid_Pos_Ports[i])</span>
            <span class="c1"># self.lum.set(&quot;z span&quot;, zPort_Pos[i])</span>
            <span class="c1"># self.lum.set(&#39;direction&#39;, direction[i])</span>
            <span class="c1"># self.lum.set(&#39;mode selection&#39;, Mode)</span>
            

        
        <span class="c1"># Add Z Monitor over stucute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power 2D Z-Normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">TaperWidthB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span> <span class="c1">#Substrate_Height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Add Movi Monitor Z-Normal over structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">TaperWidthB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
        
        
        <span class="c1"># Add Y Monitor over stucute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power 2D Y-Normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#Substrate_Height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

        
        <span class="c1"># #Add Extra Mesch</span>
        <span class="c1"># self.lum.addmesh()</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;Mesh PWB&quot;)</span>
        <span class="c1"># self.lum.set(&quot;based on a structure&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;structure&quot;, &quot;Taper_PWB&quot;)</span>
        <span class="c1"># self.lum.set(&quot;set maximum mesh step&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;override x mesh&quot;,0)</span>
        <span class="c1"># # self.lum.set(&quot;dx&quot;, x_res)</span>
        <span class="c1"># self.lum.set(&quot;override y mesh&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;dy&quot;, x_res)</span>
        <span class="c1"># self.lum.set(&quot;override z mesh&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;dz&quot;, x_res)</span>
        
        <span class="c1"># self.lum.addmesh()</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;Mesh Inverse Taper&quot;)</span>
        <span class="c1"># self.lum.set(&quot;based on a structure&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;structure&quot;, &quot;InverseTaper&quot;)</span>
        <span class="c1"># self.lum.set(&quot;set maximum mesh step&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;override x mesh&quot;,0)</span>
        <span class="c1"># # self.lum.set(&quot;dx&quot;, x_res)</span>
        <span class="c1"># self.lum.set(&quot;override y mesh&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;dy&quot;, x_res)</span>
        <span class="c1"># self.lum.set(&quot;override z mesh&quot;,1)</span>
        <span class="c1"># self.lum.set(&quot;dz&quot;, x_res)</span>
        
        
    
    
    
<div class="viewcode-block" id="Constructor.setCascadetMMIFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setCascadetMMIFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setCascadetMMIFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">,</span> <span class="n">SpaceX</span><span class="p">,</span> <span class="n">SpaceY</span><span class="p">):</span>
        
        
            <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
            <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
            <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
    
            <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
            <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
            <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
            <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
            <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
            <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
            <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
            <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
            <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
            <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
            <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
            <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            
            
            
            <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                
        
        
                <span class="c1"># Device specifications</span>
                <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span>
                <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceY</span><span class="c1"># MMI_Width</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
                <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="c1"># Ports_mid = Substrate_Height + Slab_Height + WG_Height / 2</span>
                <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
                <span class="c1"># WG_H = WG_Height</span>
            
                <span class="n">x_Offset</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="n">WG_Length</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
                <span class="c1"># Positions of the Input and Output WGs</span>
                <span class="c1"># Triangle EQ for MMI Width</span>

                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> 
                <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)]</span>
                <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="p">)</span>  <span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span> <span class="p">)]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Bot&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Bot&#39;</span><span class="p">]</span>
                
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">+</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span><span class="o">-</span> <span class="n">posOffset</span> <span class="o">-</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                
                <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
                <span class="c1"># if overLapp &lt; 0:</span>
                <span class="c1">#     y_Port_Span_old = y_Port_Span</span>
                <span class="c1">#     y_Port_Span = yPort_vec[2]*2</span>
                <span class="c1">#     print((f&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! So the y Span of the ports will be reduze from y_span = {y_Port_Span_old} to y_span_new = {y_Port_Span}&quot;))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



            
            <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                
     
                <span class="c1"># Device specifications</span>
                <span class="n">Device_Length</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">MMI_Length</span> <span class="o">+</span><span class="mi">4</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">TaperLength</span> <span class="o">+</span> <span class="n">SpaceX</span>
                <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">SpaceY</span><span class="c1"># MMI_Width</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
                <span class="c1"># Ports_mid = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span>
                <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
                <span class="c1"># WG_H = WG_Height</span>
                <span class="n">x_Offset</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">TaperLength</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
                <span class="c1"># Positions of the Input and Output WGs</span>
                <span class="c1"># Triangle EQ for MMI Width</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">OffsetInput</span><span class="p">,</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> 
                <span class="n">Parameters__Position_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="p">,</span> <span class="o">-</span><span class="n">SpaceX</span> <span class="o">-</span><span class="n">MMI_Length</span>  <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span><span class="p">]</span>
                <span class="n">Parameters__Position_Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Wid</span> <span class="o">+</span> <span class="n">SpaceY</span><span class="p">)]</span>
                <span class="n">y_span</span> <span class="o">=</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Parameters__Position_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">yPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
                <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="n">TaperLength</span> <span class="p">)</span>  <span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span><span class="p">),</span>  <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">MMI_Length</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">SpaceX</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">TaperLength</span> <span class="p">)]</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Backward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward&#39;</span><span class="p">]</span>
            
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output1_Bot&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Top&#39;</span><span class="p">,</span> <span class="s1">&#39;Output2_Bot&#39;</span><span class="p">]</span>
                
                <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="n">posOffset</span> <span class="o">+</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="n">y_span</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span> <span class="n">y_span</span> <span class="o">-</span> <span class="n">WG_Width</span><span class="o">-</span> <span class="n">posOffset</span> <span class="o">-</span>  <span class="n">WG_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
                
                
                <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">x_Offset</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>

                <span class="n">PortCorrection</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">,</span><span class="mf">0.1e-6</span><span class="p">,</span> <span class="mf">0.1e-6</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="c1"># Power Monitor Port 1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">PortCorrection</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




                <span class="c1"># Add Power and Freq Monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">x_Offset</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5e-6</span> <span class="o">+</span> <span class="n">Device_Length</span> <span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Width</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


              

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Constructor.setGratingCouplerFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setGratingCouplerFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setGratingCouplerFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the GratingCouplerFDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="sd">                Lenght of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Input Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="sd">            Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="sd">            Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="sd">                Widht of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="sd">                Hight of the Grating Coupler Material</span>
<span class="sd">            Parameters[&#39;Taper&#39;] : boolen</span>
<span class="sd">                Add Taper to structure</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                  Length of the Taper</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                  Wavelength</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                  Mesh x-Axis</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                  List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">            Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="sd">                Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="sd">       </span>
<span class="sd">            </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
       

        <span class="n">SubstrateThickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">GC_SectionLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Length GC&quot;</span><span class="p">]</span>
        <span class="n">InputLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Input Length GC&quot;</span><span class="p">]</span>
        <span class="n">OutputLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Output Length GC&quot;</span><span class="p">]</span>
        <span class="n">WidthGC</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Width GC&quot;</span><span class="p">]</span>
        <span class="n">Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Taper&quot;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">ZSpan</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Z Span&quot;</span><span class="p">]</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Theta&quot;</span><span class="p">]</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">CladdingThickness</span> <span class="o">=</span> <span class="mf">0.7e-6</span>
        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">GC_SectionLenght</span> <span class="o">+</span> <span class="n">InputLenght</span> <span class="o">+</span> <span class="n">OutputLenght</span> <span class="o">+</span> <span class="n">TaperLength</span>
        <span class="n">FDTD_ZSpan</span> <span class="o">=</span> <span class="n">Hight</span> <span class="o">+</span> <span class="n">CladdingThickness</span> <span class="o">+</span> <span class="n">SubstrateThickness</span>


        <span class="c1"># Define Ports</span>
        <span class="n">Port_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_SMF_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;Output&quot;</span><span class="p">]</span>
       
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="n">fiber_xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Adds a Finite-Difference Time-Domain  (FDTD) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, -TaperLength / 2)</span>
            <span class="c1"># self.lum.set(&quot;x span&quot;, Device_Length)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span>  <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            
            <span class="c1"># Detect Fiber position for Port exact aligment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">fiber_xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">fiber_ypos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">fiber_zpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
            <span class="n">fiber_core_diameter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
            <span class="n">fiber_core_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">fiber_theta</span> <span class="o">=</span> <span class="n">Theta</span>

    

            <span class="c1"># Faser Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;z-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Backward&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">Theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&#39;x span&#39;, CoreDiameter + CoreDiameter / 2)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation offset&quot;</span><span class="p">,</span> <span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">SubstrateThickness</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>


            <span class="c1"># Output Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Forward&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


            <span class="c1"># Power Monitor SMF Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
            <span class="c1"># self.lum.set(&#39;x span&#39;, CoreDiameter + CoreDiameter / 2)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



            <span class="c1"># Power Monitor Output Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            
            <span class="c1"># Add Global Power and Freq Monitor Z-Normal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Z-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
            <span class="c1"># Add Global Movie Monitor Z-Normal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Z-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            <span class="c1"># Add Global Power and Freq Monitor Y-Axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Y-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
            <span class="c1"># Add Global Movie Monitor Y-Axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Y-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="o">-</span> <span class="n">TaperLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>


            <span class="c1"># Select Source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;FDTD::ports&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;source port&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_SMF_Port&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Adds a Finite-Difference Time-Domain  (FDTD) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            
            
            <span class="c1"># Detect Fiber position for Port exact aligment</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">fiber_xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">fiber_ypos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">fiber_zpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
            <span class="n">fiber_core_diameter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
            <span class="n">fiber_core_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="n">fiber_theta</span> <span class="o">=</span> <span class="n">Theta</span>
            
            
            <span class="c1"># Faser Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;z-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Backward&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">Theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation offset&quot;</span><span class="p">,</span> <span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3e-6</span><span class="p">)</span>


            <span class="c1"># Output Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Forward&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


            <span class="c1"># Power Monitor SMF Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


            <span class="c1"># Power Monitor Output Port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            
            
            <span class="c1"># Add Global Power and Freq Monitor Z-Normal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Z-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
            <span class="c1"># Add Global Movie Monitor Z-Normal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Z-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">WidthGC</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            
            <span class="c1"># Add Global Power and Freq Monitor Y-Axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Y-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
            <span class="c1"># Add Global Movie Monitor Y-Axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Y-normal&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">InputLenght</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
            

 

            <span class="c1"># Select Source</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;FDTD::ports&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;source port&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_SMF_Port&#39;</span><span class="p">)</span></div>

            
         


         
<div class="viewcode-block" id="Constructor.setRingGratingCouplerFDTDSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setRingGratingCouplerFDTDSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setRingGratingCouplerFDTDSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the RingGratingCouplerFDTDSolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="sd">                Lenght of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Input Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="sd">            Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="sd">                An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="sd">            Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="sd">                Widht of the Grating Coupler Area</span>
<span class="sd">            Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="sd">                Hight of the Grating Coupler Material</span>
<span class="sd">            Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="sd">                Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                  Length of the input Taper</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                  Wavelength</span>
<span class="sd">            Parameters[&#39;x res&#39;] : int/float</span>
<span class="sd">                  Mesh x-Axis</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                  List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">        </span>
<span class="sd">       </span>
<span class="sd">            </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">SubstrateThickness</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">GC_SectionLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Length GC&quot;</span><span class="p">]</span>
        <span class="n">InputLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Input Length GC&quot;</span><span class="p">]</span>
        <span class="n">OutputLenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Output Length GC&quot;</span><span class="p">]</span>
        <span class="n">WidthGC</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Width GC&quot;</span><span class="p">]</span>
        <span class="n">Hight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">GCRadius</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GC Radius&quot;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">ZSpan</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Z Span&quot;</span><span class="p">]</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Theta&quot;</span><span class="p">]</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">CladdingThickness</span> <span class="o">=</span> <span class="mf">0.7e-6</span>
        
        
        
        
        

        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span>  <span class="n">GC_SectionLenght</span> <span class="o">+</span> <span class="n">OutputLenght</span> <span class="o">+</span> <span class="n">TaperLength</span> 
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">WidthGC</span> <span class="o">+</span> <span class="p">(</span> <span class="n">GCRadius</span> <span class="o">+</span> <span class="n">GC_SectionLenght</span> <span class="o">+</span> <span class="n">OutputLenght</span>  <span class="o">-</span> <span class="n">GCRadius</span><span class="p">)</span>
        <span class="n">FDTD_ZSpan</span> <span class="o">=</span> <span class="n">Hight</span> <span class="o">+</span> <span class="n">CladdingThickness</span> <span class="o">+</span> <span class="n">SubstrateThickness</span>
       
        




        <span class="c1"># Define Ports</span>
        <span class="n">Port_Names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Input_SMF_Port&quot;</span><span class="p">,</span> <span class="s2">&quot;Output&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="n">fiber_xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>

        <span class="c1"># Adds a Finite-Difference Time-Domain  (FDTD) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span>  <span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght +1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span>  <span class="n">SubstrateThickness</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;Anti-Symmetric&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Detect Fiber position for Port exact aligment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="n">fiber_xpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">fiber_ypos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">fiber_zpos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF::core&quot;</span><span class="p">)</span>
        <span class="n">fiber_core_diameter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;radius&quot;</span><span class="p">)</span>
        <span class="n">fiber_core_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="n">fiber_theta</span> <span class="o">=</span> <span class="n">Theta</span>

        <span class="c1"># Faser Port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;z-axis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Backward&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">Theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">SubstrateThickness</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation offset&quot;</span><span class="p">,</span> <span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>


        <span class="c1"># Output Port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addport</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">8e-6</span> <span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;injection axis&#39;</span><span class="p">,</span> <span class="s2">&quot;x-axis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="s2">&quot;Forward&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mode selection&#39;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>




        <span class="c1"># Power Monitor SMF Port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span><span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fiber_xpos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;x span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ZSpan</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>



        <span class="c1"># Power Monitor Output Port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Power_&quot;</span> <span class="o">+</span> <span class="n">Port_Names</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D X-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">8e-6</span> <span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


        <span class="c1"># Add Global Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Z-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght +1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
        <span class="c1"># Add Global Power and Freq Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Z-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Z-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght +1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
 


        <span class="c1"># Add Global Power and Freq Monitor Y-Axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Power_Monitor Y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght + 1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Px&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Py&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output Pz&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;output power&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        
        <span class="c1"># Add Global Movie Monitor Y-Axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Global_Movie_Monitor Y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght + 1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        
        
        <span class="c1"># Add Refractive index Monitor </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;Refractive Index Monitor Y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s1">&#39;2D Y-normal&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">GC_SectionLenght</span><span class="o">/</span><span class="mi">2</span>  <span class="o">-</span> <span class="mf">10e-6</span> <span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;,  GCRadius + GC_SectionLenght/2 + OutputLenght + 1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span>  <span class="n">fiber_xpos</span> <span class="o">+</span> <span class="n">CoreDiameter</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">Hight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        

        <span class="c1"># Select Source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;FDTD::ports&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;source port&#39;</span><span class="p">,</span> <span class="s1">&#39;Input_SMF_Port&#39;</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.setLenseFiberFDTD">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setLenseFiberFDTD">[docs]</a>
    <span class="k">def</span> <span class="nf">setLenseFiberFDTD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

        <span class="n">Lens_d</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Lense Diameter&quot;</span><span class="p">]</span>
        <span class="n">x_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;x res&#39;</span><span class="p">]</span>
        <span class="n">Wavelength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>

        <span class="c1"># Set FDTD Solver directly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfdtd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">15e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">15e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z min bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z max bc&#39;</span><span class="p">,</span> <span class="s1">&#39;PML&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;mesh type&#39;</span><span class="p">,</span> <span class="s1">&#39;auto non-uniform&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;min mesh step&#39;</span><span class="p">,</span> <span class="n">x_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;set simulation bandwidth&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source center wavelength&#39;</span><span class="p">,</span> <span class="n">Wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;global source wavelength span&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Add Gausssian Source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addgaussian</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;injection axis&quot;</span><span class="p">,</span> <span class="s2">&quot;z-axis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;direction&quot;</span><span class="p">,</span> <span class="s2">&quot;Forward&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Lens_d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Lens_d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waist radius w0&quot;</span><span class="p">,</span> <span class="n">Lens_d</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Add Index Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addindex</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D Y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">3e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>

        <span class="c1"># Add Movie Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmovie</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;movie&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D Y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">3e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>

        <span class="c1"># Add Power and field 3D monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Power 3D monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;3D&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">3e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Px&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Py&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Pz&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Reflection 2D Monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;2D Monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D X-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mf">50e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Px&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Py&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Pz&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D Z-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="mf">10e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">3e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Px&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Py&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output Pz&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setStraightWaveguideEMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setStraightWaveguideEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setStraightWaveguideEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the StraightWaveguideEMESolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">               Substrate height.</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">               Waveguide Length</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">               Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">               Waveguide width.</span>
<span class="sd">            Parameters[&quot;Taper&quot;] : boolen</span>
<span class="sd">               If Taper == False, only straight Waveguide will be simulated,</span>
<span class="sd">               If Taper == True an Taper will be simulated</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">               Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">               Taper Length</span>
<span class="sd">            Parameters[&#39;y res&#39;]: int/float</span>
<span class="sd">                 EME Mesh resolutio,</span>
<span class="sd">            Parameters[&#39;z res&#39;]: int/float</span>
<span class="sd">                 EME Mesh resolutio,</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">               Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">               Wavelength</span>
<span class="sd">            Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="sd">               This Parameter will set the theta ratation angle of the port. It can be 90 or 180.</span>
<span class="sd">            Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">               List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="sd">                    This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="sd">                    and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="sd">                    If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="sd">                    </span>
<span class="sd">                    If Parameters[&quot;Taper Type&quot;] is given, themn the user need to set couple more parameters:</span>
<span class="sd">                        Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">                            Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">                            Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="sd">                            Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="sd">                            Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="sd">                        Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">                            Length of the Photonic Wire Bonding Taper</span>
<span class="sd">                            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
    




        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Waveguide Angle&quot;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">WG_Length</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">WG_Length</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>

                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

                <span class="c1"># Define Ports</span>

                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># Calc Output Loc</span>
                <span class="n">sideLength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span> <span class="n">WG_Length</span>
                <span class="n">sideHight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">WG_Length</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sideLength</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>

                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>



                <span class="c1"># Define Ports</span>

                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="n">WG_Length</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">sideHight</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="n">angle</span><span class="p">,</span> <span class="n">angle</span><span class="p">]</span>


                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>



        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">EME_WGLength</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># # Device specifications</span>
                <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
              
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># # Device specifications</span>
                <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
                <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">Substrate_Height</span>  <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
                
            <span class="k">if</span> <span class="s2">&quot;Taper Type&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Inverse&quot;</span>
                <span class="n">TaperWidthF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Front&#39;</span><span class="p">]</span>
                <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
                <span class="n">TaperHightF</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Front&#39;</span><span class="p">]</span>
                <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">TaperType</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
                
                

            
            
            <span class="k">if</span> <span class="n">TaperType</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span><span class="p">:</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span> <span class="o">-</span> <span class="mf">0.2e-6</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>

                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

                <span class="c1"># Define Ports</span>
                <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
           
                
           
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="c1"># self.lum.set(&quot;z&quot;, Substrate_Height)</span>
                <span class="c1"># self.lum.set(&quot;z span&quot;, 4e-6)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Substrate_Height</span> <span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

                <span class="c1"># set cell properties</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">EME_WGLength</span> <span class="o">-</span> <span class="mf">0.2e-6</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">30</span><span class="p">]]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>

                <span class="c1"># Modes to Calculate</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

                <span class="c1"># Mesh Cells</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
                
                
                <span class="c1"># Define Ports</span>
                <span class="n">Diff_Span</span> <span class="o">=</span> <span class="n">y_Port_Span</span> <span class="o">-</span> <span class="n">WG_Width</span>
                <span class="n">yPos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span><span class="n">y_Port_Span</span><span class="p">,</span> <span class="n">TaperWidth</span> <span class="o">+</span> <span class="n">Diff_Span</span><span class="p">]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME&quot;</span><span class="p">)</span>
                <span class="n">Span_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">)</span>
                <span class="n">yPos_span</span> <span class="o">=</span> <span class="p">[</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">Diff_Span</span> <span class="p">,</span> <span class="n">y_Port_Span</span> <span class="p">]</span>
                <span class="n">z_Pos</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="n">Span_z</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightB</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>  <span class="o">-</span><span class="n">Span_z</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">TaperHightF</span><span class="o">/</span><span class="mi">2</span> <span class="p">]</span>
                <span class="n">z_Span</span> <span class="o">=</span> <span class="p">[</span> <span class="n">TaperHightB</span> <span class="o">+</span> <span class="n">z_Port_Span</span> <span class="p">,</span> <span class="n">TaperHightF</span><span class="o">/</span><span class="mi">2</span>  <span class="o">+</span> <span class="n">z_Port_Span</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">yPos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">yPos_span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">z_Pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Span</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                


                <span class="c1"># Add monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>

            
            


<div class="viewcode-block" id="Constructor.setDCEMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setDCEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setDCEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the DCEMESolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="sd">                Height of the Substrate</span>
<span class="sd">            Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="sd">                Width of the MMI</span>
<span class="sd">            Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="sd">                Length of the Directional coupler</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="sd">                Height of the Waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="sd">                Waveguide Width</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="sd">                Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="sd">                will be offset of the middle position (y = 0) by the half of there</span>
<span class="sd">                Width. In this case they will not overlap if the Offset is 0.</span>
<span class="sd">            Parameters[&#39;y res&#39;] : float/int</span>
<span class="sd">                Mesh resolution for the y-Axis</span>
<span class="sd">            Parameters[&#39;z res&#39;] : float/int</span>
<span class="sd">                Mesh resolution for the z Axis</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="sd">                Slab height.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">DC_Lenght</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;DC Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">DC_Lenght</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">DC_Lenght</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># Define Ports</span>
        <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>

        <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Add monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.setMMI2x1EMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setMMI2x1EMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x1EMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the MMI2x1EMESolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of MMI</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of MMI</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="sd">                For anfle = 90 we get a perfect rect!</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Heigth of waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width og waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of waveguide</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="sd">                Input waveguide/taper offset.</span>
<span class="sd">            Parameters[&quot;Taper&quot;]: boolen </span>
<span class="sd">                Add Taper to the structure on the input and output waveguids</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="sd">                Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="sd">            Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="sd">            Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="sd">                This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="sd">                becouse the maschine of our physic departmant had some proiblems with the LNOI objects design. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">OffsetInput</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Offset Input&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>



        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># 1x2 MMI</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="c1"># set cell properties no Taper</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>

            <span class="c1"># 1x2 MMI</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># creating the MMI</span>
        <span class="n">max_MMIH</span> <span class="o">=</span> <span class="n">WG_Height</span>

        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">MMI_Wid</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>

        <span class="c1"># Positions of the Input and Output WGs</span>
        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">max_MMIH</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">max_MMIH</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Wid</span> <span class="o">/</span> <span class="mi">2</span>
        
        
        <span class="n">offset_Set_R</span> <span class="o">=</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">OffsetInput</span> <span class="o">-</span> <span class="n">WG_W</span> <span class="o">&lt;=</span> <span class="n">OffMin</span> <span class="ow">or</span> <span class="n">OffsetInput</span> <span class="o">+</span> <span class="n">WG_W</span> <span class="o">&gt;=</span> <span class="n">OffMax</span> <span class="ow">or</span> <span class="n">offset_Set_R</span> <span class="o">&gt;</span> <span class="n">OffMax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;You are Trying to move the input or output Waveguide outside the MMI area. This is not possible! Max Input/Output Offset = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">OffMax</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; and Min Input/output Offset = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">OffMin</span><span class="p">))</span>


        <span class="c1"># Define Ports</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if OffsetInput &gt; 0:</span>
            <span class="c1">#     max_yPos = [(OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [0, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>
            <span class="c1"># elif OffsetInput &lt; 0:</span>
            <span class="c1">#     max_yPos = [0, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [-(abs(OffsetInput)) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>

            <span class="c1"># else:</span>
            <span class="c1">#     max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
            <span class="c1">#     min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>
            <span class="c1">#     portLoc = [&quot;right&quot;, &quot;left&quot;, &quot;left&quot;]</span>

            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">OffsetInput</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">]</span>

            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="c1"># self.lum.set(&quot;y min&quot;, min_yPos[i])</span>
                <span class="c1"># self.lum.set(&quot;y max&quot;, max_yPos[i])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

        <span class="c1"># Define the Motinot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.setMMI2x2EMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setMMI2x2EMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setMMI2x2EMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the MMI2x2EMESolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of MMI</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of MMI</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Heigth of waveguide</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Width og waveguide</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Length of waveguide</span>
<span class="sd">            Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="sd">                Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="sd">                betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="sd">                the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="sd">                becouse of manufactering restrictions in the University.</span>
<span class="sd">            Parameters[&quot;Taper&quot;]: boolen </span>
<span class="sd">                Add Taper to the structure on the input and output waveguids</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="sd">                Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                Mesh cell size.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
    
 

        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">posOffset</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Position Offset&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>
        <span class="n">Taper</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>




        <span class="k">if</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>


            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>

        <span class="k">elif</span> <span class="n">Taper</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>

            <span class="c1"># Device specifications</span>
            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># MMI_Width</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>

            <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>

            <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TaperLength</span>
            <span class="c1"># set cell properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength</span><span class="p">],</span> <span class="p">[</span><span class="n">WG_Length</span><span class="o">-</span><span class="mf">0.1e-6</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Taper variable!. Possible Taper values are Taper = False or Taper = True.&quot;</span><span class="p">)</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># define two values for upper and lower limit of the WG offsets</span>
        <span class="n">OffMin</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">OffMax</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">posOffset</span> <span class="o">&lt;=</span> <span class="n">OffMin</span> <span class="ow">or</span> <span class="n">posOffset</span> <span class="o">&gt;=</span> <span class="n">OffMax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You are Trying to move the Waveguide outside the MMI. This is not possible!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define Ports</span>
            <span class="n">yPort_vec</span> <span class="o">=</span> <span class="p">[</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">posOffset</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>


            <span class="n">overLapp</span> <span class="o">=</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_Port_Span</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">overLapp</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;!!! CAUTION !!! - The Ports are overlapping at the middle! Please change the Y Port Span or move the Waveguides away from each other!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeport</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">yPort_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;y span&#39;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">Device_Length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>







<div class="viewcode-block" id="Constructor.setWDMEMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setWDMEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setWDMEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the WDMEMESolver.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate height.</span>
<span class="sd">            Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="sd">                Width of the MMI.</span>
<span class="sd">            Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="sd">                Length of the MMI.</span>
<span class="sd">            Parameters[&#39;WG Height&#39; : int/float</span>
<span class="sd">                Waveguide hight. Also the height of the MMI section</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Waveguide length.</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide width.</span>
<span class="sd">            Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="sd">                Taper backside width, frontside width is the waveguide width.</span>
<span class="sd">            Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="sd">                Taper Length</span>
<span class="sd">            Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                Mesh y-Axis</span>
<span class="sd">            Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                Mesh z-Axis</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Slab Height.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength</span>
<span class="sd">            Parameters[&#39;Angle Thetha&#39;] : boolen</span>
<span class="sd">                Angle for the input and output waveguides</span>
<span class="sd">            Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">            Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="sd">                Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>

<span class="sd">            Raises</span>
<span class="sd">            ------</span>
<span class="sd">            ValueError</span>
<span class="sd">                DESCRIPTION.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None.</span>

<span class="sd">                &#39;&#39;&#39;</span>



        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">MMI_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Width&#39;</span><span class="p">]</span>
        <span class="n">MMI_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;MMI Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">angleTheta</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Angle Thetha&#39;</span><span class="p">]</span>
        <span class="n">TaperWidth</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Width&#39;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">TaperLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Taper Length&#39;</span><span class="p">]</span>


        <span class="c1"># Device specifications</span>
        <span class="n">Device_Length</span> <span class="o">=</span> <span class="n">MMI_Length</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">WG_Length</span>
        <span class="c1"># Device_Width = MMI_Width + 2*WG_Length + WaveLength * 2  # MMI_Width</span>
        <span class="n">Device_Width</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">WG_Length</span> <span class="o">+</span> <span class="n">WaveLength</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
        <span class="c1"># MonitorHeight = Substrate_Height + (max_slabH + WG_Height) / 2</span>
        <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
        <span class="c1"># Ports_mid = (max_slabH + WG_Height) / 2</span>
        <span class="n">Ports_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>


        <span class="c1"># EME Boundary Length</span>
        <span class="n">BoardLen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">*</span> <span class="n">TaperLength</span>
        <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">BoardLen</span> <span class="o">-</span> <span class="n">MMI_Length</span><span class="o">/</span><span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Device_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span> <span class="o">+</span> <span class="mf">0.1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">BoardLen</span> <span class="p">],</span> <span class="p">[</span><span class="n">MMI_Length</span><span class="p">],</span> <span class="p">[</span><span class="n">BoardLen</span> <span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">15</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>

        <span class="c1"># max_yPos = [(WG_W / 2 + OffsetInput) * 2, 0, (WG_Width / 2 + posOffset / 2) * 2]</span>
        <span class="c1"># min_yPos = [-(WG_W / 2 + OffsetInput) * 2, -(WG_Width / 2 + posOffset / 2) * 2, 0]</span>


        <span class="k">if</span> <span class="n">angleTheta</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">Input_yPos</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>   <span class="c1"># Correction factor so that Ports are in the WG 0.1e-6</span>
            <span class="n">Input_Y</span> <span class="o">=</span> <span class="n">Input_yPos</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>


            <span class="n">Output_yPos</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span><span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="n">Output_yPos</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>




            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Input_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Output_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
            <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Correction in Y-Axis</span>
            <span class="n">difY</span> <span class="o">=</span> <span class="p">(</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angleTheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span>
            <span class="n">NewY</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">TaperWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">difY</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># - xLen - Diff/2 #</span>

            <span class="n">Input_yPos</span> <span class="o">=</span> <span class="o">-</span><span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Corr</span> <span class="o">=</span> <span class="n">TaperLength</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">angleTheta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Input_Y</span> <span class="o">=</span> <span class="n">NewY</span> <span class="o">-</span> <span class="n">difY</span><span class="o">/</span><span class="mi">2</span>


            <span class="n">Output_yPos</span> <span class="o">=</span> <span class="n">MMI_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">TaperWidth</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="n">Output_yPos</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">TaperLength</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">BoardLen</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">WG_Width</span>
            <span class="n">Output_Y</span> <span class="o">=</span> <span class="o">-</span><span class="n">NewY</span> <span class="o">+</span> <span class="n">difY</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>




            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Input_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="o">*</span><span class="mi">3</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">Output_Y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="o">*</span><span class="mi">3</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">angleTheta</span><span class="p">)</span>

            <span class="c1"># Add monitor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Device_Length</span><span class="p">)</span>
            <span class="c1"># self.lum.set(&quot;x min&quot;, -(Device_Length / 2))</span>
            <span class="c1"># self.lum.set(&quot;x max&quot;, (Device_Length / 2))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="n">Device_Width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span></div>








<div class="viewcode-block" id="Constructor.setInverseTaperEMESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setInverseTaperEMESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setInverseTaperEMESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Parameters</span>
<span class="sd">          ----------</span>
<span class="sd">          Parameters : Dictionary</span>
<span class="sd">              Dictionary with all the data needet for the InverseTaperEMESolver.</span>
<span class="sd">              Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                  Substrate height.</span>
<span class="sd">              Parameters[&#39;WG Height&#39; : int/float</span>
<span class="sd">                  Waveguide hight. Also the height of the MMI section</span>
<span class="sd">              Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                  Waveguide width.</span>
<span class="sd">              Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                  Slab height</span>
<span class="sd">              Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="sd">                  Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="sd">              Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="sd">                  Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="sd">              Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="sd">                  Length of the Photonic Wire Bonding Taper</span>
<span class="sd">              Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber core Diameter</span>
<span class="sd">              Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="sd">                Single Mode Fiber Cladding Diameter</span>
<span class="sd">              Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                  Mesh y-Axis</span>
<span class="sd">              Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                  Mesh z-Axis</span>
<span class="sd">              Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                  Wavelength</span>
<span class="sd">              Parameters[&quot;Mode&quot;] : str</span>
<span class="sd">                  Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="sd">              Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="sd">                  List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="sd">          </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
    
    
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">TaperWidthB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Width Back&#39;</span><span class="p">]</span>
        <span class="n">TaperHightB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Hight Back&#39;</span><span class="p">]</span>
        <span class="n">TaperLength_PWB</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;PWB Taper Length&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="n">y_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">z_res</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">y_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z_Port_Span</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Port Span&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># SMF Parameters</span>
        <span class="n">CoreDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Core Diameter&quot;</span><span class="p">]</span>
        <span class="n">CladdingDiameter</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;SMF Cladding Diameter&quot;</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># # Device specifications</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">MonitorHeight</span>
            <span class="n">Ports_PWB_mid</span> <span class="o">=</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># TaperHightB/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">xPos_SMF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xPos_SMF</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># # Device specifications</span>
            <span class="n">max_slabH</span> <span class="o">=</span> <span class="n">Slab_Height</span>
            <span class="n">MonitorHeight</span> <span class="o">=</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">Ports_mid</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">MonitorHeight</span>
            <span class="c1">#Ports_mid = max_slabH + Substrate_Height/2 - CoreDiameter/2 + WG_Width/2</span>
            <span class="n">Ports_PWB_mid</span> <span class="o">=</span> <span class="n">max_slabH</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># TaperHightB/2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
            <span class="n">xPos_SMF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">X_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xPos_SMF</span><span class="p">)</span>
        



        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addeme</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">X_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span> <span class="o">+</span> <span class="n">TaperWidthB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;simulation temperature&#39;</span><span class="p">,</span> <span class="mf">273.15</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">CoreDiameter</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span> <span class="c1">#Substrate_Height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="c1"># set cell properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;InverseTaper::WG_Extention_Inverse_Taper&quot;</span><span class="p">)</span>
        <span class="n">ExtWG_Lenght</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;poles&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;number of cell groups&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;group spans&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.1e-6</span><span class="p">],</span> <span class="p">[</span><span class="n">TaperLength_PWB</span><span class="p">],</span> <span class="p">[</span><span class="n">ExtWG_Lenght</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;subcell method&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>

        <span class="c1"># Modes to Calculate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;number of modes for all cell groups&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Mesh Cells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define y mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;define z mesh by&quot;</span><span class="p">,</span> <span class="s2">&quot;maximum mesh step&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dz&quot;</span><span class="p">,</span> <span class="n">z_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>


        <span class="n">portLoc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span>
        <span class="c1"># z_span_PWB = CoreDiameter/2 + (z_Port_Span - WG_Height)/2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># self.lum.set(&quot;use full simulation span&quot;, 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">CoreDiameter</span> <span class="o">+</span> <span class="mf">2e-6</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;EME::Ports::port_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;port location&quot;</span><span class="p">,</span> <span class="n">portLoc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># self.lum.set(&quot;use full simulation span&quot;, 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use full simulation span&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">y_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">Ports_mid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">z_Port_Span</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mode selection&quot;</span><span class="p">,</span> <span class="n">Mode</span><span class="p">)</span>



        <span class="c1"># Add monitor Horizondal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB+11e-6)</span>
        <span class="c1"># self.lum.set(&quot;x min&quot;, X_min - 5e-6)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;, TaperLength_PWB/2 + 15e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">TaperWidthB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>


        <span class="c1"># Add monitor Vertical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemeprofile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;monitor type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D Y-normal&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, TaperLength_PWB+11e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">TaperLength_PWB</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">TaperLength_PWB</span> <span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x min&quot;, X_min - 5e-6)</span>
        <span class="c1"># self.lum.set(&quot;x max&quot;, TaperLength_PWB/2 + 15e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, TaperWidthB*2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">MonitorHeight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">TaperHightB</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span></div>






<div class="viewcode-block" id="Constructor.setWaveguideFDESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setWaveguideFDESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">setWaveguideFDESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary</span>
<span class="sd">            Dictionary with all the data needet for the WaveguideFDESolver.</span>
<span class="sd">            Parameters : Dictionary</span>
<span class="sd">                Dictionary with all the data needet for the Bend Wavaguide. Data needet:</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;]: int/float   </span>
<span class="sd">                Substrate height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Heigth of waveguide</span>
<span class="sd">            Parameters[&#39;y res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;z res&#39;] : int/float</span>
<span class="sd">                Mesh cell sizes.</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="sd">                Height of the slab.</span>
<span class="sd">            Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="sd">                Wavelength.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">SubstrateHight</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>
        

        <span class="c1"># FDE Dimensions</span>
        <span class="n">WG_Mid</span> <span class="o">=</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">WG_Height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfde</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;solver type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D X normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define y mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define z mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mf">5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">WG_Mid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span> <span class="n">WG_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">SubstrateHight</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.setGratingCouplerNeffFDE">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.setGratingCouplerNeffFDE">[docs]</a>
    <span class="k">def</span> <span class="nf">setGratingCouplerNeffFDE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

        <span class="n">GC_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Hight GC&quot;</span><span class="p">]</span>
        <span class="n">Pitch</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Pitch GC&quot;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;y res&#39;</span><span class="p">]</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;z res&#39;</span><span class="p">]</span>
        <span class="n">WaveLength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Wavelength&#39;</span><span class="p">]</span>

        <span class="c1"># FDE Dimensions</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">-</span> <span class="n">Pitch</span>
        <span class="n">WG_Mid</span> <span class="o">=</span> <span class="n">GC_Height</span> <span class="o">/</span> <span class="mi">2</span>


        <span class="c1"># Adds a Eigenmode Expansion (EME) solver region to the MODE simulation environment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfde</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;solver type&#39;</span><span class="p">,</span> <span class="s2">&quot;2D X normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define y mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;define z mesh by&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum mesh step&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dz&#39;</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max bc&quot;</span><span class="p">,</span> <span class="s2">&quot;PML&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fit materials with multi-coefficient model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength start&#39;</span><span class="p">,</span> <span class="mf">0.4e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;wavelength stop&#39;</span><span class="p">,</span> <span class="mf">2e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">Pitch</span><span class="o">+</span><span class="n">Gap</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">WG_Mid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z span&#39;</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">WaveLength</span><span class="p">)</span></div>





    <span class="c1"># =============================================================================</span>
    <span class="c1"># Functions</span>
    <span class="c1"># =============================================================================</span>


<div class="viewcode-block" id="Constructor.StartEMESimulation">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StartEMESimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartEMESimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;emepropagation&#39; of the mode 1 port 1</span>
<span class="sd">        will be done.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">emepropagate</span><span class="p">()</span></div>





<div class="viewcode-block" id="Constructor.StartFDTDSimulation">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StartFDTDSimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFDTDSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;emepropagation&#39; of the mode 1 port 1</span>
<span class="sd">        will be done.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>

        
        
       
<div class="viewcode-block" id="Constructor.StartFDTDOptimizerRingGratingCoupler">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StartFDTDOptimizerRingGratingCoupler">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFDTDOptimizerRingGratingCoupler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tranmission_on_Port</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
   
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;SMF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;FDTD::ports::Input_SMF_Port&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Power_Input_SMF_Port&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;FDTD::ports::&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Tranmission_on_Port</span><span class="p">),</span> <span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="s2">&quot;T&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div>

  



<div class="viewcode-block" id="Constructor.StartFDESimulation">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.StartFDESimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFDESimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This Function will save a the construted object under the name &quot;SimRun1&quot;</span>
<span class="sd">        then will run the simulation. The simulation cannot be done without first</span>
<span class="sd">        saving the object. On the end the &#39;findmodes&#39; will simulate all 20 modes</span>
<span class="sd">        that are set by defoult to be calculated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">findmodes</span><span class="p">()</span></div>

        




<div class="viewcode-block" id="Constructor.ExtractFDTDResults">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ExtractFDTDResults">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDTDResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ports</span><span class="p">,</span> <span class="n">Sparam</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This fuction will add an S-Parameter Sweep to the FDTD simulation.</span>
<span class="sd">        This will allowed to sweep the S-parameter Matrix like it is done in</span>
<span class="sd">        EMe solver. Additionally will extract the Power on each port according to the time</span>
<span class="sd">        monitors that ware set in the solver functions.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Sparam</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addsweep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="c1"># Check &quot;Excite all ports&quot; option</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">setsweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">,</span> <span class="s2">&quot;Excite all ports&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
            <span class="c1"># run s-parameter sweep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">runsweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">)</span>

            <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">Power</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getsweepresult</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">,</span> <span class="s2">&quot;S matrix&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deletesweep</span><span class="p">(</span><span class="s2">&quot;s-parameter sweep&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span><span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorect Port number in ExtractFDTD() Function. Possible Port Numbers are int: 3 or 4! &quot;</span><span class="p">)</span>
            <span class="c1"># S21 = abs(OptionsEME1[&#39;S&#39;][0][2])**2</span>
            <span class="c1"># S31 = abs(OptionsEME1[&#39;S&#39;][0][1])**2</span>
            <span class="k">return</span> <span class="n">OptionsEME1</span><span class="p">,</span> <span class="n">Power</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">Power</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">Ports</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Input_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s1">&#39;Output_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Input_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_L&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission Output_R&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Power_Input_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Input_R&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_L&#39;</span><span class="p">,</span> <span class="s1">&#39;Power_Output_R&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;P&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
                    <span class="n">Power</span><span class="p">[</span><span class="s2">&quot;Transmission &quot;</span> <span class="o">+</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;T&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Incorect Port number in ExtractFDTD() Function. Possible Port Numbers are int: 3 or 4! &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Power</span></div>






<div class="viewcode-block" id="Constructor.ExtractEMEResults">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ExtractEMEResults">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractEMEResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="n">EMEName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        MonitorName : str</span>
<span class="sd">            The name of the monitor. By defoult the name will be &#39;monitor&#39;.</span>
<span class="sd">            So MonitorName = &#39;monitor&#39; can be used. In case of change in the name</span>
<span class="sd">            the new name of the monitor should be given.</span>
<span class="sd">        EMEName : str</span>
<span class="sd">            The name of the solver. In this case per defoult will be EMEName =</span>
<span class="sd">            &#39;EME&#39;. In case of change in the name, the new name should be given.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OptionsMonitor : dict</span>
<span class="sd">            Dictionary with:</span>
<span class="sd">                    &#39;lambda&#39;</span>
<span class="sd">                    &#39;f&#39;</span>
<span class="sd">                    &#39;x&#39;</span>
<span class="sd">                    &#39;y&#39;</span>
<span class="sd">                    &#39;z&#39;</span>
<span class="sd">                    &#39;E&#39;</span>
<span class="sd">                    &#39;H&#39;</span>
<span class="sd">                    &#39;Lumerical_dataset&#39;</span>
<span class="sd">        EME_Data : dict</span>
<span class="sd">            Dictionary with:</span>
<span class="sd">                    &#39;user s matrix&#39;</span>
<span class="sd">                    &#39;internal s matrix&#39;</span>
<span class="sd">                    &#39;local diagnostics&#39;</span>
<span class="sd">                    &#39;coefficients&#39;</span>
<span class="sd">                    &#39;global diagnostics&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Define List with all the data from monitor and EME</span>
        <span class="n">EME_Data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Check all avaliable variables for the monitor and EME</span>
        <span class="n">OptionsMonitor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">),</span> <span class="s1">&#39;field profile&#39;</span><span class="p">)</span>
        <span class="n">OptionsEME1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EMEName</span><span class="p">))</span>
        <span class="n">OptionsEME</span> <span class="o">=</span> <span class="n">OptionsEME1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">OptionsEME</span><span class="p">:</span>
            <span class="n">EME_Data</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">EMEName</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">OptionsMonitor</span><span class="p">,</span> <span class="n">EME_Data</span></div>





<div class="viewcode-block" id="Constructor.ExtractFDEModes">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ExtractFDEModes">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDEModes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EffIndexValue</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EffIndexValue : float/int</span>
<span class="sd">            Effective index value. All modes with effective index smaller then</span>
<span class="sd">            the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="sd">            index from the hole construction (usualy the cladding).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictData : dict</span>
<span class="sd">                 Dictionary with the modes polarization numbers</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dictModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictModes2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">modeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                    <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                  <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                      <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes2</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                   <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">return</span> <span class="n">dictModes</span><span class="p">,</span> <span class="n">dictModes2</span></div>




<div class="viewcode-block" id="Constructor.CoppyDcard">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.CoppyDcard">[docs]</a>
    <span class="k">def</span> <span class="nf">CoppyDcard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modeTE</span><span class="p">,</span> <span class="n">modeTM</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        modeTE : str</span>
<span class="sd">            The TE mode that will be copy to dCard to do the overlap analysis.</span>

<span class="sd">        modeTM : str</span>
<span class="sd">           The TM mode that will be copy to dCard to do the overlap analysis.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">copydcard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">modeTE</span><span class="p">),</span> <span class="s1">&#39;TE&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">copydcard</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">modeTM</span><span class="p">),</span> <span class="s1">&#39;TM&#39;</span><span class="p">)</span></div>





<div class="viewcode-block" id="Constructor.Overlap">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Overlap">[docs]</a>
    <span class="k">def</span> <span class="nf">Overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TEModes : dict</span>
<span class="sd">            Dictionary of TE - Modes.</span>
<span class="sd">        dictDataTE : dict</span>
<span class="sd">            Dictionary of TE - Modes E field values</span>
<span class="sd">        SweepDictTE : dict</span>
<span class="sd">            Dictionary of TE - Modes:</span>
<span class="sd">                    1) overlap Procentage</span>
<span class="sd">                    2) TE polarization fraction number</span>
<span class="sd">                    3) TE polarization fraction</span>
<span class="sd">                    4) loss</span>
<span class="sd">                    5) Ex</span>
<span class="sd">                    6) Ey</span>
<span class="sd">                    7) Ez</span>

<span class="sd">        TMModes : dict</span>
<span class="sd">            Dictionary of TM - Modes..</span>
<span class="sd">        dictDataTM : dict</span>
<span class="sd">            Dictionary of TM - Modes E field values.</span>
<span class="sd">        SweepDictTM : dict</span>
<span class="sd">            Dictionary of TM - Modes:</span>
<span class="sd">                    1) overlap Procentage</span>
<span class="sd">                    2) TE polarization fraction number</span>
<span class="sd">                    3) TE polarization fraction</span>
<span class="sd">                    4) loss</span>
<span class="sd">                    5) Ex</span>
<span class="sd">                    6) Ey</span>
<span class="sd">                    7) Ez</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">numModes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="n">TEModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictDataTE</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">SweepDictTE</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">TMModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictDataTM</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">SweepDictTM</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">numModes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; overlap Procentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TE&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                <span class="n">TEModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                      <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                          <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="n">dictDataTE</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">numModes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; overlap Procentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                <span class="n">TMModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                      <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                                                                          <span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                <span class="n">SweepDictTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="n">dictDataTM</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">TEModes</span><span class="p">,</span> <span class="n">dictDataTE</span><span class="p">,</span> <span class="n">SweepDictTE</span><span class="p">,</span> <span class="n">TMModes</span><span class="p">,</span> <span class="n">dictDataTM</span><span class="p">,</span> <span class="n">SweepDictTM</span></div>





<div class="viewcode-block" id="Constructor.ExtractFDEResultsExtendet">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.ExtractFDEResultsExtendet">[docs]</a>
    <span class="k">def</span> <span class="nf">ExtractFDEResultsExtendet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EffIndexValue</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        EffIndexValue : float/int</span>
<span class="sd">            Effective index value. All modes with effective index smaller then</span>
<span class="sd">            the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="sd">            index from the hole construction (usualy the cladding).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dictModes : dict</span>
<span class="sd">                Dictionary with:</span>
<span class="sd">                        &#39;TE polarization fraction num&#39;</span>
<span class="sd">                        &#39;effective area&#39;</span>
<span class="sd">                        &#39;effective index num&#39;</span>
<span class="sd">                        &#39;group index num&#39;</span>
<span class="sd">                        &#39;Ex&#39;</span>
<span class="sd">                        &#39;Ey&#39;</span>
<span class="sd">                        &#39;Ez&#39;</span>

<span class="sd">        dictData : dict</span>
<span class="sd">                 Dictionary with:</span>
<span class="sd">                             &#39;E&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dictModes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictModes2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dictData2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">modeList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">nummodes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                    <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                      <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                    <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictModes2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span>
                        <span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">modeList</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">modeList</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>  <span class="c1"># 1.45625:</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; group index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;ng&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                    <span class="n">dictData</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ez&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;neff&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">real</span> <span class="o">&gt;</span> <span class="n">EffIndexValue</span><span class="p">:</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; TE polarization fraction num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;TE polarization fraction&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; effective index num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;neff&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; group index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;ng&#39;</span><span class="p">)</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;loss&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
                    <span class="n">dictData2</span><span class="p">[</span><span class="s1">&#39;mode &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; Ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s1">&#39;FDE::data::mode&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">dictModes</span><span class="p">,</span> <span class="n">dictData</span><span class="p">,</span> <span class="n">dictModes2</span><span class="p">,</span> <span class="n">dictData2</span></div>





<div class="viewcode-block" id="Constructor.Plot3DFDTD">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Plot3DFDTD">[docs]</a>
    <span class="k">def</span> <span class="nf">Plot3DFDTD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>

        <span class="n">MonitorName</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Monitor Name FDTD&quot;</span><span class="p">]</span>
        <span class="n">Field</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Field FDTD&quot;</span><span class="p">]</span>

        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="n">Field</span><span class="p">]</span>

        <span class="n">Shape</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">])):</span>
                <span class="n">Ey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;z&quot;</span><span class="p">])):</span>
                <span class="n">Ez</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;z&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
                
                
            <span class="n">E_a</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E_a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>




        <span class="k">elif</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">])):</span>
                <span class="n">Ex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;z&quot;</span><span class="p">])):</span>
                <span class="n">Ez</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;z&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
            
            <span class="n">E_a</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E_a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>



        <span class="k">elif</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">])):</span>
                <span class="n">Ey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">])):</span>
                <span class="n">Ex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span><span class="p">)[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>
                
                
            <span class="n">E_a</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E_a</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">E_a</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This function can print only 2D fields and no 3D fields&quot;</span><span class="p">)</span>

        <span class="c1"># Calc Intensity and murge the 2D monitor data to one vector for printing</span>
        

        <span class="c1"># # Rotate the image by 90 degrees counterclockwise</span>
        <span class="c1"># slice_2d_rotated = np.rot90(slice_2d, k=3)</span>


        <span class="c1"># # Define the y and z axis ranges</span>
        <span class="c1"># z_range = np.linspace(-2.68e-6, 50e-6, slice_2d_rotated.shape[0]) * 1e6  # Convert to micrometers</span>
        <span class="c1"># y_range = np.linspace(-5e-6, 5e-6, slice_2d_rotated.shape[1]) * 1e6  # Convert to micrometers</span>

        <span class="c1"># Create the colormap plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span> <span class="n">slice_2d</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="c1"># plt.pcolormesh(y_range, z_range, slice_2d_rotated, cmap=&#39;jet&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$|&#39;</span><span class="o">+</span> <span class="n">Field</span> <span class="o">+</span> <span class="s1">&#39;|^2$ Intensity&#39;</span><span class="p">)</span>
        <span class="c1"># plt.xlabel(&#39;Width / $\mu m$&#39;)</span>
        <span class="c1"># plt.ylabel(&#39;$|E|^2$&#39;)</span>
        <span class="c1"># plt.title(&#39;Lense Thickness = 2.5 $\mu m$&#39;)</span>

        <span class="k">if</span> <span class="s2">&quot;Save Image&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># Save the plot as SVG</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Save Image&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Save Image&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span></div>




<div class="viewcode-block" id="Constructor.Plot3DFDE">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Constructor.Plot3DFDE">[docs]</a>
    <span class="k">def</span> <span class="nf">Plot3DFDE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
        <span class="n">MonitorName</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Mode FDE&quot;</span><span class="p">]</span>
        <span class="n">Field</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Field FDE&quot;</span><span class="p">]</span>

        <span class="n">Mode</span> <span class="o">=</span> <span class="s2">&quot;TM_LNOI_1x0,5um&quot;</span>
        <span class="n">Ex</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;FDE::data::&quot;</span> <span class="o">+</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span> <span class="o">+</span> <span class="s2">&quot;x&quot;</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">Ey</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;FDE::data::&quot;</span> <span class="o">+</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span> <span class="o">+</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">Ez</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;FDE::data::&quot;</span> <span class="o">+</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="n">Field</span> <span class="o">+</span> <span class="s2">&quot;z&quot;</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;FDE::data::&quot;</span> <span class="o">+</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="s2">&quot;FDE::data::&quot;</span> <span class="o">+</span> <span class="n">MonitorName</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span>

        <span class="n">slice_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ex</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Ey</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Ez</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Rotate the image by 90 degrees counterclockwise</span>
        <span class="n">slice_2d_rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">slice_2d</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Create the colormap plot</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="c1"># plt.pcolormesh(z_range, y_range, slice_2d, cmap=&#39;viridis&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">slice_2d_rotated</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$|&#39;</span> <span class="o">+</span> <span class="n">Field</span> <span class="o">+</span> <span class="s1">&#39;|^2$&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="s2">&quot;Save Image&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="c1"># Save the plot as SVG</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Save Image&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.svg&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Save Image&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span></div>
</div>






<div class="viewcode-block" id="Charge">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge">[docs]</a>
<span class="k">class</span> <span class="nc">Charge</span><span class="p">(</span><span class="n">Constructor</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">MaterialLib</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file : str</span>
<span class="sd">            Path to lumerical lumapi.py.</span>
<span class="sd">        Mode : str</span>
<span class="sd">            Can only be set to CHARGE. Later on it will be integrated to the rest of the solvers</span>
<span class="sd">        MaterialLib : str, optional</span>
<span class="sd">            If there is an material library providet it can be imported with passig MateriaLib to the path of where the Material lib is save in the system . The default is None.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            DESCRIPTION.</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">Mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="o">=</span> <span class="n">MaterialLib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Materials_Opt</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Materials_Electric</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check Python Version !!! No import imp module after python 3.11</span>
        <span class="n">PyVersion</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">PyVersion</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s2">&quot;3.11.0&quot;</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">importlib.util</span>
                <span class="kn">import</span> <span class="nn">importlib.machinery</span>

                <span class="k">def</span> <span class="nf">load_source</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                    <span class="n">loader</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">machinery</span><span class="o">.</span><span class="n">SourceFileLoader</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="n">loader</span><span class="p">)</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
                    <span class="c1"># The module is always executed and not cached in sys.modules.</span>
                    <span class="c1"># Uncomment the following line to cache the module.</span>
                    <span class="c1"># sys.modules[module.__name__] = module</span>
                    <span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">module</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span> <span class="o">=</span> <span class="n">load_source</span><span class="p">(</span><span class="s1">&#39;lumapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">imp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s1">&#39;lumapi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ValueError encountered: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ImportError encountered: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">Mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Struct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mode</span> <span class="o">==</span> <span class="s2">&quot;CHARGE&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CHARGE</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SolverInfo</span><span class="p">[</span><span class="s2">&quot;Solver Used&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CHARGE&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">importmaterialdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaterialLib</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Non Valid Solver was choosen. Please pass on one of the two supported solvers [&#39;FDTD&#39; or &#39;EME&#39;]&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Charge.CHARGE">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.CHARGE">[docs]</a>
    <span class="k">def</span> <span class="nf">CHARGE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Calls the CHARGE Solver.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumpai</span><span class="o">.</span><span class="n">DEVICE</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical CHARGE API is started&#39;</span><span class="p">)</span></div>


    <span class="c1"># Close Programm</span>
<div class="viewcode-block" id="Charge.Close">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.Close">[docs]</a>
    <span class="k">def</span> <span class="nf">Close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Close Lumerical GUI</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lumerical API is closed&#39;</span><span class="p">)</span></div>


    <span class="c1"># Remove the object and solver region</span>
<div class="viewcode-block" id="Charge.removeObject">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.removeObject">[docs]</a>
    <span class="k">def</span> <span class="nf">removeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Switch from simulation to layout mode.</span>
<span class="sd">        Remove all objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">deleteall</span><span class="p">()</span>

        <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span></div>




<div class="viewcode-block" id="Charge.Material">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.Material">[docs]</a>
    <span class="k">def</span> <span class="nf">Material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Material_Data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Material_Data : dictionary</span>
<span class="sd">            Material Optical or Electrical data.</span>
<span class="sd">            Separate Materials into Electrical and Optical in List Material_Data[&quot;Electrical&quot;] = [&quot;mat1&quot;, &quot;mat2&quot;..]</span>
<span class="sd">            and optical Material_Data[&quot;Optical&quot;] = [&quot;omat1&quot;, &quot;omat2&quot;, ...]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Materials_Added : list</span>
<span class="sd">            List of added materials to the simulation.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        
        <span class="c1"># Separate Materials into Electrical and Optical in List Material_Data[&quot;Electrical&quot;] = [&quot;mat1&quot;, &quot;mat2&quot;..]</span>
        <span class="c1"># and optical Material_Data[&quot;Optical&quot;] = [&quot;omat1&quot;, &quot;omat2&quot;, ...]</span>
        <span class="n">Electrical_Materials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Optical_Materials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Materials_Added</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Material_Data</span><span class="p">[</span><span class="s2">&quot;Electrical&quot;</span><span class="p">]:</span>
            <span class="n">Electrical_Materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">Material_Data</span><span class="p">[</span><span class="s2">&quot;Optical&quot;</span><span class="p">]:</span>
            <span class="n">Optical_Materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

        <span class="c1"># Check for Items that are common for the optical and electrical Material</span>
        <span class="n">Common_Materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Electrical_Materials</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Optical_Materials</span><span class="p">]</span>
        <span class="n">Electrical_Materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Electrical_Materials</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Common_Materials</span><span class="p">]</span>
        <span class="n">Optical_Materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Optical_Materials</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Common_Materials</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">Common_Materials</span><span class="p">:</span>
            <span class="c1"># Add all Electrical Materials to materials folder</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Common_Materials</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodelmaterial</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from electrical material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;HT&quot;</span><span class="p">,</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from thermal material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;EM&quot;</span><span class="p">,</span> <span class="n">Common_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># Add all Electrical Materials to materials folder</span>
            <span class="n">Materials_Added</span> <span class="o">=</span> <span class="n">Materials_Added</span> <span class="o">+</span> <span class="n">Common_Materials</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Electrical_Materials</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodelmaterial</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span>
                                                <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from electrical material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;HT&quot;</span><span class="p">,</span>
                                                <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from thermal material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">Optical_Materials</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">_</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">Optical_Materials</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;EM&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>
            <span class="n">Materials_Added</span> <span class="o">=</span> <span class="n">Materials_Added</span> <span class="o">+</span> <span class="n">Electrical_Materials</span>
            <span class="c1"># Add all Optical Materials to materials folder</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Optical_Materials</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::LiNbO3 semiconductor - X/Y cut (Lithium Niobate)&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemmaterialproperty</span><span class="p">(</span><span class="s2">&quot;Dielectric&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;refractive index&quot;</span><span class="p">,</span><span class="mf">2.21</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodelmaterial</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;EM&quot;</span><span class="p">,</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">Materials_Added</span> <span class="o">=</span> <span class="n">Materials_Added</span> <span class="o">+</span> <span class="n">Optical_Materials</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Add all Electrical Materials to materials folder</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Electrical_Materials</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodelmaterial</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span>
                                                <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from electrical material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;HT&quot;</span><span class="p">,</span>
                                                <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># importing from thermal material database</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::&quot;</span> <span class="o">+</span> <span class="n">Electrical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="c1"># for _ in Optical_Materials:</span>
                <span class="c1">#     if Electrical_Materials[i].split(&quot; &quot;)[0] == _.split(&quot; &quot;)[0]:</span>
                <span class="c1">#         Optical_Materials.remove(_)</span>
                <span class="c1">#         self.lum.select(&quot;materials::&quot; + Electrical_Materials[i])</span>
                <span class="c1">#         self.lum.addmaterialproperties(&quot;EM&quot;, _)</span>
                <span class="c1">#     else:</span>
                <span class="c1">#         pass</span>
            <span class="n">Materials_Added</span> <span class="o">=</span> <span class="n">Materials_Added</span> <span class="o">+</span> <span class="n">Electrical_Materials</span>
            <span class="c1"># Add all Optical Materials to materials folder</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Optical_Materials</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::LiNbO3 semiconductor - X/Y cut (Lithium Niobate)&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemmaterialproperty</span><span class="p">(</span><span class="s2">&quot;Dielectric&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;refractive index&quot;</span><span class="p">,</span><span class="mf">2.21</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmodelmaterial</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;EM&quot;</span><span class="p">,</span> <span class="n">Optical_Materials</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">Materials_Added</span> <span class="o">=</span> <span class="n">Materials_Added</span> <span class="o">+</span> <span class="n">Optical_Materials</span>
        <span class="k">return</span> <span class="n">Materials_Added</span></div>


        
<div class="viewcode-block" id="Charge.MZM">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.MZM">[docs]</a>
    <span class="k">def</span> <span class="nf">MZM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Parameters : dictionary</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM creation</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate Height</span>
<span class="sd">            Parameters[&quot;Optical&quot;] : dictionary of str</span>
<span class="sd">                Optical Materials Dataset</span>
<span class="sd">            Parameters[&quot;Electrical&quot;] : dictionary of str</span>
<span class="sd">                Electrical Materials Dataset</span>
<span class="sd">            Parameters[&#39;angle&#39;] : int/float</span>
<span class="sd">                Side angle of the Waveguife</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="sd">                Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide Height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="sd">            Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="sd">                Waveguide lenght. This determin the structure length as well</span>
<span class="sd">            Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="sd">                Ground Electrode width</span>
<span class="sd">            Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="sd">                Signal electrode Width</span>
<span class="sd">            Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="sd">                Height of the Metal electrodes</span>
<span class="sd">            Parameters[&quot;Gap&quot;] : int/float</span>
<span class="sd">                Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes.</span>
<span class="sd"> </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        None.</span>
<span class="sd"> </span>


<span class="sd"> </span>

<span class="sd">        &#39;&#39;&#39;</span>
 
        <span class="c1"># Define Materials</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Optical_Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Optical&quot;</span><span class="p">]</span>
        <span class="n">Electrical_Material</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Electrical&quot;</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;angle&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">WG_Length</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Length&#39;</span><span class="p">]</span>
        <span class="n">Metal_GND_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GND Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Sig_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Signal Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Electrodes Height&quot;</span><span class="p">]</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Gap&quot;</span><span class="p">]</span>
 

       
        <span class="c1"># Becouse of Material Properties x and y directions will be swaped !!!</span>
        <span class="c1"># Add materials to Simulation enviroment</span>
        <span class="n">Materials_Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Materials_Dict</span><span class="p">[</span><span class="s2">&quot;Electrical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Electrical_Material</span>
        <span class="n">Materials_Dict</span><span class="p">[</span><span class="s2">&quot;Optical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Optical_Material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">Materials_Dict</span><span class="p">)</span>
 

       
        <span class="c1"># Add LiNBo3 and Vacuum optical properties to materia</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::LiNbO3 semiconductor - X/Y cut (Lithium Niobate)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addemmaterialproperty</span><span class="p">(</span><span class="s2">&quot;Dielectric&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;LiNBo3 Optical&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;refractive index&quot;</span><span class="p">,</span><span class="mf">2.21</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::LiNbO3 semiconductor - X/Y cut (Lithium Niobate)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::Au (Gold) - CRC&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::SiO2 (Glass) - Sze&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.537</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.812</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.941</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;materials::Air&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmaterialproperties</span><span class="p">(</span><span class="s2">&quot;EM&quot;</span><span class="p">,</span> <span class="s2">&quot;Vacuum&quot;</span><span class="p">)</span>


        <span class="c1"># Material definition</span>
        <span class="k">if</span> <span class="s2">&quot;Air&quot;</span> <span class="ow">in</span> <span class="n">Electrical_Material</span><span class="p">:</span>
            <span class="n">Electrical_Material</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Air&quot;</span><span class="p">)</span>
            <span class="n">MaterialElectrodes</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialElectrodes</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="k">if</span> <span class="s2">&quot;Si (Silicon)&quot;</span> <span class="ow">in</span> <span class="n">Electrical_Material</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MaterialSub</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">MaterialClad</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">MaterialSlab</span> <span class="o">=</span> <span class="n">Electrical_Material</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">MaterialWG</span> <span class="o">=</span> <span class="n">MaterialSlab</span>
 


        <span class="c1"># Device Lenght</span>
        <span class="n">MZM_Leght</span> <span class="o">=</span> <span class="n">WG_Length</span>
        <span class="n">MZM_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Metal_Sig_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">2e-6</span>


        <span class="c1"># Triangle EQ for MMI Width</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">WG_Height</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)))</span>  <span class="c1"># in Radians</span>
        <span class="n">extention</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">WG_Height</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">WG_W</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">extention</span>
        <span class="n">WG_Width_top</span> <span class="o">=</span> <span class="n">WG_W</span>

        <span class="c1"># Set offsets for the Optcal Waveguides</span>
        <span class="n">WG_Y_Pos</span> <span class="o">=</span> <span class="n">Metal_Sig_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">Metal_Y_Pos</span> <span class="o">=</span> <span class="n">WG_Y_Pos</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># Metal_GND_Width + Gap*2 + WG_Width</span>
 

        <span class="c1"># creating the LN Handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;LN_Handle&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, MZM_Width + 8e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Metal_Y_Pos</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Substrate_Height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">9</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="mf">9e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">MZM_Leght</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSlab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;preserve surfaces&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># creating the substrate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, MZM_Width + 8e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Metal_Y_Pos</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">MZM_Leght</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialSub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;preserve surfaces&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;color&quot;,[1; 1; 0; 0])</span>
 


        <span class="c1"># Position Thin Film and Waveguides</span>
        <span class="k">if</span> <span class="n">Slab_Height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">Substrate_Height</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">Point4</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="p">,</span> <span class="n">z_Offset</span><span class="p">]</span>
            <span class="n">Point3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">extention</span> <span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">]</span>
            <span class="n">Point2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">extention</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">]</span>
            <span class="n">Point1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">extention</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="p">,</span> <span class="n">z_Offset</span><span class="p">]</span>
            <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Point1</span><span class="p">,</span> <span class="n">Point2</span><span class="p">,</span> <span class="n">Point3</span><span class="p">,</span> <span class="n">Point4</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># creating the thin film</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Substrate&quot;</span><span class="p">)</span>
            <span class="n">zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">)</span>
            <span class="n">z_Offset</span> <span class="o">=</span> <span class="n">zmax</span> <span class="o">+</span> <span class="n">Slab_Height</span>
            <span class="n">Point4</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="p">,</span> <span class="n">z_Offset</span> <span class="p">]</span>
            <span class="n">Point3</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">extention</span> <span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">]</span>
            <span class="n">Point2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="n">extention</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">WG_Height</span><span class="p">]</span>
            <span class="n">Point1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">extention</span> <span class="o">+</span> <span class="n">WG_Width</span> <span class="p">,</span> <span class="n">z_Offset</span><span class="p">]</span>
            <span class="n">Point5</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span> <span class="p">,</span> <span class="n">z_Offset</span><span class="p">]</span>
            <span class="n">Point6</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">Metal_Sig_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span> <span class="p">,</span> <span class="n">zmax</span><span class="p">]</span>
            <span class="n">Point7</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Y_Pos</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-6</span> <span class="p">,</span> <span class="n">zmax</span><span class="p">]</span>
            <span class="n">Point8</span> <span class="o">=</span> <span class="p">[</span><span class="n">Metal_Y_Pos</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-6</span> <span class="p">,</span> <span class="n">z_Offset</span><span class="p">]</span>
            <span class="n">vtx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">Point1</span><span class="p">,</span> <span class="n">Point2</span><span class="p">,</span> <span class="n">Point3</span><span class="p">,</span> <span class="n">Point4</span><span class="p">,</span> <span class="n">Point5</span><span class="p">,</span> <span class="n">Point6</span><span class="p">,</span> <span class="n">Point7</span><span class="p">,</span> <span class="n">Point8</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;vertices&#39;</span><span class="p">,</span> <span class="n">vtx</span><span class="p">)</span>

        <span class="c1"># Cfreate Polynome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpoly</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Waveguide_Right&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z span&quot;</span><span class="p">,</span> <span class="n">WG_Length</span><span class="p">)</span> <span class="c1"># Z is length of the Waveguide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialWG</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;preserve surfaces&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;first axis&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;rotation 1&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;vertices&quot;</span><span class="p">,</span><span class="n">vtx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Waveguide x Position </span>
 

        <span class="c1"># Add Electrodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Sig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Metal_Sig_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">MZM_Leght</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">Metal_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialElectrodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;preserve surfaces&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addrect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Ground_R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">Metal_Y_Pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x span&quot;</span><span class="p">,</span> <span class="n">Metal_GND_Width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y span&quot;</span><span class="p">,</span> <span class="n">MZM_Leght</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="n">z_Offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">z_Offset</span> <span class="o">+</span> <span class="n">Metal_Height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="n">MaterialElectrodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;preserve surfaces&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span></div>

        


<div class="viewcode-block" id="Charge.Set_SimulationRegion">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.Set_SimulationRegion">[docs]</a>
    <span class="k">def</span> <span class="nf">Set_SimulationRegion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : Dictionary of Parameters</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM simulation region. The Simulation region is define</span>
<span class="sd">            only on the halft of the structure sice the MZM is symetrical component.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate Heigh</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="sd">                Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="sd">            Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="sd">                Ground Electrode width</span>
<span class="sd">            Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="sd">                Signal electrode Width</span>
<span class="sd">            Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="sd">                Height of the Metal electrodes</span>
<span class="sd">            Parameters[&quot;Gap&quot;] : int/float</span>
<span class="sd">                Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Define Parameters</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Metal_GND_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GND Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Sig_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Signal Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Electrodes Height&quot;</span><span class="p">]</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Gap&quot;</span><span class="p">]</span>

        <span class="n">Metal_Y_Pos</span> <span class="o">=</span> <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span>
        <span class="n">MZM_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Metal_Sig_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">4</span>
        
        
        
        <span class="c1"># self.lum.select(&quot;geometry::Sig&quot;)</span>
        <span class="c1"># x_min = self.lum.get(&quot;x min&quot;) </span>
        <span class="c1"># self.lum.select(&quot;geometry::Ground_R&quot;)</span>
        <span class="c1"># x_max = self.lum.get(&quot;x max&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;geometry::Sig&quot;</span><span class="p">)</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2e-6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;geometry::Ground_R&quot;</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2e-6</span>       
        
        <span class="c1"># self.lum.select(&quot;geometry::Waveguide_Right&quot;)</span>
        <span class="c1"># x = self.lum.get(&quot;x&quot;) </span>
        <span class="c1"># self.lum.select(&quot;geometry::Ground_R&quot;)</span>
        <span class="c1"># x_span = self.lum.get(&quot;x span&quot;) </span>
        
        
        <span class="c1"># self.lum.select(&quot;geometry::Slab&quot;)</span>
        <span class="c1"># z_min = self.lum.get(&quot;z max&quot;)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;simulation region&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;dimension&quot;</span><span class="p">,</span> <span class="s2">&quot;2D Y-Normal&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.addmodelmaterial()</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;Air&quot;)</span>
        <span class="c1"># self.lum.addmaterialproperties(&quot;CT&quot;, &quot;Air&quot;)  # importing from electrical material database</span>
        <span class="c1"># self.lum.addmaterialproperties(&quot;HT&quot;, &quot;Air&quot;)  # importing from thermal material database)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;background material&quot;</span><span class="p">,</span> <span class="s2">&quot;Air&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;x&quot;, x)</span>
        <span class="c1"># self.lum.set(&quot;x span&quot;, x_span/2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="n">x_min</span> <span class="o">-</span> <span class="mf">0.5e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="mf">0.5e-6</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;y&quot;,0)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, MZM_Width + 1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Metal_Height</span><span class="p">)</span></div>

        <span class="c1"># self.lum.set(&quot;z&quot;, z_min + WG_Height/2)</span>
        <span class="c1"># self.lum.set(&quot;z span&quot;, 2 * Metal_Height)</span>
        



<div class="viewcode-block" id="Charge.MZM_ChargeSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.MZM_ChargeSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">MZM_ChargeSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will create the CHARGE solver putting all the needed parameters and setting the simulation</span>
<span class="sd">        region monitor. </span>


<span class="sd">        Args: Parameters: dict</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM FEEM Solver region. The Simulation region is define</span>
<span class="sd">            only on the halft of the structure since the FEEM region is the simulation region too.</span>

<span class="sd">            Parameters[&#39;Substrate Height&#39;]: int/float</span>
<span class="sd">                Height of the Substrate</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;]: int/float</span>
<span class="sd">                Slab Height</span>
<span class="sd">            Parameters[&#39;WG Height&#39;]: int/float</span>
<span class="sd">                Waveguide hight. You need to give this value but for the moment it will not effect anything</span>
<span class="sd">            Parameters[&#39;WG Width&#39;]: int/float</span>
<span class="sd">                Width of the Waveguide</span>
<span class="sd">            Parameters[&quot;GND Electrodes Width&quot;]: int/float</span>
<span class="sd">                Ground Electrode width</span>
<span class="sd">            Parameters[&quot;Signal Electrodes Width&quot;]: int/float</span>
<span class="sd">                Signal Electrode width </span>
<span class="sd">            Parameters[&quot;Electrodes Height&quot;]: int/float</span>
<span class="sd">                Height of the Ground and Singla electrodes</span>
<span class="sd">            Parameters[&quot;Gap&quot;]: int/float</span>
<span class="sd">                Gap between the electrode and Waveguide.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Parameters</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Metal_GND_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GND Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Sig_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Signal Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Electrodes Height&quot;</span><span class="p">]</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Gap&quot;</span><span class="p">]</span>

        <span class="n">MZM_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Metal_Sig_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">Metal_Y_Pos</span> <span class="o">=</span> <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">WG_Width</span>

        <span class="c1"># Set simulation region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Set_SimulationRegion</span><span class="p">(</span><span class="n">Parameters</span><span class="p">)</span>

        <span class="c1"># Set charge Solver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addchargesolver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;min edge length&quot;</span><span class="p">,</span> <span class="mf">0.04e-6</span><span class="p">)</span>  <span class="c1"># TODO</span>
        <span class="c1"># TODO Results Tab syntax</span>

        <span class="c1"># Set boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;CHARGE::boundary conditions&quot;</span><span class="p">)</span>
        <span class="c1"># self.lum.addelectricalcontact()</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;Ground_L&quot;)</span>
        <span class="c1"># self.lum.set(&quot;surface type&quot;, &quot;domain&quot;)</span>
        <span class="c1"># self.lum.set(&quot;domain&quot;, 1)</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;Ground_L&quot;)</span>
        <span class="c1"># self.lum.set(&quot;sweep type&quot;, &quot;single&quot;)</span>
        <span class="c1"># self.lum.set(&quot;voltage&quot;, 0)</span>
        <span class="c1"># self.lum.set(&quot;surface type&quot;, &quot;solid&quot;)</span>
        <span class="c1"># self.lum.set(&quot;solid&quot;, &quot;Ground_R&quot;)</span>
        <span class="c1"># self.lum.set(&quot;outer surface only&quot;, 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addelectricalcontact</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Signal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sweep type&quot;</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;range start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;range stop&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;range interval&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;range num points&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;surface type&quot;</span><span class="p">,</span> <span class="s2">&quot;solid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Sig&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer surface only&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addelectricalcontact</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Ground_R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sweep type&quot;</span><span class="p">,</span> <span class="s2">&quot;single&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;voltage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;surface type&quot;</span><span class="p">,</span> <span class="s2">&quot;solid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Ground_R&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;outer surface only&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addefieldmonitor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;CHARGE_Field_Monitor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;monitor type&quot;</span><span class="p">,</span> <span class="s2">&quot;2D y-normal&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># self.lum.set(&quot;y&quot;,0)</span>
        <span class="c1"># self.lum.set(&quot;y span&quot;, MZM_Width + 1e-6)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">Metal_Sig_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="n">Metal_Y_Pos</span> <span class="o">+</span> <span class="n">Metal_GND_Width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">Substrate_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="n">Substrate_Height</span> <span class="o">+</span> <span class="n">Slab_Height</span> <span class="o">+</span> <span class="n">Metal_Height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Add fine mesh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addmesh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;CHARGE_Volume_Mesh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;geometry type&quot;</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume type&quot;</span><span class="p">,</span> <span class="s2">&quot;solid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Waveguide_Right&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;max edge length&quot;</span><span class="p">,</span> <span class="mf">0.01e-6</span><span class="p">)</span>  <span class="c1"># TODO need to be checked and made variable</span></div>




<div class="viewcode-block" id="Charge.MZM_FEEMSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.MZM_FEEMSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">MZM_FEEMSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM FEEM Solver region. The Simulation region is define</span>
<span class="sd">            only on the halft of the structure since the FEEM region is the simulation region too.</span>
<span class="sd">            Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="sd">                Substrate Heigh</span>
<span class="sd">            Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="sd">                Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="sd">            Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="sd">                Waveguide Height</span>
<span class="sd">            Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="sd">                Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="sd">            Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="sd">                Ground Electrode width</span>
<span class="sd">            Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="sd">                Signal electrode Width</span>
<span class="sd">            Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="sd">                Height of the Metal electrodes</span>
<span class="sd">            Parameters[&quot;Gap&quot;] : int/float</span>
<span class="sd">                Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes.</span>
<span class="sd">            Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="sd">                Simulation wavelength</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Parameters</span>
        <span class="n">Substrate_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Substrate Height&#39;</span><span class="p">]</span>
        <span class="n">Slab_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;Slab Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Height&#39;</span><span class="p">]</span>
        <span class="n">WG_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s1">&#39;WG Width&#39;</span><span class="p">]</span>
        <span class="n">Metal_GND_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;GND Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Sig_Width</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Signal Electrodes Width&quot;</span><span class="p">]</span>
        <span class="n">Metal_Height</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Electrodes Height&quot;</span><span class="p">]</span>
        <span class="n">Gap</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Gap&quot;</span><span class="p">]</span>
        <span class="n">Wavelength</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">[</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">]</span>

        <span class="n">MZM_Width</span> <span class="o">=</span> <span class="n">WG_Width</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Metal_GND_Width</span> <span class="o">+</span> <span class="n">Metal_Sig_Width</span> <span class="o">+</span> <span class="n">Gap</span> <span class="o">*</span> <span class="mi">4</span>

        <span class="c1"># Set Solver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addfeemsolver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;edges per wavelength&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># TODO Check for Converchange need to be separate parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;polynomial order&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># TODO Check what is this parameter for</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;display frequency or wavelength&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;wavelength&quot;</span><span class="p">,</span> <span class="n">Wavelength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;use max index&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="mf">2.02</span><span class="p">)</span>  <span class="c1"># TODO Check for what exactly supposable under limit of n_eff</span>

        <span class="c1"># Set Boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpec</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;surface type&quot;</span><span class="p">,</span> <span class="s2">&quot;simulation region&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y min&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;y max&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addpml</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># TODO Check for what exactly</span>

        <span class="c1"># Set monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">addimportnk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;nk import&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume type&quot;</span><span class="p">,</span> <span class="s2">&quot;solid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Waveguide_Right&quot;</span><span class="p">)</span></div>


        <span class="c1"># self.lum.addimportnk()</span>
        <span class="c1"># self.lum.set(&quot;name&quot;, &quot;nk import Slab&quot;)</span>
        <span class="c1"># self.lum.set(&quot;volume type&quot;, &quot;solid&quot;)</span>
        <span class="c1"># self.lum.set(&quot;volume solid&quot;, &quot;Slab&quot;)</span>



<div class="viewcode-block" id="Charge.StartCHARGESolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.StartCHARGESolver">[docs]</a>
    <span class="k">def</span> <span class="nf">StartCHARGESolver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will first save the simulation into the folder where the</span>
<span class="sd">        this script is saved. After saving the script an Mesh of the structure will </span>
<span class="sd">        be performed and the mesh will be locked for further simulation. After this </span>
<span class="sd">        the CHARGE solver will be started.</span>



<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>


<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Save file </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;SimRun1&#39;</span><span class="p">)</span>
        <span class="c1"># Set mesh lock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;CHARGE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="s2">&quot;CHARGE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh lock&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Run CHARGE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;CHARGE&quot;</span><span class="p">)</span></div>





<div class="viewcode-block" id="Charge.StartFEEMSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.StartFEEMSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">StartFEEMSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function will first save the simulation into the folder where the</span>
<span class="sd">        this script is saved. After saving the script an Mesh of the structure will </span>
<span class="sd">        be performed and the mesh will be locked for further simulation. After this </span>
<span class="sd">        the FEEM solver will be started.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1">#Svae file </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;SimRun1&quot;</span><span class="p">)</span>
        
        <span class="c1"># Set mesh lock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh lock&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Run FEEM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Charge.ResultsCHARGE">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.ResultsCHARGE">[docs]</a>
    <span class="k">def</span> <span class="nf">ResultsCHARGE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Parameters_CHARGE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM CHARGE Results analysis. This function will plot</span>
<span class="sd">            the changes in the n_EO so that the user can see it. </span>

<span class="sd">            Parameters_CHARGE[&#39;min Polarization Fraction&#39;]: int/float</span>
<span class="sd">                This is the minimal Polarisation Fraction of the mode that need to be tracked in the waveguide. </span>
<span class="sd">                The user can first performe an FDE Analysis and extract the Polarisation Fraction and then give it in </span>
<span class="sd">                this function, so that in case of multimodal waveguide the right mode will be tracked and analysed. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        electro : dict</span>
<span class="sd">         Simulation results from the monitor of CHARGE. This function will create an Lumerical window into Charge solver.</span>
<span class="sd">         The user can use the window to see tha changes in EO index depending on the voltage apply on the electrodes.</span>
<span class="sd">         The function will return the monitor Data, so that the user can use it for some post precessing.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># Lead mode neff for FEEM </span>
        <span class="n">Min_Polarization_Fraction</span> <span class="o">=</span> <span class="n">Parameters_CHARGE</span><span class="p">[</span><span class="s1">&#39;min Polarization Fraction&#39;</span><span class="p">]</span>

        <span class="c1"># Lithium Niobate telecom permitivity</span>
        <span class="n">eps_o</span> <span class="o">=</span> <span class="mf">2.21</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">eps_e</span> <span class="o">=</span> <span class="mf">2.14</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;eps_o&#39;</span><span class="p">,</span><span class="n">eps_o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;eps_e&#39;</span><span class="p">,</span><span class="n">eps_e</span><span class="p">)</span>

        <span class="c1"># Lithium Niobate non;linear coefficents</span>
        <span class="n">r_13</span> <span class="o">=</span> <span class="mf">9.6e-12</span>
        <span class="n">r_33</span> <span class="o">=</span> <span class="mf">30.9e-12</span>

        <span class="n">electro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;CHARGE::CHARGE_Field_Monitor&quot;</span><span class="p">,</span> <span class="s2">&quot;electrostatics&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;electro = getresult(&quot;CHARGE::CHARGE_Field_Monitor&quot;,&quot;electrostatics&quot;);&#39;</span><span class="p">)</span>
        
        <span class="c1"># Get electrostatic results</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">electro</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">])</span>
        <span class="n">Volt</span> <span class="o">=</span> <span class="n">electro</span><span class="p">[</span><span class="s2">&quot;V_Signal&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;Volt = electro.V_Signal;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;E = pinch(electro.E);&#39;</span><span class="p">)</span>

        <span class="c1"># Intialize perturbation matrices same size as E</span>
        <span class="n">dts</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">n_EO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
        <span class="n">dn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dts</span><span class="p">)</span>
        
        <span class="c1"># self.lum.eval(&#39;electro = getresult(&quot;CHARGE::CHARGE_Field_Monitor&quot;,&quot;electrostatics&quot;);&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;E = pinch(electro.E);&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;Volt = electro.V_Signal;&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;dts = size(E);&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;n_EO = matrix(dts(1),dts(2),dts(3));&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;dn = matrix(dts(1),dts(2),dts(3));&#39;)</span>

        
        <span class="c1"># Vector components work well with unstructured datasets, need to do this for voltage and wavelength</span>
        <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Volt</span><span class="p">)):</span>
            <span class="c1"># Spatial index data (diagonal permittivity)</span>
            <span class="n">eps_unperturbed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eps_e</span><span class="p">,</span> <span class="n">eps_o</span><span class="p">,</span> <span class="n">eps_o</span><span class="p">])[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Shape: (1, 3)</span>

            <span class="c1"># Pockels effect (perturbation term)</span>
            <span class="n">deps_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_33</span> <span class="o">*</span> <span class="n">E</span><span class="p">[:,</span> <span class="n">vv</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r_13</span> <span class="o">*</span> <span class="n">E</span><span class="p">[:,</span> <span class="n">vv</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r_13</span> <span class="o">*</span> <span class="n">E</span><span class="p">[:,</span> <span class="n">vv</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Shape: (dts[0], 3)</span>

            <span class="c1"># Compute modified index using element-wise inversion (instead of np.linalg.inv)</span>
            <span class="n">n_EO</span><span class="p">[:,</span> <span class="n">vv</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">eps_unperturbed</span> <span class="o">+</span> <span class="n">deps_inv</span><span class="p">))</span>


        
        <span class="n">n_EO</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="c1"># This one is here becouse the values ware somehow rotated from back to front</span>
        
        <span class="n">dn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">n_EO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;dn&#39;</span><span class="p">,</span><span class="n">n_EO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;n_EO&#39;</span><span class="p">,</span><span class="n">n_EO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;dn(:,:,1) = n_EO(:,:,1)  - sqrt(eps_e);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;dn(:,:,2:3) = n_EO (:,:,2:3)  - sqrt(eps_o);&#39;</span><span class="p">)</span>
        <span class="n">dn</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_EO</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eps_e</span><span class="p">)</span>
        <span class="n">dn</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_EO</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eps_o</span><span class="p">)</span>

        <span class="c1"># Add dn and n_EO to dataset and visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;electro.addattribute(&#39;n_EO&#39;,n_EO);&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;electro.addattribute(&#39;dn&#39;,dn);&quot;</span><span class="p">)</span>
        <span class="n">electro</span><span class="p">[</span><span class="s1">&#39;n_EO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_EO</span>  <span class="c1">## total index</span>
        <span class="n">electro</span><span class="p">[</span><span class="s1">&#39;dn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dn</span>  <span class="c1">## total index</span>
        <span class="n">electro</span><span class="p">[</span><span class="s1">&#39;Min Polarization Fraction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Min_Polarization_Fraction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">electro</span><span class="p">)</span>
        

        <span class="k">return</span> <span class="n">electro</span></div>

    



<div class="viewcode-block" id="Charge.ResultsFEEM">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Charge.ResultsFEEM">[docs]</a>
    <span class="k">def</span> <span class="nf">ResultsFEEM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CHARGE_Data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will performe an FEEM sweep simulation to extract the neff changes </span>
<span class="sd">        from the waveguide. The changing neff is due to the changing voltage and electric </span>
<span class="sd">        field power over the waveguide. </span>


<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Parameters : dict</span>
<span class="sd">            Dictionary with all the parameters needt for the MZM FEEM Results analysis. This function will plot</span>
<span class="sd">            the L_pi vs Volt, L_pi*Volt vs Volt, and delta_neff vs Volt</span>

<span class="sd">            CHARGE_Data is an dictionary that can be taken directly from the function ResultsCHARGE()</span>
<span class="sd">                and give to this function. All the needed Parameters for the FEEM solver are there. </span>

<span class="sd">            If the user wanna give the Parameters manuel you can:</span>
<span class="sd">                CHARGE_Data[&quot;V_Signal&quot;]: int/float array</span>
<span class="sd">                    Array of the sweep voltage from the CHARGE Solver</span>
<span class="sd">                CHARGE_Data[&#39;min Polarization Fraction&#39;]: int/float</span>
<span class="sd">                    This is the minimal Polarisation Fraction of the mode that need to be tracked in the waveguide. </span>
<span class="sd">                    The user can first performe an FDE Analysis and extract the Polarisation Fraction and then give it in </span>
<span class="sd">                    this function, so that in case of multimodal waveguide the right mode will be tracked and analysed. </span>

<span class="sd">        Returns:</span>
<span class="sd">            FeemResults: dictionary with all the results from the FEEM solver to plot them or use them in other function</span>
<span class="sd">            FeemResults[&quot;lambda&quot;]: int/float</span>
<span class="sd">                Operation Wavelength</span>
<span class="sd">            FeemResults[&quot;Volt&quot;]: int/float</span>
<span class="sd">                Array of voltages used in CHARGE solver and FEEM for the analysis </span>
<span class="sd">             FeemResults[&quot;L_pi&quot;]: int/float</span>
<span class="sd">                Array with L_pi values</span>
<span class="sd">            FeemResults[&quot;neff_TE&quot;]: int/float</span>
<span class="sd">                Array with neff TE Mode values from the FEEM solver</span>
<span class="sd">            FeemResults[&quot;neff&quot;]: int/float</span>
<span class="sd">                Array with neff values from the FEEM solver</span>
<span class="sd">            FeemResults[&quot;dneff&quot;]: int/float</span>
<span class="sd">                Array of delta_neff Values for the L_Pi Calculation: L_pi = lambda/ (2*RE{neff[No Voltage over Electrodes]] - neff[Voltage over Electrodes]})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Switch to layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
        
        

        <span class="c1"># Get wavelength</span>
        <span class="n">lambda_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getnamed</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">,</span> <span class="s2">&quot;wavelength&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;tmp = electro.elements;&quot;</span><span class="p">)</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getv</span><span class="p">(</span><span class="s2">&quot;tmp&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s2">&quot;lambda&quot;</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s2">&quot;Volt&quot;</span><span class="p">,</span> <span class="n">CHARGE_Data</span><span class="p">[</span><span class="s2">&quot;V_Signal&quot;</span><span class="p">])</span>
        <span class="n">Volt</span> <span class="o">=</span>  <span class="n">CHARGE_Data</span><span class="p">[</span><span class="s2">&quot;V_Signal&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;neff_TE = matrix(length(Volt));&quot;</span><span class="p">)</span>
        <span class="n">neff_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Volt</span><span class="p">))</span>
        <span class="n">Min_Polarization_Fraction</span> <span class="o">=</span> <span class="n">CHARGE_Data</span><span class="p">[</span><span class="s1">&#39;Min Polarization Fraction&#39;</span><span class="p">]</span>

        <span class="c1"># # Create dataset</span>
        <span class="c1"># nkmaterial = self.lum.unstructureddataset(&quot;nk import WG&quot;, </span>
        <span class="c1">#                                     CHARGE_Data[&quot;x&quot;], </span>
        <span class="c1">#                                     CHARGE_Data[&quot;y&quot;], </span>
        <span class="c1">#                                     CHARGE_Data[&quot;z&quot;], </span>
        <span class="c1">#                                     elements)</span>
        <span class="c1"># self.lum.putv(&quot;nkmaterial&quot;, nkmaterial)</span>
        <span class="c1"># self.lum.eval(&#39;nkmaterial.addparameter(&quot;lambda&quot;, lambda) ;&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;nkmaterial.addparameter(&quot;Voltage&quot;, Volt) ;&#39;)</span>
        <span class="c1"># self.lum.eval(&#39;nkmaterial.addattribute(&quot;nk&quot;,n_EO);&#39;)</span>

        <span class="c1"># # Import dataset</span>
        <span class="c1"># self.lum.setnamed(&quot;FEEM::nk import WG&quot;, &quot;enabled&quot;, True)</span>
        <span class="c1"># self.lum.select(&quot;FEEM::nk import WG&quot;)</span>
        <span class="c1"># self.lum.eval(&#39;importdataset(nkmaterial);&#39;)</span>
        
        
        
        <span class="c1">### Create new unstructured dataset based on CHARGE data grid at this wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;nkmaterial = unstructureddataset(&quot;nk import&quot;,electro.x,electro.y,electro.z,electro.elements);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;nkmaterial.addparameter(&quot;lambda&quot;, lambda);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;nkmaterial.addparameter(&quot;Voltage&quot;, Volt);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;nkmaterial.addattribute(&quot;nk&quot;,n_EO);&#39;</span><span class="p">)</span>
            
        <span class="c1">### Import, the nk dataset and apply to waveguide solid </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;setnamed(&quot;FEEM::nk import&quot;,&quot;enabled&quot;,true);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;select(&quot;FEEM::nk import&quot;);&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;importdataset(nkmaterial);&#39;</span><span class="p">)</span>
                
                
        

        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;FEEM::nk import&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume type&quot;</span><span class="p">,</span><span class="s2">&quot;solid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;volume solid&quot;</span><span class="p">,</span><span class="s2">&quot;Waveguide_Right&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;selected attribute&quot;</span><span class="p">,</span><span class="s2">&quot;nk&quot;</span><span class="p">)</span>
        
        
        <span class="c1"># Set mesh lock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;mesh lock&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


        <span class="c1"># Run FEEM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>

        

        <span class="c1">### Find Fundamental TE Mode effective index</span>
        <span class="n">TE_pol_frac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">,</span> <span class="s2">&quot;modeproperties.TE polarization fraction&quot;</span><span class="p">)[</span><span class="s2">&quot;TE polarization fraction&quot;</span><span class="p">]</span>


        <span class="c1"># Extract effective index</span>
        <span class="n">neff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">,</span> <span class="s2">&quot;modeproperties.neff&quot;</span><span class="p">)[</span><span class="s2">&quot;neff&quot;</span><span class="p">]</span>
        <span class="n">mde_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">TE_pol_frac</span> <span class="o">&gt;</span> <span class="n">Min_Polarization_Fraction</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">neff_TE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">neff</span><span class="p">[</span><span class="n">mde_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
        
        
        <span class="c1"># Rotate the n_EO vertically to have an index that make sence </span>
        <span class="n">n_EO</span> <span class="o">=</span> <span class="n">CHARGE_Data</span><span class="p">[</span><span class="s1">&#39;n_EO&#39;</span><span class="p">]</span>
        <span class="n">n_EO</span> <span class="o">=</span> <span class="n">n_EO</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">putv</span><span class="p">(</span><span class="s1">&#39;n_EO&#39;</span><span class="p">,</span><span class="n">n_EO</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;electro.addattribute(&#39;n_EO&#39;,n_EO);&quot;</span><span class="p">)</span>

        
       


        <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Volt</span><span class="p">)):</span>  <span class="c1"># Python uses 0-based indexing, so start from 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">switchtolayout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">setnamed</span><span class="p">(</span><span class="s2">&quot;FEEM::nk import&quot;</span><span class="p">,</span> <span class="s2">&quot;Voltage_index&quot;</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">)</span>

            <span class="c1"># Find Fundamental TE Mode</span>
            <span class="n">TE_pol_frac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">,</span> <span class="s2">&quot;modeproperties.TE polarization fraction&quot;</span><span class="p">)[</span><span class="s2">&quot;TE polarization fraction&quot;</span><span class="p">]</span>
            <span class="n">neff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lum</span><span class="o">.</span><span class="n">getresult</span><span class="p">(</span><span class="s2">&quot;FEEM&quot;</span><span class="p">,</span> <span class="s2">&quot;modeproperties.neff&quot;</span><span class="p">)[</span><span class="s2">&quot;neff&quot;</span><span class="p">]</span>

            <span class="c1"># Find mode indices where TE polarization fraction is greater than 0.95</span>
            <span class="n">mde_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">TE_pol_frac</span> <span class="o">&gt;</span> <span class="n">Min_Polarization_Fraction</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Extract indices where condition is met</span>

            <span class="c1"># Assign the first qualifying neff value to neff_TE[vv]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mde_num</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Ensure at least one mode satisfies the condition</span>
                <span class="n">neff_TE</span><span class="p">[</span><span class="n">vv</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">neff</span><span class="p">[</span><span class="n">mde_num</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>




        <span class="c1"># Compute dneff, L_pi, and alpha_dB</span>
        <span class="n">dneff</span> <span class="o">=</span> <span class="n">neff_TE</span> <span class="o">-</span> <span class="n">neff_TE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">L_pi</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dneff</span><span class="p">))</span>
        <span class="c1"># alpha_dB = -0.20 * np.log10(np.exp(-2 * np.pi * np.imag(neff_TE) / lambda_))</span>



        

        <span class="c1"># Plot Effective Index vs Voltage</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Volt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">neff_TE</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Voltage (V)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;neff (Fundamental TE Mode)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Effective Index vs Voltage&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Effective Index&quot;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Plot Modulator Performance - L_pi vs Voltage</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Volt</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">L_pi</span><span class="p">)</span> <span class="o">*</span>  <span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Voltage [V]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;L_pi [cm]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Modulator Performance&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


        <span class="c1"># Plot Modulator Performance - V_piL vs Voltage</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Volt</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Volt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">L_pi</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Voltage [V]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;V_piL [V-cm]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Modulator Performance&quot;</span><span class="p">)</span>
        <span class="c1">#plt.ylim(0, 4)  # Equivalent to setplot(&quot;y max&quot;,4); setplot(&quot;y min&quot;,0);</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        

        <span class="c1"># # Plot Modulator Performance - Loss vs Voltage</span>
        <span class="c1"># plt.figure()</span>
        <span class="c1"># plt.plot(Volt, alpha_dB, linewidth=3)</span>
        <span class="c1"># plt.xlabel(&quot;Voltage [V]&quot;)</span>
        <span class="c1"># plt.ylabel(&quot;Loss [dB/cm]&quot;)</span>
        <span class="c1"># plt.title(&quot;Modulator Performance&quot;)</span>
        <span class="c1"># plt.ylim(3, 7)  # Equivalent to setplot(&quot;y max&quot;,7); setplot(&quot;y min&quot;,3);</span>
        <span class="c1"># plt.show()</span>
                
                
                
        <span class="c1"># Collect results in one dictionary </span>
        <span class="n">FeemResults</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;Volt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Volt</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;L_pi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L_pi</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;neff_TE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">neff_TE</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;neff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">neff</span>
        <span class="n">FeemResults</span><span class="p">[</span><span class="s2">&quot;dneff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dneff</span>
        
  
        <span class="k">return</span> <span class="n">FeemResults</span></div>
</div>

        




        
        
        
        

<div class="viewcode-block" id="HelpSubject">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject">[docs]</a>
<span class="k">class</span> <span class="nc">HelpSubject</span><span class="p">:</span>
    
<div class="viewcode-block" id="HelpSubject.Help_Objects">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_Objects">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">Help_Objects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # ============================================================================= #</span>
<span class="s2">        #                Welcome to the Help Menu for Lumerical Structure               #     </span>
<span class="s2">        #                You can ask for help for one of the following structures       #   </span>
<span class="s2">        #                                                                               #</span>
<span class="s2">        #                1) Waveguide - used for FDE simulation only!                   #  </span>
<span class="s2">        #                2) MMI2x1 - can be used in EME and FDTD solvers                #  </span>
<span class="s2">        #                3) MMI2x2 - can be used in EME and FDTD solvers                #</span>
<span class="s2">        #                4) InverseTaper - can be used in EME and FDTD solvers          #  </span>
<span class="s2">        #                5) Directional Coupler - can be used in EME and FDTD solvers   #  </span>
<span class="s2">        #                6) StraightWaveguide - can be used in EME and FDTD solvers     #     </span>
<span class="s2">        #                7) WDM (Wavelength Division Multiplexing, angeled MMI) -onyl   #</span>
<span class="s2">        #                   available for EME Solver                                    #  </span>
<span class="s2">        #                8) BendWaveguide - onyl available for FDTD Solver              # </span>
<span class="s2">        #                9) ArcWaveguide - onyl available for FDTD Solver               #        </span>
<span class="s2">        #                10) GratingCoupler - onyl available for FDTD Solver            #         </span>
<span class="s2">        #                11) RingGratingCoupler - onyl available for FDTD Solver        # </span>
<span class="s2">        #                12) MZM - only available fro CHARGE Solver                     #        </span>
<span class="s2">        #                                                                               #  </span>
<span class="s2">        #                To print information about the structure you desire please     #  </span>
<span class="s2">        #                use obj.Help({&quot;Objects&quot;: Number}). For Example                 #  </span>
<span class="s2">        #                obj.Help({&quot;Objects&quot;: 1}) will give you information about       #  </span>
<span class="s2">        #                Structure Waveguide                                            #</span>

<span class="s2">        # ============================================================================= #</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="HelpSubject.Structures">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Structures">[docs]</a>
    <span class="k">def</span> <span class="nf">Structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Waveguide with -&gt; obj.Waveguide(Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int7float</span>
<span class="s2">                        Height of the substrate.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;]: int/float</span>
<span class="s2">                        Length of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height.</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                        </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call StraightWaveguide with -&gt; obj.StraightWaveguide(Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        If Taper == False, only Waveguiedes will be constructed.</span>
<span class="s2">                        If Taper == True, only an single Taper will be constructed</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside width, the frontside width is the waveguide width</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height.</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                        Bending angle of the Waveguide. Set it to 0 to simulate the straight waveguide.</span>
<span class="s2">                        If Waveguide Angle is different then 0, then the straight waveguide will be tilted</span>
<span class="s2">                        at the choosen degrees.</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                        and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                        will be set.</span>
<span class="s2">                    Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="s2">                        and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="s2">                        If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="s2">                        If Taper Type is selected the user need to provide additional information:</span>
<span class="s2">                            TaperWidthF = Parameters[&#39;PWB Taper Width Front&#39;]</span>
<span class="s2">                            TaperWidthB = Parameters[&#39;PWB Taper Width Back&#39;]</span>
<span class="s2">                            TaperHightB = Parameters[&#39;PWB Taper Hight Back&#39;]</span>
<span class="s2">                            TaperHightF = Parameters[&#39;PWB Taper Hight Front&#39;]</span>
<span class="s2">                            TaperLength_PWB = Parameters[&#39;PWB Taper Length&#39;]</span>
<span class="s2">                        </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call BendWaveguide with -&gt; obj.BendWaveguide(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Height of the Waveguide (Etching depth)</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Top width of the Waveguide.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. It is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For angle = 90 , a perfect rect is created!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;x span&quot;] : int/float</span>
<span class="s2">                        Length of the S Curve. Span of the object in x direction.</span>
<span class="s2">                    Parameters[&quot;y span&quot;] : int/float</span>
<span class="s2">                        Height of the curve. Span (difference between the input and output ports) of the S-curve in y direction.</span>
<span class="s2">                    Parameters[&quot;poles&quot;] : boolen</span>
<span class="s2">                        If Parameters[&quot;poles&quot;] = True an Bezier Curbe will be made.</span>
<span class="s2">                        if Parameters[&quot;poles&quot;] = False an Cosinus Curve = y_span*(cos((pi/(2*x_span))*t)^2) will be made. Where</span>
<span class="s2">                        t is in the range of 0 - y_span</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                       
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call ArcWaveguide with -&gt; obj.ArcWaveguide(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide height</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="s2">                        Radius of the Circle in um</span>
<span class="s2">                    Parameters[&#39;Arc deg&#39;] : int</span>
<span class="s2">                        Can be 90 or 180 for 1/4 of a cirle or 1/2 of a circle.</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                        and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                        will be set.</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                         
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x1 with -&gt; obj.MMI2x1(Parameters)    </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                     Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                     Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length.</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                        Offset of the input waveguide.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used</span>
<span class="s2">                        if Taper == True - Taper placed</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                        and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                        will be set.</span>
<span class="s2">                    Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="s2">                        This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="s2">                        becouse the maschine of our physic departmant had some proiblems with the LNOI objects design. </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                          
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x2 with -&gt; obj.MMI2x2(Parameters)   </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                     Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length.</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                     Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Taper can be set to be True ot False.</span>
<span class="s2">                        if Taper == False - No Taper used</span>
<span class="s2">                        if Taper == True - Taper placed</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers length. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        If Taper == True, then this will set the Tapers width. If Taper == False</span>
<span class="s2">                        this will be ignored and some random value can be given.</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                            This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                            and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                            will be set.</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                         
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call WDM with -&gt; obj.WDM(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------                      </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Angle Thetha&#39;] :</span>
<span class="s2">                        Input and output angle of the waveguide. This is only temporally</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Backside width of the Taper, frontside width is the waveguide width</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Length of the Taper.</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        If Taper == False, no Taper will be placed with the Waveguides.</span>
<span class="s2">                        If Taper == True, tapers will be placed with the waveguides</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                        and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                        will be set.</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>   
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call InverseTaper with -&gt; obj.InverseTaper(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------  </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 2 materials! </span>
<span class="s2">                        For this structure 3 materials will be needed!</span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width. Also in this function and ONLY in this function this will be the</span>
<span class="s2">                        ibverse Taper width!!!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Inverse Taper Length</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Front Width of the inverse Taper!! In this Function and ONLY in this function, the</span>
<span class="s2">                        Parameters[&#39;Taper Width&#39;] is the frond width of the inverse Taper!</span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                        Length of the Photonic Wire Bonding Taper</span>
<span class="s2">                    Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber core Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber Cladding Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Core Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Core Index</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Cladding Index                  </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>  
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call DirectionalCoupler with -&gt; obj.DirectionalCoupler(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">----------------------------------------------------------------------------------------------------------- </span>
<span class="s2">                    Parameters[&#39;Material&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 3 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Photonic Wire Bonding&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;, &#39;Si (Silicon) - Palik&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;Substrate Width&#39;] : int/float</span>
<span class="s2">                        Substrate Width.</span>
<span class="s2">                    Parameters[&#39;DC Length&#39;] : int/float</span>
<span class="s2">                        Length of the directional coupler</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. The minimum distance between Waveguides is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Cladding&quot;] : anything, optional</span>
<span class="s2">                        This function will check if you have set Parameters[&quot;Cladding&quot;] to anaything, for example &quot;Parameters[&quot;Cladding&quot;]=1&quot; </span>
<span class="s2">                        and if so it will put cladding over your structure. If the user didnt give the &quot;Cladding&quot; as dictionary key no cladding </span>
<span class="s2">                        will be set.</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call GratingCoupler with -&gt; obj.GratingCoupler(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">----------------------------------------------------------------------------------------------------------- </span>
<span class="s2">                    Parameters[&#39;Material GC&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 3 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Photonic Wire Bonding&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;, &#39;Si (Silicon) - Palik&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="s2">                        Lenght of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="s2">                        Widht of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="s2">                        Hight of the Grating Coupler Material</span>
<span class="s2">                    Parameters[&quot;Etch Depth GC&quot;]: int/float</span>
<span class="s2">                        How deep, taken from the Parameters[&quot;Hight GC&quot;] will be the etchin depth of the gratings</span>
<span class="s2">                    Parameters[&quot;Duty Cycle&quot;]: int/float</span>
<span class="s2">                        Duty cycle of the gratings. For example Parameters[&quot;Duty Cycle&quot;] = 0.39 will result in 39% Duty Cycle </span>
<span class="s2">                    Parameters[&quot;Pitch GC&quot;]: int/float</span>
<span class="s2">                        Pitch of the Grating Coupler. For Example Parameters[&quot;Pitch GC&quot;] = 0.6e-6 will result in 6um Etch Space + Rib Space = 0.6um.</span>
<span class="s2">                    Parameters[&quot;Input LengthGC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="s2">                    Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect! In this case is used only when Parameters[&quot;Taper&quot;] = True</span>
<span class="s2">                    Parameters[&quot;Taper&quot;] : boolen</span>
<span class="s2">                        You can create an input Taper to your Grating Coupler structure</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width. Also in this function and ONLY in this function this will be the</span>
<span class="s2">                        ibverse Taper width!!!</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber core Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber Cladding Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Core Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Core Index</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Cladding Index</span>
<span class="s2">                    Parameters[&quot;SMF Theta&quot;]: int/float</span>
<span class="s2">                        Tilting Angle of the Single Mode Fiber to the Grating Coupler. Normaly we choose Parameters[&quot;SMF Theta&quot;] = 15</span>
<span class="s2">                    Parameters[&quot;SMF Z Span&quot;]: int/float</span>
<span class="s2">                        Lenght/Span of the Single Mode Fiber</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>  
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call RingGratingCoupler with -&gt; obj.RingGratingCoupler(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">----------------------------------------------------------------------------------------------------------- </span>
<span class="s2">                    Parameters[&#39;Material GC&#39;] : list of str</span>
<span class="s2">                        List of Materials. The list should be with names (str) of a valid Lumerical materials.</span>
<span class="s2">                        Check the names in Lumerical Materials viewer.</span>
<span class="s2">                        The List of materials must contain at least 3 materials! </span>
<span class="s2">                        Parameters[&#39;Material&#39;] = [&#39;Cladding/Substrat&#39;, &#39;Object Material&#39;, &#39;Photonic Wire Bonding&#39;].</span>
<span class="s2">                        For Example: Parameters[&#39;Material&#39;] = [&quot;SiO2 (Glass) - Palik&quot;, &#39;LiNbO3_20deg_X cut&#39;, &#39;Si (Silicon) - Palik&#39;].</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="s2">                        Lenght of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="s2">                        Widht of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="s2">                        Hight of the Grating Coupler Material</span>
<span class="s2">                    Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="s2">                        Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="s2">                    Parameters[&quot;Etch Depth GC&quot;]: int/float</span>
<span class="s2">                        How deep, taken from the Parameters[&quot;Hight GC&quot;] will be the etchin depth of the gratings</span>
<span class="s2">                    Parameters[&quot;Duty Cycle&quot;]: int/float</span>
<span class="s2">                        Duty cycle of the gratings. For example Parameters[&quot;Duty Cycle&quot;] = 0.39 will result in 39% Duty Cycle </span>
<span class="s2">                    Parameters[&quot;Pitch GC&quot;]: int/float</span>
<span class="s2">                        Pitch of the Grating Coupler. For Example Parameters[&quot;Pitch GC&quot;] = 0.6e-6 will result in 6um Etch Space + Rib Space = 0.6um.</span>
<span class="s2">                    Parameters[&quot;Input LengthGC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="s2">                    Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect! </span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width. </span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber core Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber Cladding Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Core Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Core Index</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Index&quot;]</span>
<span class="s2">                        Single Mode Fiber Cladding Index</span>
<span class="s2">                    Parameters[&quot;SMF Theta&quot;]: int/float</span>
<span class="s2">                        Tilting Angle of the Single Mode Fiber to the Grating Coupler. Normaly we choose Parameters[&quot;SMF Theta&quot;] = 15</span>
<span class="s2">                    Parameters[&quot;SMF Z Span&quot;]: int/float</span>
<span class="s2">                        Lenght/Span of the Single Mode Fiber</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Number</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call StraightWaveguide with -&gt; obj.MZM(Parameters) </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Height</span>
<span class="s2">                    Parameters[&quot;Optical&quot;] : dictionary of str</span>
<span class="s2">                        Optical Materials Dataset</span>
<span class="s2">                    Parameters[&quot;Electrical&quot;] : dictionary of str</span>
<span class="s2">                        Electrical Materials Dataset</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Side angle of the Waveguife</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="s2">                        Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide Height</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide lenght. This determin the structure length as well</span>
<span class="s2">                    Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Ground Electrode width</span>
<span class="s2">                    Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Signal electrode Width</span>
<span class="s2">                    Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="s2">                        Height of the Metal electrodes</span>
<span class="s2">                    Parameters[&quot;Gap&quot;] : int/float</span>
<span class="s2">                        Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes.</span>
<span class="s2">                        </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                </div>

                  
                  
                  
                  
<div class="viewcode-block" id="HelpSubject.Help_Solvers">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_Solvers">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_Solvers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        # ============================================================================= #</span>
<span class="s2">        #                Welcome to the Help Menu for Lumerical Structure Solver. You   #     </span>
<span class="s2">        #                can ask for help for one of the following structural solvers   #   </span>
<span class="s2">        #                                                                               #</span>
<span class="s2">        #                1) Waveguide FDE Solver                                        #</span>
<span class="s2">        #                2) MMI2x1 EME Solver                                           # </span>
<span class="s2">        #                3) MMI2x2 EME Solver                                           #</span>
<span class="s2">        #                4) InverseTaper EME Solver                                     #      </span>
<span class="s2">        #                5) Directional Coupler EME Solver                              # </span>
<span class="s2">        #                6) StraightWaveguide EME Solver                                #       </span>
<span class="s2">        #                7) WDM (Wavelength Division Multiplexing, angeled MMI) -EME    #</span>
<span class="s2">        #                   Solver                                                      #          </span>
<span class="s2">        #                8) MMI2x1 FDTD Solver                                          # </span>
<span class="s2">        #                9) MMI2x2 FDTD Solver                                          #</span>
<span class="s2">        #                10) InverseTaper FDTD Solver                                   #      </span>
<span class="s2">        #                11) Directional Coupler FDTD Solver                            # </span>
<span class="s2">        #                12) StraightWaveguide FDTD Solver                              #     </span>
<span class="s2">        #                13) BendWaveguide FDTD Solver                                  # </span>
<span class="s2">        #                14) ArcWaveguide FDTD Solver                                   #        </span>
<span class="s2">        #                15) GratingCoupler FDTD Solver                                 #         </span>
<span class="s2">        #                16) RingGratingCoupler FDTD Solver                             # </span>
<span class="s2">        #                17) MZM CHARGE Solver                                          #</span>
<span class="s2">        #                18) MZM FEEM Solver                                            #        </span>
<span class="s2">        #                                                                               #  </span>
<span class="s2">        #                To print information about the solver you desire please        #  </span>
<span class="s2">        #                use obj.Help({&quot;Solvers&quot;}: Number). For Example                 #  </span>
<span class="s2">        #                obj.Help({&quot;Solvers&quot;: 1}) will give you information about       #  </span>
<span class="s2">        #                FDE Solver Parameters for Waveguide Structure                  #</span>
<span class="s2">        # ============================================================================= #</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpSubject.Solvers">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Solvers">[docs]</a>
    <span class="k">def</span> <span class="nf">Solvers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NumberSolver</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Waveguide FDE Solver with -&gt; obj.Solver(&quot;Waveguide&quot;, &quot;FDE&quot;,  Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;]: int/float   </span>
<span class="s2">                        Substrate height</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of waveguide</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x1 EME Solver with -&gt; obj.Solver(&quot;MMI2x1&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------       </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;angle&#39;] : int/float</span>
<span class="s2">                        Angle of the Waveguide Walls. it is calculated WG_angle = 90 - angle.</span>
<span class="s2">                        For anfle = 90 we get a perfect rect!</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width og waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                        Input waveguide/taper offset.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;]: boolen </span>
<span class="s2">                        Add Taper to the structure on the input and output waveguids</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="s2">                        Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">                    Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="s2">                        This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="s2">                        becouse the maschine of our physic departmant had some proiblems with the LNOI objects design. </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>       
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x2 EME Solver with -&gt; obj.Solver(&quot;MMI2x2&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------      </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width og waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;]: boolen </span>
<span class="s2">                        Add Taper to the structure on the input and output waveguids</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="s2">                        Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Mesh cell size.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call InverseTaper EME Solver with -&gt; obj.Solver(&quot;InverseTaper&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------     </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39; : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab height</span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                        Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                        Length of the Photonic Wire Bonding Taper</span>
<span class="s2">                    Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber core Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="s2">                        Single Mode Fiber Cladding Diameter</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Mesh y-Axis</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Mesh z-Axis</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                        List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken. </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call InverseTaper EME Solver with -&gt; obj.Solver(&quot;DirectionalCoupler&quot;, &quot;EME&quot;, Parameters)</span>

<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">        -----------------------------------------------------------------------------------------------------------     </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="s2">                        Height of the Substrate</span>
<span class="s2">                    Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="s2">                        Width of the MMI</span>
<span class="s2">                    Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="s2">                        Length of the Directional coupler</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="s2">                        Height of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="s2">                        Waveguide Width</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="s2">                        Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="s2">                        will be offset of the middle position (y = 0) by the half of there</span>
<span class="s2">                        Width. In this case they will not overlap if the Offset is 0.</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : float/int</span>
<span class="s2">                        Mesh resolution for the y-Axis</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : float/int</span>
<span class="s2">                        Mesh resolution for the z Axis</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="s2">                        Slab height.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;) </span>
<span class="s2">        -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call StraightWaveguide EME Solver with -&gt; obj.Solver(&quot;StraightWaveguide&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------          </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                       Waveguide Length</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                       Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                       Waveguide width.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;] : boolen</span>
<span class="s2">                       If Taper == False, only straight Waveguide will be simulated,</span>
<span class="s2">                       If Taper == True an Taper will be simulated</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                       Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                       Taper Length</span>
<span class="s2">                    Parameters[&#39;y res&#39;]: int/float</span>
<span class="s2">                         EME Mesh resolutio,</span>
<span class="s2">                    Parameters[&#39;z res&#39;]: int/float</span>
<span class="s2">                         EME Mesh resolutio,</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                       Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                       Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                       This Parameter will set the theta ratation angle of the port. It can be 90 or 180.</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                       List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="s2">                            This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="s2">                            and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="s2">                            If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="s2">                            </span>
<span class="s2">                            If Parameters[&quot;Taper Type&quot;] is given, themn the user need to set couple more parameters:</span>
<span class="s2">                                Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                                    Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                                    Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="s2">                                    Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="s2">                                    Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                                    Length of the Photonic Wire Bonding Taper</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Wavelength Division Multiplexing EME Solver with -&gt; obj.Solver(&quot;WDM&quot;, &quot;EME&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------       </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of the MMI.</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of the MMI.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39; : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Waveguide length.</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                        Taper backside width, frontside width is the waveguide width.</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                        Taper Length</span>
<span class="s2">                    Parameters[&#39;y res&#39;] : int/float</span>
<span class="s2">                        Mesh y-Axis</span>
<span class="s2">                    Parameters[&#39;z res&#39;] : int/float</span>
<span class="s2">                        Mesh z-Axis</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Slab Height.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&#39;Angle Thetha&#39;] : boolen</span>
<span class="s2">                        Angle for the input and output waveguides</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x1 FDTD Solver with -&gt; obj.Solver(&quot;MMI2x1&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------    </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width og waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&#39;Offset Input&#39;] : int/float</span>
<span class="s2">                        Input waveguide/taper offset.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;]: boolen </span>
<span class="s2">                        Add Taper to the structure on the input and output waveguids</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="s2">                        Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">                    Parameters[&quot;Offset Output&quot;] : anything, optional</span>
<span class="s2">                        This function will allow the user to move the outputs in oposite direction. Please dont use it since is there only </span>
<span class="s2">                        becouse the maschine of our physic departmant had some proiblems with the LNOI objects design.    </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call MMI2x2 FDTD Solver with -&gt; obj.Solver(&quot;MMI2x2&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------    </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;MMI Width&#39;] : int/float</span>
<span class="s2">                        Width of MMI</span>
<span class="s2">                    Parameters[&#39;MMI Length&#39;] : int/float</span>
<span class="s2">                        Length of MMI</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Heigth of waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Width og waveguide</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                        Length of waveguide</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : int/float</span>
<span class="s2">                        Offset between the waveguides. If Taper == True then this become the offset</span>
<span class="s2">                        betweent he tapers wider sides. Waveguide and Tapers cannot be placed ourside</span>
<span class="s2">                        the MMI structure. The minimum distance between Taper and Waveguide is 1 um</span>
<span class="s2">                        becouse of manufactering restrictions in the University.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;]: boolen </span>
<span class="s2">                        Add Taper to the structure on the input and output waveguids</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;]: int/float</span>
<span class="s2">                        Lenght of the Taper in Parameters[&quot;Taper&quot;] = True</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                        Mesh cell sizes.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call InverseTaper FDTD Solver with -&gt; obj.Solver(&quot;InverseTaper&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------  </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                      Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39; : int/float</span>
<span class="s2">                      Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                      Waveguide width.</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                      Slab height</span>
<span class="s2">                    Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                      Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                      Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="s2">                    Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                      Length of the Photonic Wire Bonding Taper</span>
<span class="s2">                    Parameters[&quot;SMF Core Diameter&quot;] : int/float</span>
<span class="s2">                    Single Mode Fiber core Diameter</span>
<span class="s2">                    Parameters[&quot;SMF Cladding Diameter&quot;] : int/float</span>
<span class="s2">                    Single Mode Fiber Cladding Diameter</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                      Mesh x-Axis</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                      Wavelength</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                      Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                      List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.                 </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>                         
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Directional FDTD Solver with -&gt; obj.Solver(&quot;DirectionalCoupler&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------  </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : float/int</span>
<span class="s2">                        Height of the Substrate</span>
<span class="s2">                    Parameters[&#39;Substrate Width&#39;] : float/int</span>
<span class="s2">                        Width of the MMI</span>
<span class="s2">                    Parameters[&#39;DC Length&#39;] : float/int</span>
<span class="s2">                        Length of the Directional coupler</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : float/int</span>
<span class="s2">                        Height of the Waveguide</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : float/int</span>
<span class="s2">                        Waveguide Width</span>
<span class="s2">                    Parameters[&#39;Position Offset&#39;] : float/int</span>
<span class="s2">                        Positional offser of the waveguides. If posOffset the two Waveguides</span>
<span class="s2">                        will be offset of the middle position (y = 0) by the half of there</span>
<span class="s2">                        Width. In this case they will not overlap if the Offset is 0.</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : float/int</span>
<span class="s2">                        Mesh resolution for the x-Axis</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : float/int</span>
<span class="s2">                        Slab height.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : float/int</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>   
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call StraightWaveguide FDTD Solver with -&gt; obj.Solver(&quot;StraightWaveguide&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------         </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                       Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Length&#39;] : int/float</span>
<span class="s2">                       Waveguide Length</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                       Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                       Waveguide width.</span>
<span class="s2">                    Parameters[&quot;Taper&quot;] : boolen</span>
<span class="s2">                       If Taper == False, only straight Waveguide will be simulated,</span>
<span class="s2">                       If Taper == True an Taper will be simulated</span>
<span class="s2">                    Parameters[&#39;Taper Width&#39;] : int/float</span>
<span class="s2">                       Taper backside Width. Taper Fronside width is the width of the Waveguide</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                       Taper Length</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                         EME Mesh resolutio,</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                       Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                       Wavelength</span>
<span class="s2">                    Parameters[&quot;Waveguide Angle&quot;] : int/float</span>
<span class="s2">                       This Parameter will set the theta ratation angle of the port. It can be 90 or 180.</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                       List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Taper Type&quot;] : anything, optional</span>
<span class="s2">                            This function will check if you have set Parameters[&quot;Taper Type&quot;] to anaything, for example &quot;Parameters[&quot;Taper Type&quot;]=1&quot; </span>
<span class="s2">                            and if so it will design an Inverse Taper Structure with no Cladding. Here the option &quot;Cladding&quot; is not active and will be ignored.</span>
<span class="s2">                            If the user didnt give the &quot;Taper Type&quot; as dictionary key, then an normal taper structure will be simulated.</span>
<span class="s2">                            </span>
<span class="s2">                            If Parameters[&quot;Taper Type&quot;] is given, themn the user need to set couple more parameters:</span>
<span class="s2">                                Parameters[&#39;PWB Taper Width Back&#39;] : int/float</span>
<span class="s2">                                    Photonic Wirebonding (PWB) Width back side (to the Photonic Wire Bonding)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Hight Back&#39;] : int/float</span>
<span class="s2">                                    Photonic Wire Bonding Height back side (to the Photonic Wire Bonding)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Width Front&#39;] : int/float</span>
<span class="s2">                                    Photonic Wirebonding (PWB) Width front side (to the photonic waveguide)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Hight Front&#39;] : int/float</span>
<span class="s2">                                    Photonic Wire Bonding Height front side (to the photonic waveguide)</span>
<span class="s2">                                Parameters[&#39;PWB Taper Length&#39;] : int/float</span>
<span class="s2">                                    Length of the Photonic Wire Bonding Taper</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call BendWaveguide FDTD Solver with -&gt; obj.Solver(&quot;BendWaveguide&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------   </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                       Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                       Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                         EME Mesh resolutio,</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                       Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                       Wavelength</span>
<span class="s2">                    Parameters[&quot;x span&quot;] : int/float</span>
<span class="s2">                       Length of the S-Bend Waveguide</span>
<span class="s2">                    Parameters[&quot;y span&quot;] : int/float</span>
<span class="s2">                       Width of the S-Bend Waveguide</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">14</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call ArcWaveguide FDTD Solver with -&gt; obj.Solver(&quot;ArcWaveguide&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------     </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide hight. Also the height of the MMI section</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide width.</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                        EME Mesh resolutio,</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : int/float</span>
<span class="s2">                        Height of the slab.</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                        Wavelength</span>
<span class="s2">                    Parameters[&quot;S_Band Radius&quot;] : int/float</span>
<span class="s2">                        S-Bend Radius in um.</span>
<span class="s2">                    Parameters[&#39;Arc deg&#39;] : int/float</span>
<span class="s2">                        Arc define the Arc of the curve. It can be 90 or 180 degrees only.</span>
<span class="s2">                        This two will define an 1/4 of a circle or 1/2 of a circle.</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;]: list of int/floats</span>
<span class="s2">                        Parameters[&quot;Port Span&quot;] = [Span of Port in x direction, Span of Port in y direction, Span of Port in z direction]</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call GratingCoupler FDTD Solver with -&gt; obj.Solver(&quot;GratingCoupler&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------    </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="s2">                        Lenght of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Input Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="s2">                    Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="s2">                    Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="s2">                        Widht of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="s2">                        Hight of the Grating Coupler Material</span>
<span class="s2">                    Parameters[&#39;Taper&#39;] : boolen</span>
<span class="s2">                        Add Taper to structure</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                          Length of the Taper</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                          Wavelength</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                          Mesh x-Axis</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                          List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken.</span>
<span class="s2">                    Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="s2">                        Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>               
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call RingGratingCoupler FDTD Solver with -&gt; obj.Solver(&quot;RingGratingCoupler&quot;, &quot;FDTD&quot;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------            </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate height.</span>
<span class="s2">                    Parameters[&quot;Length GC&quot;]: int/float</span>
<span class="s2">                        Lenght of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Input Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place before the Grating Coupler region will start. </span>
<span class="s2">                    Parameters[&quot;Output Length GC&quot;]: int/float</span>
<span class="s2">                        An squere Waveguide with the same WG Height as the Grating coupler place after the Grating Coupler region to finish the structure.</span>
<span class="s2">                    Parameters[&quot;Width GC&quot;]: int/float</span>
<span class="s2">                        Widht of the Grating Coupler Area</span>
<span class="s2">                    Parameters[&quot;Hight GC&quot;]: int/float</span>
<span class="s2">                        Hight of the Grating Coupler Material</span>
<span class="s2">                    Parameters[&quot;GC Radius&quot;]: int/float</span>
<span class="s2">                        Radius of the Ring Grating Coupler in um. For Example &quot;Parameters[&quot;GC Radius&quot;] = 25e-6&quot;</span>
<span class="s2">                    Parameters[&#39;Taper Length&#39;] : int/float</span>
<span class="s2">                          Length of the input Taper</span>
<span class="s2">                    Parameters[&#39;Wavelength&#39;] : int/float</span>
<span class="s2">                          Wavelength</span>
<span class="s2">                    Parameters[&#39;x res&#39;] : int/float</span>
<span class="s2">                          Mesh x-Axis</span>
<span class="s2">                    Parameters[&quot;Mode&quot;] : str</span>
<span class="s2">                        Mode to choose from (&quot;fundamental TE mode&quot;, &quot;fundamental TM mode&quot;, &quot;fundamental mode&quot;)</span>
<span class="s2">                    Parameters[&quot;Port Span&quot;] : list of floats/ints</span>
<span class="s2">                          List of x,y and z span of the Ports. For this simulation only y and z parametes will be taken. </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">17</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Wavelength Division Multiplexing EME Solver with -&gt; obj.MZM_ChargeSolver(Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------       </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Heigh</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="s2">                        Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide Height</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="s2">                    Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Ground Electrode width</span>
<span class="s2">                    Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Signal electrode Width</span>
<span class="s2">                    Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="s2">                        Height of the Metal electrodes</span>
<span class="s2">                    Parameters[&quot;Gap&quot;] : int/float</span>
<span class="s2">                        Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes. </span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Simulation wavelength </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberSolver</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Call Wavelength Division Multiplexing EME Solver with -&gt; obj.MZM_FEEMSolver(Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------       </span>
<span class="s2">                    Parameters[&#39;Substrate Height&#39;] : int/float</span>
<span class="s2">                        Substrate Heigh</span>
<span class="s2">                    Parameters[&#39;Slab Height&#39;] : Slab Height</span>
<span class="s2">                        Height of the Material slab. It can be set to 0 if no Slab is presented</span>
<span class="s2">                    Parameters[&#39;WG Height&#39;] : int/float</span>
<span class="s2">                        Waveguide Height</span>
<span class="s2">                    Parameters[&#39;WG Width&#39;] : int/float</span>
<span class="s2">                        Waveguide Width. Here the Top Waveguide width is considered</span>
<span class="s2">                    Parameters[&quot;GND Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Ground Electrode width</span>
<span class="s2">                    Parameters[&quot;Signal Electrodes Width&quot;] : int/float</span>
<span class="s2">                        Signal electrode Width</span>
<span class="s2">                    Parameters[&quot;Electrodes Height&quot;] : int/float</span>
<span class="s2">                        Height of the Metal electrodes</span>
<span class="s2">                    Parameters[&quot;Gap&quot;] : int/float</span>
<span class="s2">                        Gap between the waveguide and the electrodes. The Gab is set from bottom Wg corner to electrodes. </span>
<span class="s2">                    Parameters[&quot;Wavelength&quot;] : int/float</span>
<span class="s2">                        Simulation wavelength </span>
<span class="s2">-----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> </div>

     
              
<div class="viewcode-block" id="HelpSubject.Help_StartSimulation">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_StartSimulation">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_StartSimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            #                Welcome to the Help Menu for Lumerical Simulation Run. You     #     </span>
<span class="s2">            #                can ask for help for one of the following simulations          #   </span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                1) Save and start FDE Simulation                               #</span>
<span class="s2">            #                2) Save and start EME Simulation                               # </span>
<span class="s2">            #                3) Save and start FDTD Simulation                              #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                To print information about how to start an simulation in the   #  </span>
<span class="s2">            #                choosen Solver. With obj.Help({&quot;Start Simulation&quot;}, Number) an #</span>
<span class="s2">            #                save of your simulation will be made in your current working   #</span>
<span class="s2">            #                directory. Afterwards the Simulation will be started.For       #</span>
<span class="s2">            #                Example obj.Help({&quot;Start Simulation&quot;: 1}) will start the FDE   #</span>
<span class="s2">            #                simulation.                                                    #</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpSubject.StartSolver">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.StartSolver">[docs]</a>
    <span class="k">def</span> <span class="nf">StartSolver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NumberStart</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">NumberStart</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Start FDE Simulation -&gt; obj.StartFDESimulation() </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------      </span>
<span class="s2">                    None  </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberStart</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Start EME Simulation -&gt; obj.StartEMESimulation() </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------      </span>
<span class="s2">                    None  </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="n">NumberStart</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Start FDTD Simulation -&gt; obj.StartFDTDSimulation() </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">-----------------------------------------------------------------------------------------------------------      </span>
<span class="s2">                    None  </span>
<span class="s2"> -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span> </div>


              
<div class="viewcode-block" id="HelpSubject.Help_Results">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_Results">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_Results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            #                Welcome to the Help Menu for Lumerical Result Extraction.      #     </span>
<span class="s2">            #                Youcan ask for help for one of the following Result Extraction #   </span>
<span class="s2">            #                 options.                                                      #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                1) Extract FDE Simulation Results                              #</span>
<span class="s2">            #                2) How to set Overlap Anaylsis with FDE Solver                 # </span>
<span class="s2">            #                3) Extract EME Simulation Results                              #</span>
<span class="s2">            #                3) Extract FDTD Simulation Results                             #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                To print information about how to extract results from the     #  </span>
<span class="s2">            #                simulation after Solver is done. With obj.Help({&quot;Results&quot;},    #</span>
<span class="s2">            #                Number) the simulated results will be extracted from the       #</span>
<span class="s2">            #                simulation workspace and transfered to python IDE.             #</span>
<span class="s2">            #                For Example obj.Help({&quot;Results&quot;: 1}) will extract the FDE      #</span>
<span class="s2">            #                data into 4 dictionaries.                                      #</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HelpSubject.Result_extraction">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Result_extraction">[docs]</a>
    <span class="k">def</span> <span class="nf">Result_extraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NumberResults</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">NumberResults</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Extract FDE results -&gt; obj.ExtrtactData(&#39;FDE&#39;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------     </span>
<span class="s2">                    Parameters[&quot;Effective Index&quot;] : float/int</span>
<span class="s2">                     Effective index value. All modes with effective index smaller then</span>
<span class="s2">                     the  Effective will be deleted. Effective is usualy the smalles effective</span>
<span class="s2">                     index from the hole construction (usualy the cladding). Since Lumerical will produce </span>
<span class="s2">                     modes with very small Effektive index, it make no sance to extract them !</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------     </span>


<span class="s2">                    Returns</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------     </span>
<span class="s2">         dictModesTE : dict</span>
<span class="s2">                 Dictionary with:</span>
<span class="s2">                         &#39;TE polarization fraction num&#39;</span>
<span class="s2">                         &#39;effective area&#39;</span>
<span class="s2">                         &#39;effective index num&#39;</span>
<span class="s2">                         &#39;group index num&#39;</span>
<span class="s2">                         &#39;Ex&#39;</span>
<span class="s2">                         &#39;Ey&#39;</span>
<span class="s2">                         &#39;Ez&#39;</span>
<span class="s2">                         </span>
<span class="s2">         dictDataTE : dict</span>
<span class="s2">                 Dictionary with:</span>
<span class="s2">                             &#39;E&#39;</span>
<span class="s2">                             </span>
<span class="s2">                             </span>
<span class="s2">        dictModesTM : dict</span>
<span class="s2">                Dictionary with:</span>
<span class="s2">                        &#39;TE polarization fraction num&#39;</span>
<span class="s2">                        &#39;effective area&#39;</span>
<span class="s2">                        &#39;effective index num&#39;</span>
<span class="s2">                        &#39;group index num&#39;</span>
<span class="s2">                        &#39;Ex&#39;</span>
<span class="s2">                        &#39;Ey&#39;</span>
<span class="s2">                        &#39;Ez&#39;</span>
<span class="s2">                        </span>
<span class="s2">        dictDataTM : dict</span>
<span class="s2">                Dictionary with:</span>
<span class="s2">                            &#39;E&#39;  </span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberResults</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Performe an Mode Overlap analisys FDE </span>
<span class="s2">                                    How to:</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------    </span>
<span class="s2">                After an FDE Simulation the user can:</span>
<span class="s2">                 </span>
<span class="s2">                 - Performe an Mode Overlap analisys. </span>
<span class="s2">                 Here an Waveguide with an choosen Parameters[] will be placed in the FDE solver. </span>
<span class="s2">                 Mode analysis is performed and the two fundamental modes TE and TM modes will be clipped to the Lumerical Board.</span>
<span class="s2">                 After the simulation the object will be removed. The two modes stay clipped to the board. </span>
<span class="s2">                 The user can then place an new Waveguide and performe and FDE Analysis. After the analysis </span>
<span class="s2">                 the modes can be compaired (overlapped) in Lumerical with the already clipped modes from the </span>
<span class="s2">                 first simulation. </span>
<span class="s2">    </span>
<span class="s2">                 With - OverlapFDEModes(Parameters)</span>
<span class="s2">                 Parameters[&quot;Effective Index&quot;] = Reflective Effektive index for the Material, Effective index value. </span>
<span class="s2">                 All modes with effective index smaller then the  Effective will be deleted. Effective is usualy the </span>
<span class="s2">                 smalles effective index from the hole construction (usualy the cladding). Since Lumerical will produce </span>
<span class="s2">                 modes with very small Effektive index, it make no sance to extract them ! </span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberResults</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Extract EME results -&gt; obj.ExtrtactData(&#39;EME&#39;, Parameters)  </span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------   </span>
<span class="s2">                    None</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------     </span>


<span class="s2">                    Returns</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------   </span>
<span class="s2">                   MonitorData : dict</span>
<span class="s2">                       Dictionary with:</span>
<span class="s2">                               &#39;lambda&#39;</span>
<span class="s2">                               &#39;f&#39;</span>
<span class="s2">                               &#39;x&#39;</span>
<span class="s2">                               &#39;y&#39;</span>
<span class="s2">                               &#39;z&#39;</span>
<span class="s2">                               &#39;E&#39;</span>
<span class="s2">                               &#39;H&#39;</span>
<span class="s2">                               &#39;Lumerical_dataset&#39;</span>
<span class="s2">                   EME_Sim_Data : dict</span>
<span class="s2">                       Dictionary with:</span>
<span class="s2">                               &#39;user s matrix&#39;</span>
<span class="s2">                               &#39;internal s matrix&#39;</span>
<span class="s2">                               &#39;local diagnostics&#39;</span>
<span class="s2">                               &#39;coefficients&#39;</span>
<span class="s2">                               &#39;global diagnostics&#39;</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">NumberResults</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    Extract FDTD results -&gt; obj.ExtrtactData(&#39;FDTD&#39;, Parameters)</span>
<span class="s2">                        </span>
<span class="s2">                    Dictionary Parameters:</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                    Parameters: boolen</span>
<span class="s2">                        If Parameters = True, an extra S-Parameter sweep over the ports will be performed. This </span>
<span class="s2">                        will add simulation time since the structute need to be sweeped one more time.</span>
<span class="s2">                        If Parameters = False, only FDTD simulation will be done and result will be extracted </span>
<span class="s2">                        the &quot;SParam_Dict&quot; dictionary will return 0.</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------     </span>


<span class="s2">                    Returns</span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------  </span>
<span class="s2">                    SParam_Dict: dict</span>
<span class="s2">                        Dictionary with:</span>
<span class="s2">                                &quot;S Parameter&quot;</span>
<span class="s2">                            </span>
<span class="s2">                    PowerData_Dict : dict</span>
<span class="s2">                        Dictionary with:</span>
<span class="s2">                                &#39;Power Input Port/s&#39;</span>
<span class="s2">                                &#39;Power Output Port/s&#39;</span>
<span class="s2">                                &#39;Transmission&#39;</span>
<span class="s2">                     </span>
<span class="s2">                </span>
<span class="s2">    -----------------------------------------------------------------------------------------------------------</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span></div>


    
     
              
<div class="viewcode-block" id="HelpSubject.Help_LoadingBar">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_LoadingBar">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_LoadingBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            #                Welcome to the Help Menu for the loading bar function          #     </span>
<span class="s2">            #                Here you can find a short discription on how to use it.        #   </span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                If the user want to keep track of the simulation state an      #</span>
<span class="s2">            #                laoding bar is imported in this library. The loading bar is    #</span>
<span class="s2">            #                not part of the class, so you dont need to call it like an     #</span>
<span class="s2">            #                class.                                                         #</span>
<span class="s2">            #                                                                               #  </span>
<span class="s2">            #                loadingBar(count, total)                                       #</span>
<span class="s2">            #                count - is your loop variable                                  # </span>
<span class="s2">            #                total - is the lenght of the variables that will be sweeped    #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                Example python code of loading bar:                            # </span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #      &gt;from Constructor import loadingBar                                      #</span>
<span class="s2">            #      &gt;                                                                        #</span>
<span class="s2">            #      &gt;for i in range(10):                                                     #</span>
<span class="s2">            #      &gt;    loadingBar(i, 10)                                                   #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span></div>

        
        

<div class="viewcode-block" id="HelpSubject.Help_RemoveObject">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_RemoveObject">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_RemoveObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            #                Welcome to the Help Menu for how to remove simulation          #     </span>
<span class="s2">            #                from Lumrical                                                  #   </span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                To Remove an Object simply use:                                #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                &gt;obj.removeObject()                                            #</span>
<span class="s2">            #                                                                               #  </span>
<span class="s2">            #                This will switch Lumerical from Simulation to                  #</span>
<span class="s2">            #                design and delete all the Structures, Monitors and Solver      #</span>
<span class="s2">            #                created by the user.                                           #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span></div>

 
        
<div class="viewcode-block" id="HelpSubject.Help_LogFile">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.HelpSubject.Help_LogFile">[docs]</a>
    <span class="k">def</span> <span class="nf">Help_LogFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            #                Welcome to the Help Menu for creating simulation log File      #</span>
<span class="s2">            #                from Lumrical                                                  #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                When you load the Logfile function from the Constructor Library#</span>
<span class="s2">            #                the user can keep track with the simulation and parameters     #</span>
<span class="s2">            #                used. To use the log File you need to give an list with        #</span>
<span class="s2">            #                two dictionarays. The first can be the dictionary with         #</span>
<span class="s2">            #                Parameters given for the simulation like &quot;Tapper Width&quot;,       #</span>
<span class="s2">            #                &quot;WG Width&quot;... The secound dictionary can be called direct      #</span>
<span class="s2">            #                after performing an analysis with obj.ReturnLogInfo(). This    #</span>
<span class="s2">            #                will extract the object that you simulate and the solver that  #</span>
<span class="s2">            #                you used. An text file will be created in the given Path. The  #</span>
<span class="s2">            #                name of the File will be &quot;Lumerical_Simulation_Log_15_10_52&quot;   #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                An example can be seen here:                                   #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            #                &gt;from Constructor import Logfile                               #</span>
<span class="s2">            #                &gt;Path = &quot;C:/Downloads/&quot;                                        #</span>
<span class="s2">            #                &gt;solverInfo = obj.ReturnLogInfo()                              #</span>
<span class="s2">            #                &gt;data = [solverInfo, Parameters]                               #</span>
<span class="s2">            #                &gt;Logfile(data, Path)                                           #</span>
<span class="s2">            #                                                                               #</span>
<span class="s2">            # ============================================================================= #</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span></div>
</div>

    



<div class="viewcode-block" id="Help">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Help">[docs]</a>
<span class="k">def</span> <span class="nf">Help</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    </span>
<span class="s2">        To start the Python Lumerical Constructor Library you need first to:</span>
<span class="s2">        from Constructor import Constructor</span>
<span class="s2">        from Constructor import loadingBar</span>
<span class="s2">        </span>
<span class="s2">        # Call the Constructor Object </span>
<span class="s2">        obj = Constructor(file, Lumerical Solver Type)</span>
<span class="s2">        # or </span>
<span class="s2">        obj = Constructor(file, MaterialPath, Lumerical Solver Type)</span>
<span class="s2">            # file = Path to lumapi.py for example -&gt; &quot;lumerical/2022-r2.4/api/python/lumapi.py&quot;</span>
<span class="s2">            # MaterialPath = Path to Material Library for example -&gt; &quot;/Desktop/LNOI_Env/LiNbO3.mdf&quot;-&gt; THIS IS OPTIONAL</span>
<span class="s2">            # Lumerical Solver Type = Solver Type can be EME or FDTD for example -&gt; &quot;EME&quot;</span>
<span class="s2">            </span>
<span class="s2">        # To Close Lumerical simply use</span>
<span class="s2">        obj.Close()</span>
<span class="s2">        </span>
<span class="s2">        # For Further Help after colling the Constructor Object please use:</span>
<span class="s2">        obj.Help()</span>
<span class="s2">            </span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span></div>

    
<span class="c1"># obj.Help(&#39;Objects&#39;) -&gt; Shows how to build an photonic element</span>
<span class="c1"># obj.Help(&#39;Solvers&#39;) -&gt; Shows hot to build an FDE, EME or FDTD Solver</span>
<span class="c1"># obj.Help(&#39;Start Simulation&#39;) -&gt; Commands to start simulation</span>
<span class="c1"># obj.Help(&#39;Results&#39;) -&gt; Shows how to extract resuslts form FDE, EME and FDTD Simulations</span>
<span class="c1"># obj.Help(&#39;Loading Bar&#39;) -&gt; Shows how to use the Loading Bar Function </span>
<span class="c1"># obj.Help(&#39;Remove Object&#39;) -&gt; Romove object function</span>
<span class="c1"># obj.Help(&#39;Log File&#39;) -&gt; Generate an log file from the simulation </span>



<div class="viewcode-block" id="Logfile">
<a class="viewcode-back" href="../../rst/Constructor.html#Constructor.Constructor.Logfile">[docs]</a>
<span class="k">def</span> <span class="nf">Logfile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : list</span>
<span class="sd">        List of dictionarys with all the data for the simulation (obj.ReturnLogInfo()) and the parameters (Parameters dictionary) given to the simulation. </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="c1"># datetime object containing current date and time</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="c1"># dd/mm/YY H:M:S</span>
    <span class="n">dt_string</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m/%Y %H:%M:%S&quot;</span><span class="p">)</span>
    
    
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Lumerical_Simulation_Log_&quot;</span><span class="o">+</span><span class="p">(</span><span class="n">dt_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="s2">&quot;EME&quot;</span> <span class="ow">or</span> <span class="s2">&quot;FDTD&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">SimulationData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Parameters</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Parameters</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">SimulationData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        



    <span class="n">ParamKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">SimulationDataKeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">SimulationData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span> 
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This is an Simulation Log file from the Lumerical Simulation done on </span><span class="si">{</span><span class="n">dt_string</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                   
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ParamKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Parameters</span><span class="p">[</span><span class="n">ParamKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
            
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulated Abject and used Solver&quot;</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ==========================================================================================================================================================</span>
<span class="s2">                   &quot;&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">keys</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SimulationData</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">SimulationDataKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">SimulationData</span><span class="p">[</span><span class="n">SimulationDataKeys</span><span class="p">[</span><span class="n">keys</span><span class="p">]])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Martin Mihaylov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>